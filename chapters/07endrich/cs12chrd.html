<html>	<head>		<meta http-equiv="content-type" content="text/html;charset=iso-8859-1">		<meta name="generator" content="Adobe GoLive 4">		<title>CSCORE EXAMPLE: CS12CHRD.C</title>	</head>	<body bgcolor="white">		<pre><font face="Courier New">/* CS12CHRD.C - explore pitch/sound continuum with Fibonacci-based chords</font><font face="Courier New"> *		CS12CHRD  V0.8TT, A Endrich  17 August 1995&quot;</font><font face="Courier New"> * Program to create microtonal Fibonacci harmonies within user-selected</font><font face="Courier New"> *	user-selected intervals.</font><font face="Courier New"> * This version simplifies the approach as suggested by MCA.</font><font face="Courier New"> */</font><font face="Courier New">/* HEADERS  - delete as appropriate */</font><font face="Courier New">#include &lt; stdio.h &gt; </font><font face="Courier New">#include &lt; stdlib.h &gt; 	/* for atof() ... */</font><font face="Courier New">#include &lt; math.h &gt; 	/* for the higher maths functions */</font><font face="Courier New">#include &lt; osbind.h &gt; 	/* for GEM applications */</font><font face="Courier New">#include &quot;cscore.h&quot;	/* omit if not using Cscore */</font><font face="Courier New">void phelp(void);</font><font face="Courier New">/* USAGE / HELP */</font><font face="Courier New">void</font><font face="Courier New">phelp(void) {	/* Adapt / omit the phelp() function for each program */</font><font face="Courier New">    printf(&quot;\nCS12CHRD - create Fibonacci harmonies\n&quot;);</font><font face="Courier New">    printf(&quot;\nUsage:  cs12chrd -sstartser -vnextval -ffreq -iinterval \</font><font face="Courier New">-nnumterms outscore\n&quot;);</font><font face="Courier New">    printf(&quot;\t-sstartser	first term of the series ( &gt;  0.0)\n&quot;);</font><font face="Courier New">    printf(&quot;\t-vnextval	second term of the series ( &gt; startser)\n&quot;);</font><font face="Courier New">    printf(&quot;\t-ffreq		root or central freq in Hz\n&quot;);</font><font face="Courier New">    printf(&quot;\t-iinterval	interval span within which to create the \</font><font face="Courier New">harmony\n&quot;);</font><font face="Courier New">    printf(&quot;\t\t\tharmonic complex;  express as a floating point number\n&quot;);</font><font face="Courier New">    printf(&quot;\t-nnumterms	number of terms in the Fibonacci series to\n&quot;);</font><font face="Courier New">    printf(&quot;\t\t\tbe used to generate harmonies (integer)\n&quot;);</font><font face="Courier New">    printf(&quot;\toutscore = name of Csound .sc created by the program\n&quot;);</font><font face="Courier New">    exit(1);</font><font face="Courier New">}</font><font face="Courier New">/* DECLARING MAIN */</font><font face="Courier New">void</font><font face="Courier New">main(int argc, char *argv[])</font><font face="Courier New">int	argc;</font><font face="Courier New">char	*argv[];</font><font face="Courier New">{</font><font face="Courier New">/* DECLARATIONS OF VARIABLES */</font><font face="Courier New">	EVENT	*e;</font><font face="Courier New">	EVLIST	*a;</font><font face="Courier New">	double	startser;  /* fp value of initial term in Fibonacci series    */</font><font face="Courier New">	double	nextval;   /* next (2nd) value in series */</font><font face="Courier New">	double	rootfreq;  /* root or central freq for the harmonic complex   */</font><font face="Courier New">	double	interval;  /* interval span within which the harmonic complex */</font><font face="Courier New">			   /*   is to be situated;  express as a ratio        */</font><font face="Courier New">	int	numterms;  /* number of terms in the Fibonnaci series to be   */</font><font face="Courier New">			   /*   used to generate harmonies within interval    */</font><font face="Courier New">	int	i;	   /* loop counter */</font><font face="Courier New">	double	*fibseries;  /* Array for fibonacci series      */</font><font face="Courier New">	double	*harms;    /* Array for frqs which make up the harm */</font><font face="Courier New">	double  nextharm;  /* second frequency of the harmony */</font><font face="Courier New">	double	fibnvaln;  /* nth value of series */</font><font face="Courier New">	double  afreq;	   /* temp variable for 1st two freqs of series */</font><font face="Courier New">	double  finalfrq;  /* frequency at nth term of the series */</font><font face="Courier New">	double  span;	   /* interval span from freq to finalfrq */</font><font face="Courier New">	double  scalingf;  /* scaling factor for frequencies      */</font><font face="Courier New">	double  term2temp; /* temp variable for 2nd term of series */</font><font face="Courier New">	double  stime1;	   /* start time for 1st event */</font><font face="Courier New">	double  stime2;	   /* start time for 3rd event */</font><font face="Courier New">	</font><font face="Courier New">/*	long    _mem;  	   for a memory check */</font><font face="Courier New">/* DISPLAY AVAILABLE RAM WHILE RUNNING THE PROGRAM (written for Atari TT) */</font><font face="Courier New">/*  _mem = (long)Malloc(-1); */</font><font face="Courier New">/*  printf(&quot;\n\nMEMORY CHECK:  _mem is %ld\n\n&quot;, _mem); */</font><font face="Courier New">/* READ USER-DEFINED FLAGS/PARAMETER INPUT FROM COMMAND LINE */</font><font face="Courier New">while(argc  &gt;  1 &amp;&amp; argv[1][0] == '-' &amp;&amp; argv[1][1] != 0) {</font><font face="Courier New">	switch(argv[1][1]) {</font><font face="Courier New">	case ('s'):</font><font face="Courier New">		startser = atof(&amp;argv[1][2]);</font><font face="Courier New">		printf(&quot;start of series = %f\n&quot;, startser);</font><font face="Courier New">		argc--, argv++;</font><font face="Courier New">		break;</font><font face="Courier New">	case ('v'):</font><font face="Courier New">		nextval = atof(&amp;argv[1][2]);</font><font face="Courier New">		printf(&quot;2nd term of series = %f\n&quot;, nextval);</font><font face="Courier New">		argc--, argv++;</font><font face="Courier New">		break;</font><font face="Courier New">	case ('f'):</font><font face="Courier New">		rootfreq = atof(&amp;argv[1][2]);</font><font face="Courier New">		printf(&quot;root frequency = %f\n&quot;, rootfreq);</font><font face="Courier New">		argc--, argv++;</font><font face="Courier New">		break;</font><font face="Courier New">	case ('i'):</font><font face="Courier New">		interval = atof(&amp;argv[1][2]);</font><font face="Courier New">		printf(&quot;interval ratio = %f\n&quot;, interval);</font><font face="Courier New">		argc--, argv++;</font><font face="Courier New">		break;</font><font face="Courier New">	case ('n'):</font><font face="Courier New">		numterms = atoi(&amp;argv[1][2]);</font><font face="Courier New">		printf(&quot;number of terms in series is %d\n&quot;, numterms);</font><font face="Courier New">		argc--, argv++;</font><font face="Courier New">		break;</font><font face="Courier New">	default:</font><font face="Courier New">		fprintf(stderr, &quot;CS12CHRD: '%s' is not an available \</font><font face="Courier New">option\n&quot;, argv[1]);</font><font face="Courier New">		phelp();</font><font face="Courier New">		exit(1);</font><font face="Courier New">	}</font><font face="Courier New">}</font><font face="Courier New">if(argc  &gt;  2) {</font><font face="Courier New">	fprintf(stderr, &quot;\nYou appear to have too many arguments in\</font><font face="Courier New"> the command line.  Check usage below:\n&quot;);</font><font face="Courier New">	phelp();</font><font face="Courier New">	exit(1);</font><font face="Courier New">}</font><font face="Courier New">/* CDP VERSION OF INITIAL() NB - initial() handles opening infile &amp; outfile */</font><font face="Courier New">initial(argc, argv); /* when using cscore.lib only */</font><font face="Courier New">/* any other variables to be used need to go here */</font><font face="Courier New">/*  DYNAMIC MEMORY ALLOCATION FOR THE ARRAYS */</font><font face="Courier New">if((fibseries = (double *)malloc(numterms * sizeof(double)))==NULL) {</font><font face="Courier New">	fprintf(stderr,&quot;\n\tcannot allocate memory for fibseries[]\n&quot;);</font><font face="Courier New">}</font><font face="Courier New">if((harms = (double *)malloc(numterms * sizeof(double)))==NULL) {</font><font face="Courier New">	fprintf(stderr,&quot;\n\tcannot allocate memory for harms[]\n&quot;);</font><font face="Courier New">}</font><font face="Courier New">/* CALCULATE TERMS OF THE FIBONACCI SERIES ACC. TO USER INPUT */</font><font face="Courier New">/* NB - term 1 is input for -sstartser and term 2 is input for -vnextval */</font><font face="Courier New">term2temp = nextval;  	   /* temp variable for nextval (which gets updated) */</font><font face="Courier New">fprintf(stderr, &quot;\tFibn term 0, value: %f\n&quot;, startser);</font><font face="Courier New">fprintf(stderr, &quot;\tFibn term 1, value: %f\n&quot;, nextval);</font><font face="Courier New">for(i = 2; i &lt;= numterms-1;  i++) {</font><font face="Courier New">	fibseries[i] = startser + nextval;  /* = the 3rd term of the series */</font><font face="Courier New">	startser = nextval;</font><font face="Courier New">	nextval = fibseries[i];</font><font face="Courier New">   	fprintf(stderr, &quot;\tFibn term %d, value: %f\n&quot;, i, fibseries[i]);</font><font face="Courier New">}</font><font face="Courier New">/* DO CALCULATIONS NEEDED TO DETERMINE THE EQUIVALENT FREQUENCY VALUES */</font><font face="Courier New">/* FORMULA: freq[i] = rootfreq + (fibseries[i] * scaling_factor) */</font><font face="Courier New">finalfrq = rootfreq * interval;		/* startfrq * interval_ratio */</font><font face="Courier New">span     = finalfrq - rootfreq;		/* calculate interval span in Hz */</font><font face="Courier New">fibnvaln = nextval;	       /* nextval now set to last val of fibseries[i] */</font><font face="Courier New">scalingf = (span/fibnvaln);		/* frequency scaling factor */</font><font face="Courier New">nextharm = rootfreq + (term2temp * scalingf); /* 2nd frequency of harmony */</font><font face="Courier New">for(i = 2; i &lt;= numterms-1; i++) {</font><font face="Courier New">	harms[i] = rootfreq + (fibseries[i] * scalingf); /* starts at 3rdval */</font><font face="Courier New">fprintf(stderr, &quot;\ndiagnostic: term %ld, fibnnum %ld&quot;, i, fibseries[i]);</font><font face="Courier New">}</font><font face="Courier New">/* WRITE INITIAL PART OF THE CSOUND SCOREFILE */</font><font face="Courier New">putstr(&quot;;FIBNHARM.SC\n\n&quot;);	/* generic name of outfile */</font><font face="Courier New">putstr(&quot;f1 0 256 10 1 0.7 0 0.9 0 0.8 0 0.6 ;sine wave function statement\n&quot;);</font><font face="Courier New">e = defev(&quot;t 0 60&quot;);		/* define a tempo statement event */</font><font face="Courier New">putev(e);	        	/* write this event to the score */</font><font face="Courier New">a = lcreat(numterms);</font><font face="Courier New">stime1 = 0.0;</font><font face="Courier New">/* WRITE THE FIRST TWO SCOREFILE EVENTS (terms 1 &amp; 2 of the series): */</font><font face="Courier New">afreq = rootfreq;		/* set first freq to user's -ffreq */</font><font face="Courier New">for (i =0; i &lt; 2; i++) {</font><font face="Courier New">	e = createv(7);  	/* create space for 7 pfields */</font><font face="Courier New">	e-&gt;op = 'i';		/* define op code for 'instrument' */</font><font face="Courier New">	e-&gt;p[1] = 1;		/* set this to instrument 1 */</font><font face="Courier New">	e-&gt;p[2] = stime1;	/* start at time  */</font><font face="Courier New">	e-&gt;[3] = 3;		/* 1st event lasts 2 sec. */</font><font face="Courier New">	e-&gt;p[4] = 30000/numterms; /* amplitude is scaled */</font><font face="Courier New">	e-&gt;p[5] = afreq;	/* 1st event: user input in Hz */</font><font face="Courier New">	e-&gt;p[6] = 0.5;		/* 1/2 sec attack envelope */</font><font face="Courier New">	e-&gt;p[7] = 0.5;		/* 1/2 sec decay envelope */</font><font face="Courier New">	a = lappev(a,e);	/* append event to list of events */</font><font face="Courier New">	afreq = nextharm; 	/* set 2nd freq as calculated above */</font><font face="Courier New">	stime1 += 0.0;		/* change this to produce temporal offsets */</font><font face="Courier New">}</font><font face="Courier New">stime2 = 0.0; </font><font face="Courier New">/* WRITE THE REST OF THE SCOREFILE EVENTS: */</font><font face="Courier New">for(i = 2; i &lt;= numterms-1; i++) {</font><font face="Courier New">	e = createv(7);  	/* create space for 7 pfields */</font><font face="Courier New">	e-&gt;op = 'i';		/* define op code for 'instrument' */</font><font face="Courier New">	e-&gt;p[1] = 1;		/* set this to instrument 1 */</font><font face="Courier New">	e-&gt;p[2] = stime2; 	/* start at time  */</font><font face="Courier New">	e-&gt;p[3] = 3;		/* 1st event lasts 2 sec. */</font><font face="Courier New">	e-&gt;p[4] = 30000/numterms;  /* amplitude is scaled */</font><font face="Courier New">	e-&gt;p[5] = harms[i];</font><font face="Courier New">	e-&gt;p[6] = 0.5;		/* 1/2 sec attack envelope */</font><font face="Courier New">	e-&gt;p[7] = 0.5;		/* 1/2 sec decay envelope */</font><font face="Courier New">	a = lappev(a,e);	/* append event to list of events */</font><font face="Courier New">	stime2 += 0.0;		/* change this to produce temporal offsets */</font><font face="Courier New">}</font><font face="Courier New">/* COMPLETE THE CSOUND SCORE FILE */</font><font face="Courier New">lput(a);			/* write to outfile */</font><font face="Courier New">lrelev(a);			/* release memory */</font><font face="Courier New">putstr(&quot;e&quot;);			/* end scorefile marker */</font><font face="Courier New">}  /* end of main */</font><font face="Courier New">/*</font><font face="Courier New"> * Ideas for further development:</font><font face="Courier New"> *	gliss from root freq to filled interval;</font><font face="Courier New"> *	gliss from n notes in interval a to n notes in interval b;</font><font face="Courier New"> *	have rootfreq as central to chord going both up &amp; down.</font><font face="Courier New"> */</font><font face="Times New Roman">	</font></pre>		<p>	</body>	</body></html>