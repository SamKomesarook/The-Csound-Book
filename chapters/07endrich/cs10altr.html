<html>	<head>		<meta http-equiv="content-type" content="text/html;charset=iso-8859-1">		<meta name="generator" content="Adobe GoLive 4">		<title>CSCORE EXAMPLE: CS10ALTR.C</title>	</head>	<body bgcolor="white">		<pre><font face="Courier New">/* CS10ALTR.C - use functions to alter several pfields, with cmndline input</font><font face="Courier New"> *		  of scaling factors</font><font face="Courier New"> * Developed from Cscore example in Csound manual</font><font face="Courier New"> * CS10ALTR V0.7TT A Endrich 17 August 1995</font><font face="Courier New"> * This program originally transposed a block of score events down an octave</font><font face="Courier New"> * 	and effected a gradual diminuendo.</font><font face="Courier New"> * Now it allows user inputs for several pfields and calls separate functions</font><font face="Courier New"> *	to alter each one.</font><font face="Courier New"> * Note that you need a suitable input score.</font><font face="Courier New"> */</font><font face="Courier New">#include &lt;stdio.h &gt; </font><font face="Courier New">#include &lt;:stdlib.h &gt; </font><font face="Courier New">#include &lt;math.h &gt; </font><font face="Courier New">#include &quot;cscore.h&quot; </font><font face="Courier New">/* DECLARE USER-DEFINED FUNCTIONS */</font><font face="Courier New">double newstt(double, double);</font><font face="Courier New">double newdur(double, double);</font><font face="Courier New">int newamp(int, int);</font><font face="Courier New">double newpch(double, double);</font><font face="Courier New">void</font><font face="Courier New">phelp(void) {</font><font face="Courier New">	printf(&quot;\nCS10ALTR - alter 4 pfields, with cmdline inputs,\n&quot;);</font><font face="Courier New">	printf(&quot;\tscaling by fixed (non-accumulating) factors\n&quot;);</font><font face="Courier New">	printf(&quot;\nUsage:  cs10altr  -sstartf -ddurf -aampf -ffreqf \</font><font face="Courier New">inscore.sc outscore.sc\n&quot;);</font><font face="Courier New">	printf(&quot;\t  -sstartf\tstart_time scaling ratio (*: 0.0-&gt;)\n&quot;);</font><font face="Courier New">	printf(&quot;\t  -ddurf\tdur scaling ratio (double) (*:  &gt; 0.0)\n&quot;);</font><font face="Courier New">	printf(&quot;\t  -aampf\tamp scaling integer	(+: 0- &gt; x000)\n&quot;);</font><font face="Courier New">	printf(&quot;\t  -ffreqf\tfrq scaling ratio (double)(*:  &gt; 0.0)\n&quot;);</font><font face="Courier New">	printf(&quot;\t\tWhen multiplying, vals &lt; 1 compress,  &gt; 1 expand\n&quot;);</font><font face="Courier New">	printf(&quot;\t\tNB1: vals &lt; 1 * scaling factors &lt; 1 become very small!\n&quot;);</font><font face="Courier New">	printf(&quot;\t\tNB2: if startf = 0, a simultaneity will result\n&quot;);</font><font face="Courier New">	printf(&quot;\t  inscore.sc\tassumed to have diff values for \n&quot;);</font><font face="Courier New">	printf(&quot;\t     each event, but = inscore values will also \n&quot;);</font><font face="Courier New">	printf(&quot;\t     all be = in the outscore, though rescaled\n&quot;);</font><font face="Courier New">	printf(&quot;\t  outscore.sc\tCsnd scorefile produced by prg\n&quot;);</font><font face="Courier New">		exit(1);</font><font face="Courier New">}</font><font face="Courier New">void</font><font face="Courier New">main(int argc, char *argv[])</font><font face="Courier New">int	argc;</font><font face="Courier New">char	*argv[];</font><font face="Courier New">{</font><font face="Courier New">	EVENT *e, **f;</font><font face="Courier New">	EVLIST *a, *b;</font><font face="Courier New">	int n, i;		/*declare the int counters to be used */</font><font face="Courier New">	int ampf = 1000;	/* user input for amplitude scaling factor */</font><font face="Courier New">	double startf = 0;	/* user input for start time scaling factor */</font><font face="Courier New">	double durf = 1;	/* user input for duration scaling factor */</font><font face="Courier New">	double freqf = 1.01;	/* variable for pitch scaling factor */</font><font face="Courier New">	/* READ USER-DEFINED FLAGS/PARAMETER INPUT FROM COMMAND LINE */</font><font face="Courier New">	while(argc  &gt;  1 &amp;&amp; argv[1][0] == '-' &amp;&amp; argv[1][1] != 0) {</font><font face="Courier New">		switch(argv[1][1]) {</font><font face="Courier New">		case('s'):</font><font face="Courier New">			startf = atof(&amp;argv[1][2]);</font><font face="Courier New">			fprintf(stderr,&quot;\nuser's time factor = %f\n&quot;, startf);</font><font face="Courier New">			argc--, argv++;</font><font face="Courier New">			break;</font><font face="Courier New">		case ('d'):</font><font face="Courier New">			durf = atof(&amp;argv[1][2]);</font><font face="Courier New">			printf(&quot;user's duration factor = %f\n&quot;, durf);</font><font face="Courier New">			argc--, argv++;</font><font face="Courier New">			break;</font><font face="Courier New">		case ('a'):</font><font face="Courier New">			ampf = atoi(&amp;argv[1][2]);</font><font face="Courier New">			printf(&quot;user's ampl factor  = %d\n&quot;, ampf);</font><font face="Courier New">			argc--, argv++;</font><font face="Courier New">			break;</font><font face="Courier New">		case ('f'):</font><font face="Courier New">			freqf = atof(&amp;argv[1][2]);</font><font face="Courier New">			printf(&quot;user's freq factor  = %f\n&quot;, freqf);</font><font face="Courier New">			argc--, argv++;</font><font face="Courier New">			break;</font><font face="Courier New">		default:</font><font face="Courier New">			fprintf(stderr, &quot;CS10ALTR: '%s' is not one of the \</font><font face="Courier New">options\n&quot;, argv[1]);</font><font face="Courier New">			phelp();</font><font face="Courier New">			exit(1);</font><font face="Courier New">		}</font><font face="Courier New">	}</font><font face="Courier New">	/* OPEN INSCORE &amp; OUTSCORE */</font><font face="Courier New">	initial(argc, argv);	/* check reading the arguments and open files */</font><font face="Courier New">	if(argc &lt; 2) {		/* Test that user's commandline is ok */</font><font face="Courier New">		phelp();</font><font face="Courier New">		exit(1);</font><font face="Courier New">	}</font><font face="Courier New">	/* PROCEED TO CREATE OUTPUT SCORE FILE */</font><font face="Courier New">	putstr(&quot;;Csound scorefile output by CS10ALTR:&quot;);</font><font face="Courier New">	a = lget();		/* read input score into event list &quot;a&quot;  */</font><font face="Courier New">	b = lsepf(a);		/* separate out the f statements */</font><font face="Courier New">	lput(b);		/* write f statements into the score */</font><font face="Courier New">	lrelev(b);		/* and release the spaces used */</font><font face="Courier New">	e = defev(&quot;t0 76&quot;);	/* define event for tempo statement */</font><font face="Courier New">	putev(e);		/* write tempo statement to score */</font><font face="Courier New">	lput(a);		/* write the list of events &quot;a&quot; */</font><font face="Courier New">	putstr(&quot;s&quot;);		/* write section end marker */</font><font face="Courier New">	putev(e);		/* write tempo statement again */</font><font face="Courier New">	b = lcopyev(a);		/* make a copy of events  in list &quot;a&quot; */</font><font face="Courier New">	n = b-&gt;nevents;		/* and count the number copied */</font><font face="Courier New">	f = &amp;a-&gt;e[1];		/* let f = the address of the first event */</font><font face="Courier New">	/* adapt inscore according to user's inputs */</font><font face="Courier New">	/* CALL USER-DEFINED FUNCTIONS TO ALTER EACH PFIELD */</font><font face="Courier New">	for(i=0; i&lt;=n-1; i++) {</font><font face="Courier New">		(*f)- &gt; p[2] = newstt((*f)- &gt; p[2],startf);	/* alter start times */</font><font face="Courier New">		(*f)- &gt; p[3] = newdur((*f)- &gt; p[3],durf);	/* alter durations */</font><font face="Courier New">		(*f)- &gt; p[4] = newamp((*f)- &gt; p[4],ampf);	/* alter amplitudes */</font><font face="Courier New">		(*f)- &gt; p[5] = newpch((*f)- &gt; p[5],freqf);	/* alter pitches */</font><font face="Courier New">		f++;					/* move -&gt; next event */</font><font face="Courier New">	}</font><font face="Courier New">	a = lcat(b,a);		/* join &quot;a&quot; list events to &quot;b&quot; list events */</font><font face="Courier New">	lput(a);		/* write the complete event list to outscore */</font><font face="Courier New">	putstr(&quot;e&quot;);		/* write end-of-score marker */</font><font face="Courier New">}				/* end of main */</font><font face="Courier New">/* USER-DEFINED FUNCTIONS */</font><font face="Courier New">double</font><font face="Courier New">newstt(double st, double sf)</font><font face="Courier New">/* double	st;	start time variable as in pfield 2 */</font><font face="Courier New">/* double	sf;	start time factor input on command line */</font><font face="Courier New">{</font><font face="Courier New">	st *= sf;	/* start time increases by user's factor */</font><font face="Courier New">	fprintf(stderr, &quot;\ndiagnostic, newst(): new start time = %.3f\n&quot;, st);</font><font face="Courier New">	return (st);</font><font face="Courier New">}</font><font face="Courier New">double</font><font face="Courier New">newdur(double du, double df)</font><font face="Courier New">/* double du;	duration variable as in pfield 3 */</font><font face="Courier New">/* double df;	duration factor input on command line */</font><font face="Courier New">{</font><font face="Courier New">	du *= df;	/* duration scaled by user's factor */</font><font face="Courier New">	fprintf(stderr, &quot;diagnostic, newst(): new duration = %.3f\n&quot;, du);</font><font face="Courier New">	return (du);</font><font face="Courier New">}</font><font face="Courier New">int</font><font face="Courier New">newamp(int am, int af)</font><font face="Courier New">/* int am;	amplitude variable as in pfield 4 */</font><font face="Courier New">/* int af; 	amplitude factor input on command line */</font><font face="Courier New">{</font><font face="Courier New">	am += af;	/* amplitude increase by user's factor */</font><font face="Courier New">	if(am  &gt;= 30000) {	/* attempt setting amplitude limits */</font><font face="Courier New">		am -= af;	/* dim if reaches upper limit */</font><font face="Courier New">		if(am &lt;= 500) {</font><font face="Courier New">			am += af; /* cresc if reaches lower limit */</font><font face="Courier New">		}</font><font face="Courier New">	}</font><font face="Courier New">	fprintf(stderr, &quot;diagnostic, newst(): new amplitude = %.3d\n&quot;, am);</font><font face="Courier New">	return(am);</font><font face="Courier New">}</font><font face="Courier New">double</font><font face="Courier New">newpch(double pch, double ff)</font><font face="Courier New">/* double  pch;	pitch value as in pfield 5 */</font><font face="Courier New">/* double  ff;  scaling factor input on command line */</font><font face="Courier New">{</font><font face="Courier New">	pch *= ff;	/* pitch scaled by user's scaling factor */</font><font face="Courier New">	fprintf(stderr, &quot;diagnostic, newst(): new pitch = %.3f\n&quot;, pch);</font><font face="Courier New">	return(pch);</font><font face="Courier New">}</font><font face="Times New Roman">	</font></pre>		<p>	</body></html>