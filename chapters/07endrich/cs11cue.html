<html>	<head>		<meta http-equiv="content-type" content="text/html;charset=iso-8859-1">		<meta name="generator" content="Adobe GoLive 4">		<title>CSCORE EXAMPLE: CS11CUE.C</title>	</head>	<body bgcolor="white">		<pre><font face="Courier New">/* CS11CUE.C - create n event blocks at specified time cues, with cresc/dim */</font><font face="Courier New">/* CS11CUE V0.8TT A Endrich,  17 August 1995 */</font><font face="Courier New">/* Developed from Cscore example in Csound manual */</font><font face="Courier New">/* 24 Dec 1997 - Atari drand48() replaced by rand() for use on PC's */</font><font face="Courier New">/*</font><font face="Courier New"> * Derived from example of applying diminuendo in CDP Csound Manual, p.91</font><font face="Courier New"> * Illustrates the way the 'i' events of a score can be separated out,</font><font face="Courier New"> *	copied, re-shaped, re-copied etc.; in this case the emphasis is on</font><font face="Courier New"> *	start times (p2) and amplitude (p4).</font><font face="Courier New"> * Extended (AE) to allow inputting time cues from a file, to control the</font><font face="Courier New"> *	number of blocks from the command line, and to cresc/dim to/from the</font><font face="Courier New"> *	center of each event block;  also several start time processing</font><font face="Courier New"> *	options, each in a separate function;  cries out for a transposition</font><font face="Courier New"> *	option.</font><font face="Courier New"> * Note that the nature of the inscore.sc greatly affects the results, and</font><font face="Courier New"> *	that the blocks of events can be separated in time or overlap,</font><font face="Courier New"> *	depending on whether the cues are &gt; or &lt; the time interval between</font><font face="Courier New"> *	events in inscore.sc.</font><font face="Courier New"> * I've left the diagnostic messages in for now because it's useful to know</font><font face="Courier New"> *	what the program thinks these values are.</font><font face="Courier New"> */</font><font face="Courier New">#include &lt;stdio.h&gt;</font><font face="Courier New">#include &lt;stdlib.h&gt;</font><font face="Courier New">#include &lt;math.h&gt;</font><font face="Courier New">#include &quot;cscore.h&quot;</font><font face="Courier New">/* DECLARE #DEFINES */</font><font face="Courier New">#define	ADD		0</font><font face="Courier New">#define	MULTIPLY	1</font><font face="Courier New">#define	RAND		2</font><font face="Courier New">#define	SAME		0</font><font face="Courier New">#define	DIFFERENT	1</font><font face="Courier New">/* DECLARE USER-DEFINED FUNCTIONS */</font><font face="Courier New">void phelp(void);</font><font face="Courier New">/* name(pval, cueval, process_type, score_type, counter) */</font><font face="Courier New">double stt_up(double, double, int, int, int);	/* fn to shape s_times incr'g */</font><font face="Courier New">double stt_dwn(double, double, int, int, int);	/* fn to shape s_times decr'g */</font><font face="Courier New">/* name(pval, ampfactor, process_type, score_type, counter) */</font><font face="Courier New">int vol_up(int, int, int, int, int);		/* fn to shape amps incr'g */</font><font face="Courier New">int vol_dwn(int, int, int, int, int);		/* fn to shape amps decr'g */</font><font face="Courier New">/* GLOBAL VARIABLES */</font><font face="Courier New">double	*cues;		/* array to hold user's time cues */</font><font face="Courier New">double	mult;		/* amplitude change factor multiplier */</font><font face="Courier New">int	holdamp;	/* to hold high amp for case SAME down */</font><font face="Courier New">int	range;		/* sets range for random function */</font><font face="Courier New">/* USAGE / HELP */</font><font face="Courier New">void</font><font face="Courier New">phelp(void) {</font><font face="Courier New">	printf(&quot;\nCS11CUE: create n event-blocks at specified time cues, \</font><font face="Courier New">with cresc/dim\n&quot;);</font><font face="Courier New">	printf(&quot;\nUsage:\n&quot;);</font><font face="Courier New">printf(&quot;cs11cue  -nnumcues -aampfactor [-mmultiplier] -tprocesstype \n&quot;);</font><font face="Courier New">	printf(&quot;\t\t[-rrange] -iscoretype cuefile inscore.sc outscore.sc\n&quot;);</font><font face="Courier New">	printf(&quot;\t-nnumcues\t(int) number of cues (temp measure!)\n&quot;);</font><font face="Courier New">	printf(&quot;\t-aampfactor\t(int) amp change factor (+: 0-&gt;x000)\n&quot;);</font><font face="Courier New">	printf(&quot;\t-mmultiplier\t(double) amp scaling ratio (*: &gt;0\n&quot;);</font><font face="Courier New">	printf(&quot;\t-tprocesstype\t(int) type is way to process times\n&quot;);</font><font face="Courier New">	printf(&quot;\t\t0: ADD fixed value\n&quot;);</font><font face="Courier New">	printf(&quot;\t\t1: MULTIPLY by cueval &amp; multiplier\n&quot;);</font><font face="Courier New">	printf(&quot;\t\t2: RANDOM (randval(0-1)*timecue*range)\n&quot;);</font><font face="Courier New">	printf(&quot;\t-rrange\t\t(int) numerical range for rand fn\n&quot;);</font><font face="Courier New">	printf(&quot;\t\tWARNING: Start times can be excessively high\n&quot;);</font><font face="Courier New">	printf(&quot;\t\tif both start time &amp; cueval are rather large.\n&quot;);</font><font face="Courier New">	printf(&quot;\t-iscoretype\ttype of input scorefile:\n&quot;);</font><font face="Courier New">	printf(&quot;\t\t0: SAME\tvals in event pfields are the same\n&quot;);</font><font face="Courier New">	printf(&quot;\t\t1: DIFFERENT\tvals in ev pfields are different\n&quot;);</font><font face="Courier New">	printf(&quot;\tcuefile\t\tinfile of cue times (sec) (double)\n&quot;);</font><font face="Courier New">	printf(&quot;\tinscore.sc	input Csound score file\n&quot;);</font><font face="Courier New">	printf(&quot;\toutscore.sc	Csound score file output by program\n&quot;);</font><font face="Courier New">	exit(1);</font><font face="Courier New">}</font><font face="Courier New">void</font><font face="Courier New">main(int argc, char *argv[])</font><font face="Courier New">int	argc;</font><font face="Courier New">char	*argv[];</font><font face="Courier New">{</font><font face="Courier New">	EVENT	 *e, **f;	/* **f points to event struc in evlist struc */</font><font face="Courier New">	EVLIST	 *a, *b;	/* pointers to the event list structures */</font><font face="Courier New">	FILE	 *fp1;		/* input file of cue times */</font><font face="Courier New">	int	 i, j, k, n, holdn, numcues;</font><font face="Courier New">	int	 eof_flag = 0, ptype, stype, ampf, holdamp = 0;</font><font face="Courier New">	char     message[81];	/* storage for diagnostic messages */</font><font face="Courier New">	</font><font face="Courier New">	/* READ USER-DEFINED FLAGS/PARAMETER INPUT FROM COMMAND LINE */	</font><font face="Courier New">	while(argc &gt; 1 &amp;&amp; argv[1][0] == '-' &amp;&amp; argv[1][1] != 0) {</font><font face="Courier New">		switch(argv[1][1]) {</font><font face="Courier New">		case ('n'):</font><font face="Courier New">			numcues = atoi(&amp;argv[1][2]);</font><font face="Courier New">			printf(&quot;\n file has % time cues\n&quot;, numcues);</font><font face="Courier New">			/* this is a fudge:  should be able to read this from */</font><font face="Courier New">			/*   the file itself, but can't program this yet */</font><font face="Courier New">			argc--, argv++;</font><font face="Courier New">			break;</font><font face="Courier New">		case ('a'):</font><font face="Courier New">			ampf = atoi(&amp;argv[1][2]);</font><font face="Courier New">			printf(&quot;\n amp factor is: %f \n&quot;, ampf);</font><font face="Courier New">			argc--, argv++;</font><font face="Courier New">			break;</font><font face="Courier New">		case ('m'):</font><font face="Courier New">			mult = atof(&amp;argv[1][2]);</font><font face="Courier New">			printf(&quot;\n amp multiplier is: %f \n&quot;, mult);</font><font face="Courier New">			argc--, argv++;</font><font face="Courier New">			break;</font><font face="Courier New">		case ('r'):</font><font face="Courier New">			range = atoi(&amp;argv[1][2]);</font><font face="Courier New">			printf(&quot;\n rand range is: %f \n&quot;, range);</font><font face="Courier New">			argc--, argv++;</font><font face="Courier New">			break;</font><font face="Courier New">		case ('t'):</font><font face="Courier New">			ptype = atoi(&amp;argv[1][2]);</font><font face="Courier New">			printf(&quot;processing type is: %d\n&quot;, ptype);</font><font face="Courier New">			argc--, argv++;</font><font face="Courier New">			break;</font><font face="Courier New">		case ('i'):</font><font face="Courier New">			stype = atoi(&amp;argv[1][2]);</font><font face="Courier New">			printf(&quot;input score type is: %d\n&quot;, stype);</font><font face="Courier New">			argc--, argv++;</font><font face="Courier New">			break;</font><font face="Courier New">		default:</font><font face="Courier New">			fprintf(stderr, &quot;CS11CUE: '%s' is not one of the \</font><font face="Courier New">options\n&quot;, argv[1]);</font><font face="Courier New">			phelp();</font><font face="Courier New">			exit(1);</font><font face="Courier New">		}</font><font face="Courier New">	}</font><font face="Courier New">	/* READ USER'S INPUT FILE OF CUE TIMES;  OPEN INSCORE &amp; OUTSCORE */</font><font face="Courier New">	if((fp1 = fopen(argv[1], &quot;r&quot;))==NULL) {</font><font face="Courier New">		fprintf(stderr, &quot;\nUnable to open your cuefile %s \n&quot;, argv[1]);</font><font face="Courier New">		phelp();</font><font face="Courier New">		exit(1);</font><font face="Courier New">	}</font><font face="Courier New">	argc--, argv++;	/* inscore.sc &amp; outscore.sc now remaining on cmdline */</font><font face="Courier New">	</font><font face="Courier New">	if((cues = (double *)malloc(numcues * sizeof(double)))==NULL) {</font><font face="Courier New">		fprintf(stderr,&quot;\n\tcannot allocate memory for cues array\n&quot;);</font><font face="Courier New">	}</font><font face="Courier New">	</font><font face="Courier New">	for(i = 0; i &lt; numcues &amp;&amp; eof_flag != EOF; ++i) {</font><font face="Courier New">		eof_flag = fscanf(fp1, &quot;%lf&quot;, &cues[i]);</font><font face="Courier New">		if(eof_flag != EOF) {</font><font face="Courier New">			fprintf(stderr,&quot;cue %d read as %lf\n&quot;, i, cues[i]);</font><font face="Courier New">		}	</font><font face="Courier New">	}</font><font face="Courier New">	initial(argc, argv);	/* re-check args &amp; open inscore &amp; outscore */</font><font face="Courier New">	if(argc &lt; 2) {		/* Usage if not enough filenames */</font><font face="Courier New">		phelp();</font><font face="Courier New">		exit(1);</font><font face="Courier New">	}</font><font face="Courier New">	/* PROCEED TO CREATE THE OUTPUT SCORE FILE */</font><font face="Courier New">	a = lget();		/* read in the inscore */</font><font face="Courier New">	b = lsepf(a);		/* separate out the f statements */</font><font face="Courier New">	lput(b);		/* write f statements to outscore */</font><font face="Courier New">	lrelev(b);		/* release space used */</font><font face="Courier New">	e = defev(&quot;t 0 76&quot;);	/* define tempo event */</font><font face="Courier New">	putev(e);		/* write this tempo event to outscore */</font><font face="Courier New">/*	lput(a);		 put orig events in score for comparison */</font><font face="Courier New">/*	putstr(&quot;s\n&quot;);		end-of-section;  new times begin at 0 */</font><font face="Courier New">/*	putev(e);		write new tempo event for next section */</font><font face="Courier New">	n = a-&gt;nevents;		/* set n to number of events in list 'a' */</font><font face="Courier New">	printf(&quot;diagnostic:  n = a-&gt;nevents = %d\n&quot;, n);</font><font face="Courier New">	holdn = n;		/* second variable which won't change */</font><font face="Courier New">	i = 0;			/* counter through cue array set to 0 */</font><font face="Courier New">	j = 0;			/* inner loop counter */</font><font face="Courier New">	k = 0;			/* counter for decrementing values */</font><font face="Courier New">	/* THE NUMBER OF TIME CUES SPECIFIES THE NUMBER OF BLOCKS: */</font><font face="Courier New">	for(i = 0; i &lt; numcues; i++) { /* numcues OUTER loops = event blocks */</font><font face="Courier New">		printf(&quot;\ndiagnostic:  Event block %d, time cue=%lf\n&quot;,\</font><font face="Courier New">i, cues[i]);</font><font face="Courier New">		f = &amp;a-&gt;e[1];	/* reset pointer to first event of list a */</font><font face="Courier New">				/* i.e. make a new block */</font><font face="Courier New">		n = holdn;	/* reset n to original event count */</font><font face="Courier New">		/* THIS HANDLES THE EVENTS OF EACH BLOCK, CALLING FUNCTIONS: */</font><font face="Courier New">		for(j = 0; j &lt; n; j++) {  /* INNER loop: adjust event pfields */</font><font face="Courier New">		   if(i &lt; abs(n/2)) {</font><font face="Courier New">			(*f)-&gt;p[2] = stt_up((*f)-&gt;p[2],cues[i],ptype,stype,j);</font><font face="Courier New">			(*f)-&gt;p[4] = vol_up((*f)-&gt;p[4],ampf,ptype,stype,j);</font><font face="Courier New">			holdamp = (*f)-&gt;p[4];	/* hold amplitude peak */</font><font face="Courier New">			f++;			/* move on to next event */</font><font face="Courier New">		   }</font><font face="Courier New">			/* NEXT CODE HANDLES CRESC/DIM, WITH OVERFLOW CONTROL */</font><font face="Courier New">			/* NOTE THAT INCREASE ADDED TO VALS OF PREVIOUS BLOCK */</font><font face="Courier New">		   else {</font><font face="Courier New">			(*f)-&gt;p[2] = stt_up((*f)-&gt;p[2],cues[i],ptype,stype, k);</font><font face="Courier New">			(*f)-&gt;p[4] = vol_dwn((*f)-&gt;p[4], ampf, ptype, stype, k);</font><font face="Courier New">			f++;			/* move on to next event */</font><font face="Courier New">			k++;</font><font face="Courier New">		   }</font><font face="Courier New">		}</font><font face="Courier New">		sprintf(message, &quot;\n;diagnostic: cue = %f&quot;, cues[i]);</font><font face="Courier New">		putstr(message); /*note method of writing diagnostic to .sc */</font><font face="Courier New">		lput(a);	/* write this event-list-block to outscore */</font><font face="Courier New">	}			/* back to OUTER FOR loop &amp; do next block */</font><font face="Courier New">	putstr(&quot;e&quot;);		/* write end of score marker */</font><font face="Courier New">}</font><font face="Courier New">/* SUBROUTINES TO ADD TIME CUES TO ALL START TIMES &amp; ALTER AMPLITUDES */</font><font face="Courier New">/* NB - The next time cue is added to the start time of the previous block. */</font><font face="Courier New">double</font><font face="Courier New">stt_up(double p2, double cueval, int tflag, int sflag, int counter)</font><font face="Courier New">/* double p2;		current p2 value (start time ) */</font><font face="Courier New">/* double cueval; 	current time cue value to use in calculations */</font><font face="Courier New">/* int	tflag;  	processing type flag */</font><font face="Courier New">/* int	sflag;		inscore type flag */</font><font face="Courier New">/* int	counter;	loop counter */</font><font face="Courier New">{</font><font face="Courier New">	if(tflag == ADD &amp;&amp; sflag == SAME) {		/* type 0 0 */</font><font face="Courier New">		p2 = p2 + (counter * cueval);</font><font face="Courier New">	}</font><font face="Courier New">	if(tflag == ADD &amp;&amp; sflag == DIFFERENT) {	/* type 0 1 */</font><font face="Courier New">		p2 = p2 + cueval;</font><font face="Courier New">	}</font><font face="Courier New">	if(tflag == MULTIPLY &amp;&amp; sflag == SAME) {	/* type 1 0 */</font><font face="Courier New">		p2 = p2 + (counter * cueval * mult);</font><font face="Courier New">	}</font><font face="Courier New">	if(tflag == MULTIPLY &amp;&amp; sflag == DIFFERENT) {	/* type 1 1 */</font><font face="Courier New">		p2 = p2 + (cueval * mult);</font><font face="Courier New">	}</font><font face="Courier New">	if(tflag == RAND &amp;&amp; sflag == SAME) {		/* type 2 0 */</font><font face="Courier New">		p2 = p2 + (int)(rand()*counter*cueval);</font><font face="Courier New">	}</font><font face="Courier New">	if(tflag == RAND &amp;&amp; sflag == DIFFERENT) {	/* type 2 1 */</font><font face="Courier New">		p2 = p2 + (rand()*cueval);</font><font face="Courier New">	}</font><font face="Courier New">	return(p2);</font><font face="Courier New">}</font><font face="Courier New">/* SUBROUTINES TO INCREMENT AMOUNT BY WHICH THE AMPLITUDE IS CHANGED */</font><font face="Courier New">/* NB - change is added to/subtracted  from the values of the previous block */</font><font face="Courier New">int</font><font face="Courier New">vol_up(int p4, int af, int tflag, int sflag, int counter)</font><font face="Courier New">/* int	p4;		current p4 value (amplitude) */</font><font face="Courier New">/* int	af;		amplitude change factor */</font><font face="Courier New">/* int	tflag;		processing type flag */</font><font face="Courier New">/* int	sflag;		inscore type flag, 0: same vals, 1: diff. vals */</font><font face="Courier New">/* int	counter;	event loop count */</font><font face="Courier New">{</font><font face="Courier New">	if(tflag == ADD &amp;&amp; sflag == SAME) {		/* type 0 0 */</font><font face="Courier New">		p4 = p4 + (counter * af);	/* amplitude change */</font><font face="Courier New">	}</font><font face="Courier New">	if(tflag == ADD &amp;&amp; sflag == DIFFERENT) {	/* type 0 1 */</font><font face="Courier New">		if(counter == 0) af = 0;		/* 1st event zero */</font><font face="Courier New">		p4 = p4 + af;</font><font face="Courier New">	}</font><font face="Courier New">	if(tflag == MULTIPLY &amp;&amp; sflag == SAME) {	/* type 1 0 */</font><font face="Courier New">		p4 = p4 + (counter * af * mult);	/* amplitude change */</font><font face="Courier New">	}</font><font face="Courier New">	if(tflag == MULTIPLY &amp;&amp; sflag == DIFFERENT) {	/* type 1 1 */</font><font face="Courier New">		if(counter == 0) af = 0;		/* 1st event zero */</font><font face="Courier New">		p4 = p4 + (af * mult);</font><font face="Courier New">	}</font><font face="Courier New">	if(tflag == RAND &amp;&amp; sflag == SAME) {		/* type 2 0 */</font><font face="Courier New">		p4 = p4 + (int)(rand()*counter*af); /* ampl change */</font><font face="Courier New">	}</font><font face="Courier New">	if(tflag == RAND &amp;&amp; sflag == DIFFERENT) {	/* type 2 1 */</font><font face="Courier New">		if(counter == 0) af = 0;		/* 1st event zero */</font><font face="Courier New">		p4 = p4 + (rand()*af);		/* amplitude change */</font><font face="Courier New">	}</font><font face="Courier New">	return(p4);</font><font face="Courier New">}</font><font face="Courier New">int </font><font face="Courier New">vol_dwn(int p4, int af, int tflag, int sflag, int counter)</font><font face="Courier New">/* int	p4;		current p4 value (amplitude) */</font><font face="Courier New">/* int	af;		amplitude change factor */</font><font face="Courier New">/* int	tflag;		processing type flag */</font><font face="Courier New">/* int	sflag;		inscore type flag, 0: same vals, 1: diff. vals */</font><font face="Courier New">/* int	counter;	event loop count */</font><font face="Courier New">{</font><font face="Courier New">	if(tflag == ADD &amp;&amp; sflag == SAME) {		/* type 0 0 */</font><font face="Courier New">		p4 = holdamp - (counter * af);		/* amplitude change */</font><font face="Courier New">	}</font><font face="Courier New">	if(tflag == ADD &amp;&amp; sflag == DIFFERENT) {	/* type 0 1 */</font><font face="Courier New">		if(counter == 0) af = 0;		/* 1st ev no change */</font><font face="Courier New">		p4 = p4 - af;</font><font face="Courier New">	}</font><font face="Courier New">	if(tflag == MULTIPLY &amp;&amp; sflag == SAME) {	/* type 1 0 */</font><font face="Courier New">		p4 = holdamp - (counter * af * mult);</font><font face="Courier New">	}</font><font face="Courier New">	if(tflag == MULTIPLY &amp;&amp; sflag == DIFFERENT) {	/* type 1 1 */</font><font face="Courier New">		if(counter == 0) af = 0;		/* 1st ev no change */</font><font face="Courier New">		p4 = p4 - (af * mult);			/* subtract */</font><font face="Courier New">	}</font><font face="Courier New">	if(tflag == RAND &amp;&amp; sflag == SAME) {		/* type 2 0 */</font><font face="Courier New">		p4 = p4 - (int)(rand()*counter*af);</font><font face="Courier New">	}</font><font face="Courier New">	if(tflag == RAND &amp;&amp; sflag == DIFFERENT) {	/* type 2 1 */</font><font face="Courier New">		if(counter == 0) af = 0;		/* 1st ev no change */</font><font face="Courier New">		p4 = p4 - (rand()*af);</font><font face="Courier New">	}</font><font face="Courier New">	return(p4);</font><font face="Courier New">}</font></pre>	</body>	</body></html>