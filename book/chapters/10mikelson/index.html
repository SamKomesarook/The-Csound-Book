<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN"><html>	<head>		<meta http-equiv="content-type" content="text/html;charset=iso-8859-1">		<meta name="generator" content="Adobe GoLive 4">		<title>Modeling &quot;Classic&quot; Keyboard Instruments in Csound</title>		<!-- SGI_COMMENT COSMOCREATE -->		<!-- SGI_COMMENT VERSION NUMBER="1.0.1" -->		<meta name="AUTHOR" content="End User">		<meta name="OPERATOR" content="End User">	</head>	<body bgcolor="white">		<div align="left">			<h1><font face="Times New Roman"><b>10. Modeling &quot;Classic&quot; Keyboard Instruments in Csound</b></font></h1>			<h2><font face="Times New Roman">Hans Mikelson</font></h2>			<p><font face="Times New Roman">Click <a href="chapter10.zip">HERE</a> to download chapter instruments.</font></p>		</div>		<h2><font face="Times New Roman"><b>Tone Wheel Organ with Rotating Speaker System</b></font></h2>		<p><a href="../../instruments/10/1001/1001.html"><font face="Times New Roman">1001</font></a></p>		<p><font face="Times New Roman"><b>Introduction</b></font></p>		<p><font face="Times New Roman">This instrument is an attempt to simulate a tone wheel organ with a rotating speaker effect like that produced by the Hammond B3 organ and the Leslie rotating speaker. The first section attempts to model the tone wheel organ and the second section attempts to model the rotating speaker. The final section discusses some suggestions for future modification of the instrument.</font></p>		<p><font face="Times New Roman"><b>Tone Wheel Organ</b></font></p>		<p><font face="Times New Roman">The first step towards reproducing this instrument is to study the internal structure of the tone wheel organ1. The heart of the tone wheel organ is its tone wheel mechanism. This consists of a central shaft with gears coupled to 91 tone wheels. A magnetic pick-up senses the distance to the wheel and generates an electric signal proportional to this distance.</font></p>		<p><font face="Times New Roman"><img src="figures/16.gif" sgi_src="/tmp_mnt/home/bull6/hpm/reality/classic/image16.gif" sgi_native_src="/tmp_mnt/home/bull6/hpm/reality/classic/image16.gif"></font></p>		<p><font face="Times New Roman" size="2"><b>Figure 10.1</b> Tone wheel and pickup.</font><font face="Courier New"><br>		</font></p>		<p><font face="Times New Roman">Due to the &quot;flower&quot; shape of the wheels and the filtering effect of the pick-ups the signal produced is very close to a sine wave in shape. <a href="../../../references/manual_html/gen/gen09.htm"><b>GEN 10</b></a><b> </b>can be used to set up a sine wave table.</font></p>		<p><font face="Courier New">f1 0 8192 10 1</font></p>		<p><font face="Times New Roman">An organ timbre is created by adding together signals from nine tone wheels. The amount of each harmonic added is controlled by nine drawbars with the following frequencies: Subfundamental, subthird, fundamental, second, third, fourth, fifth, sixth and eighth. Subfundamental is one octave below the fundamental. Subthird is one octave below the third. A separate <a href="../../../references/manual_html/siggen/oscil.htm"><b>oscil</b></a><b> </b>opcode can be used to generate each harmonic. The following Csound code fragment attempts to implement this aspect of the sound:</font></p>		<p>		<table border="0" cellspacing="2" cellpadding="0" width="442">			<tr>				<td width="20%" valign="top"><font face="Courier New">asubfund</font></td>				<td width="13%" valign="top"><a href="../../../references/manual_html/siggen/oscil.htm"><font face="Courier New">oscil</font></a></td>				<td width="12%" valign="top"><font face="Courier New">p6,</font></td>				<td width="19%" valign="top"><font face="Courier New">.5*ifqc,</font></td>				<td width="14%" valign="top"><font face="Courier New">iwheel1,</font></td>				<td width="28%" valign="top"><font face="Courier New">iphase/(ikey12)</font></td>			</tr>			<tr>				<td width="20%" valign="top"><font face="Courier New">asub3rd</font></td>				<td width="13%" valign="top"><a href="../../../references/manual_html/siggen/oscil.htm"><font face="Courier New">oscil</font></a></td>				<td width="12%" valign="top"><font face="Courier New">p7,</font></td>				<td width="19%" valign="top"><font face="Courier New">1.4983*ifqc,</font></td>				<td width="14%" valign="top"><font face="Courier New">iwheel2,</font></td>				<td width="28%" valign="top"><font face="Courier New">iphase/(ikey+7)</font></td>			</tr>			<tr>				<td width="20%" valign="top"><font face="Courier New">afund</font></td>				<td width="13%" valign="top"><a href="../../../references/manual_html/siggen/oscil.htm"><font face="Courier New">oscil</font></a></td>				<td width="12%" valign="top"><font face="Courier New">p8,</font></td>				<td width="19%" valign="top"><font face="Courier New">ifqc,</font></td>				<td width="14%" valign="top"><font face="Courier New">iwheel3,</font></td>				<td width="28%" valign="top"><font face="Courier New">iphase/ikey</font></td>			</tr>			<tr>				<td width="20%" valign="top"><font face="Courier New">a2nd</font></td>				<td width="13%" valign="top"><a href="../../../references/manual_html/siggen/oscil.htm"><font face="Courier New">oscil</font></a></td>				<td width="12%" valign="top"><font face="Courier New">p9,</font></td>				<td width="19%" valign="top"><font face="Courier New">2*ifqc,</font></td>				<td width="14%" valign="top"><font face="Courier New">iwheel4,</font></td>				<td width="28%" valign="top"><font face="Courier New">iphase/(ikey+12)</font></td>			</tr>			<tr>				<td width="20%" valign="top"><font face="Courier New">a3rd</font></td>				<td width="13%" valign="top"><a href="../../../references/manual_html/siggen/oscil.htm"><font face="Courier New">oscil</font></a></td>				<td width="12%" valign="top"><font face="Courier New">p10,</font></td>				<td width="19%" valign="top"><font face="Courier New">2.9966*ifqc,</font></td>				<td width="14%" valign="top"><font face="Courier New">iwheel4,</font></td>				<td width="28%" valign="top"><font face="Courier New">iphase/(ikey+19)</font></td>			</tr>			<tr>				<td width="20%" valign="top"><font face="Courier New">a4th</font></td>				<td width="13%" valign="top"><a href="../../../references/manual_html/siggen/oscil.htm"><font face="Courier New">oscil</font></a></td>				<td width="12%" valign="top"><font face="Courier New">p11,</font></td>				<td width="19%" valign="top"><font face="Courier New">4*ifqc,</font></td>				<td width="14%" valign="top"><font face="Courier New">iwheel4,</font></td>				<td width="28%" valign="top"><font face="Courier New">iphase/(ikey+24)</font></td>			</tr>			<tr>				<td width="20%" valign="top"><font face="Courier New">a5th</font></td>				<td width="13%" valign="top"><a href="../../../references/manual_html/siggen/oscil.htm"><font face="Courier New">oscil</font></a></td>				<td width="12%" valign="top"><font face="Courier New">p12,</font></td>				<td width="19%" valign="top"><font face="Courier New">5.0397*ifqc,</font></td>				<td width="14%" valign="top"><font face="Courier New">iwheel4,</font></td>				<td width="28%" valign="top"><font face="Courier New">iphase/(ikey+28)</font></td>			</tr>			<tr>				<td width="20%" valign="top"><font face="Courier New">a6th</font></td>				<td width="13%" valign="top"><a href="../../../references/manual_html/siggen/oscil.htm"><font face="Courier New">oscil</font></a></td>				<td width="12%" valign="top"><font face="Courier New">p13,</font></td>				<td width="19%" valign="top"><font face="Courier New">5.9932*ifqc,</font></td>				<td width="14%" valign="top"><font face="Courier New">iwheelManual4.074,</font></td>				<td width="28%" valign="top"><font face="Courier New">iphase/(ikey+31)</font></td>			</tr>			<tr>				<td width="20%" valign="top"><font face="Courier New">a8th</font></td>				<td width="13%" valign="top"><a href="../../../references/manual_html/siggen/oscil.htm"><font face="Courier New">oscil</font></a></td>				<td width="12%" valign="top"><font face="Courier New">p14,</font></td>				<td width="19%" valign="top"><font face="Courier New">8*ifqc,</font></td>				<td width="14%" valign="top"><font face="Courier New">iwheel4,</font></td>				<td width="28%" valign="top"><font face="Courier New">iphase/(ikey+36)</font></td>			</tr>		</table>		</p>		<p><font face="Times New Roman">In this instrument parameters <i>p6-p14</i> represent the values of the 9 drawbars. The fundamental frequency is given by <i>ifqc</i>. This is multiplied by equal temperment steps to obtain the other eight harmonics.</font></p>		<p><font face="Times New Roman">The twelve lowest tone wheels have only two teeth and in the Hammond B3 series had increased odd harmonic content which may be interpreted to mean they are somewhat rectangular in shape. To implement this table 2 is set up with some odd harmonic content.</font></p>		<p><font face="Courier New">f2 0 1024 10 1 0 .2 0 .1 0 .05 0 .02</font></p>		<p><font face="Times New Roman">The keyboard key pressed can be calculated from the frequency parameter <i>p5</i>. The key position is used to assign table 2 to the lowest twelve frequencies and table 1 to the others.</font><font face="Courier New"><br>		</font></p>		<p>		<table cellspacing="0" border="0" cellpadding="0" width="383">			<tr>				<td width="25%" valign="top"><font face="Courier New">iwheel1</font></td>				<td width="25%" valign="top"><a href="../../../references/manual_html/syntax/assign.htm"><font face="Courier New">init</font></a></td>				<td width="50%" valign="top"><font face="Courier New">((ikey12)&gt;12?1:2)</font></td>			</tr>			<tr>				<td width="25%" valign="top"><font face="Courier New">iwheel2</font></td>				<td width="25%" valign="top"><a href="../../../references/manual_html/syntax/assign.htm"><font face="Courier New">init</font></a></td>				<td width="50%" valign="top"><font face="Courier New">((ikey+7)&gt;12?1:2)</font></td>			</tr>			<tr>				<td width="25%" valign="top"><font face="Courier New">iwheel3</font></td>				<td width="25%" valign="top"><a href="../../../references/manual_html/syntax/assign.htm"><font face="Courier New">init</font></a></td>				<td width="50%" valign="top"><font face="Courier New">(ikey&gt;12?1:2)</font></td>			</tr>			<tr>				<td width="25%" valign="top"><font face="Courier New">iwheel4</font></td>				<td width="25%" valign="top"><a href="../../../references/manual_html/syntax/assign.htm"><font face="Courier New">init</font></a></td>				<td width="50%" valign="top"><font face="Courier New">1</font></td>			</tr>		</table>		</p>		<p><font face="Times New Roman">The phase of the tone wheels depends on the number of &quot;petals&quot; on a wheel and the alignment of the wheels. Some continuous variation in phase based on the wheel number and the time <i>p2</i> was desired. The variable <i>iphase</i> is set to <i>p2</i> and then divided by the tone-wheel number. In a way <i>p2</i> represents the central shaft of the organ. Finally the fundamentals are added together into a global variable.</font></p>		<h3><font face="Times New Roman"><b>Rotating Speaker Effect</b></font></h3>		<p><font face="Times New Roman">The second aspect of the classic Hammond organ sound is the Leslie rotating speaker. The speaker is powered by a tube amplifier. The structure of the Leslie speaker system consists of a high frequency driver pointing up into a plastic horn. The driver remains stationary and the horn rotates spraying the sound around the room. A low frequency driver directs sound downward into a rotating scoop.</font></p>		<p><font face="Times New Roman"><img src="figures/17.gif" sgi_src="/tmp_mnt/home/bull6/hpm/reality/classic/image17.gif" sgi_native_src="/tmp_mnt/home/bull6/hpm/reality/classic/image17.gif"></font></p>		<p><font face="Times New Roman" size="2"><b>Figure 10.2</b></font><font face="Times New Roman" size="2"> Rotating speaker system.</font><font face="Courier New"><br>		</font></p>		<p><font face="Times New Roman">The aspects considered to model this system were distortion introduced by the amplifier, acceleration rates of the horn and scoop, the Doppler effects of the rotating horn and scoop, different directional effects of different frequencies and stereo phase separation due to either microphone placement or separation between the listeners ears.</font></p>		<p><font face="Times New Roman">The first step taken in simulating this system is to add distortion to the sound by passing it through a waveshaping table. <b>GEN 8 </b>is used to set up a table such that values close to zero will be reproduced linearly while values further away from zero are compressed. This done using one of the following tables:</font><font face="Courier New"><br>		</font></p>		<p>		<table cellspacing="0" border="0" cellpadding="0" width="513">			<tr>				<td width="6%" valign="top"><font face="Courier New">f5</font></td>				<td width="6%" valign="top"><font face="Courier New">0</font></td>				<td width="6%" valign="top"><font face="Courier New">8192</font></td>				<td width="6%" valign="top"><font face="Courier New">8</font></td>				<td width="6%" valign="top"><font face="Courier New">.8</font></td>				<td width="6%" valign="top"><font face="Courier New">336</font></td>				<td width="6%" valign="top"><font face="Courier New">.78</font></td>				<td width="6%" valign="top"><font face="Courier New">800</font></td>				<td width="6%" valign="top"><font face="Courier New">.7</font></td>				<td width="6%" valign="top"><font face="Courier New">5920</font></td>				<td width="6%" valign="top"><font face="Courier New">.7</font></td>				<td width="6%" valign="top"><font face="Courier New">800</font></td>				<td width="6%" valign="top"><font face="Courier New">.78</font></td>				<td width="6%" valign="top"><font face="Courier New">336</font></td>				<td width="13%" valign="top"><font face="Courier New">.8</font></td>			</tr>			<tr>				<td width="6%" valign="top"><font face="Courier New">f6</font></td>				<td width="6%" valign="top"><font face="Courier New">0</font></td>				<td width="6%" valign="top"><font face="Courier New">8192</font></td>				<td width="6%" valign="top"><font face="Courier New">8</font></td>				<td width="6%" valign="top"><font face="Courier New">.8</font></td>				<td width="6%" valign="top"><font face="Courier New">336</font></td>				<td width="6%" valign="top"><font face="Courier New">.76</font></td>				<td width="6%" valign="top"><font face="Courier New">3000</font></td>				<td width="6%" valign="top"><font face="Courier New">.7</font></td>				<td width="6%" valign="top"><font face="Courier New">1520</font></td>				<td width="6%" valign="top"><font face="Courier New">.7</font></td>				<td width="6%" valign="top"><font face="Courier New">3000</font></td>				<td width="6%" valign="top"><font face="Courier New">.76</font></td>				<td width="6%" valign="top"><font face="Courier New">336</font></td>				<td width="13%" valign="top"><font face="Courier New">.8</font></td>			</tr>		</table>		</p>		<p><font face="Times New Roman">Table 5 produces a moderate distortion and table 6 produces increased distortion.</font></p>		<p><font face="Times New Roman">The next aspect considered is the acceleration of the horn and the scoop. The slow and fast rates of the high frequency horn are about .8 cycles/sec and 8 cycles/sec respectively. Acceleration of the horn takes about one second. The slow and fast rates of the scoop are about .7 cycles/sec. and 7 cycles/sec2. The acceleration of the bass scoop takes about two seconds. The following envelopes use the <a href="../../../references/manual_html/siggen/line.htm"><b>linseg</b></a> opcode to set the rotation rates, acceleration rates and hold times. This is set up in a separate instrument which acts as the foot switch and passed on using global variables.<br>		</font></p>		<p>		<table cellspacing="0" border="0" cellpadding="0" width="478">			<tr>				<td width="14%" valign="top"><font face="Courier New">gkenv</font></td>				<td width="14%" valign="top"><a href="../../../references/manual_html/siggen/line.htm"><font face="Courier New">linseg</font></a></td>				<td width="14%" valign="top"><font face="Courier New">gispeedi*.8,</font></td>				<td width="8%" valign="top"><font face="Courier New">1,</font></td>				<td width="14%" valign="top"><font face="Courier New">gispeedf*.8,</font></td>				<td width="8%" valign="top"><font face="Courier New">.01,</font></td>				<td width="14%" valign="top"><font face="Courier New">gispeedf*.8</font></td>			</tr>			<tr>				<td width="14%" valign="top"><font face="Courier New">gkenvlow</font></td>				<td width="14%" valign="top"><a href="../../../references/manual_html/siggen/line.htm"><font face="Courier New">linseg</font></a></td>				<td width="14%" valign="top"><font face="Courier New">gispeedi*.7,</font></td>				<td width="8%" valign="top"><font face="Courier New">2,</font></td>				<td width="14%" valign="top"><font face="Courier New">gispeedf*.7,</font></td>				<td width="8%" valign="top"><font face="Courier New">.01,</font></td>				<td width="14%" valign="top">&nbsp; <font face="Courier New">gispeedf*.7</font></td>			</tr>		</table>		</p>		<p><font face="Times New Roman">The next step is to produce a Doppler effect due to the rotation of the speakers. This is accomplished by setting up a delay line using the <a href="../../../references/manual_html/sigmod/delayr.htm"><b>delay</b></a><i> </i>opcode and accessing it with a variable time delay tap using the <a href="../../../references/manual_html/sigmod/deltap.htm"><b>deltapi</b></a><b> </b>opcode. The tap point is controlled by an <a href="../../../references/manual_html/siggen/oscil.htm"><b>oscil</b></a><b> </b>opcode accessing a sine table. Separate taps are used for right and left channels. The magnitude of the oscillation corresponds to the radius of rotation.</font></p>		<p>		<table cellspacing="0" border="0" cellpadding="0" width="320">			<tr>				<td width="20%" valign="top"><font face="Courier New">koscl</font></td>				<td width="20%" valign="top"><a href="../../../references/manual_html/siggen/oscil.htm"><font face="Courier New">oscil</font></a></td>				<td width="10%" valign="top"><font face="Courier New">1,</font></td>				<td width="10%" valign="top"><font face="Courier New">kenv,</font></td>				<td width="10%" valign="top"><font face="Courier New">1,</font></td>				<td width="10%" valign="top"><font face="Courier New">ioff</font></td>			</tr>			<tr>				<td width="20%" valign="top"><font face="Courier New">koscr</font></td>				<td width="20%" valign="top"><a href="../../../references/manual_html/siggen/oscil.htm"><font face="Courier New">oscil</font></a></td>				<td width="10%" valign="top"><font face="Courier New">1,</font></td>				<td width="10%" valign="top"><font face="Courier New">kenv,</font></td>				<td width="10%" valign="top"><font face="Courier New">1,</font></td>				<td width="10%" valign="top"><font face="Courier New">ioff+isep</font></td>			</tr>		</table>		</p>		<p><font face="Times New Roman">The phase separation between the signals is controlled by the variable <i>isep</i>. This can be thought of as the angle of separation between the listeners ears or the placement of microphones around the speaker. The variable <i>ioff</i> is a phase offset which is intended to allow for multiple rotating speakers at different locations in the room.</font></p>		<p>		<table cellspacing="0" border="0" cellpadding="0" width="242">			<tr>				<td width="33%" valign="top"><font face="Courier New">kdopl</font></td>				<td width="33%" valign="top"><font face="Courier New">=</font></td>				<td width="33%" valign="top"><font face="Courier New">.01koscl*.0002</font></td>			</tr>			<tr>				<td width="33%" valign="top"><font face="Courier New">kdopr</font></td>				<td width="33%" valign="top"><font face="Courier New">=</font></td>				<td width="33%" valign="top"><font face="Courier New">.012koscr*.0002</font></td>			</tr>			<tr>				<td width="33%" valign="top"><font face="Courier New">aleft</font></td>				<td width="33%" valign="top"><a href="../../../references/manual_html/sigmod/deltap.htm"><font face="Courier New">deltapi</font></a></td>				<td width="33%" valign="top"><font face="Courier New">kdopl</font></td>			</tr>			<tr>				<td width="33%" valign="top"><font face="Courier New">aright</font></td>				<td width="33%" valign="top"><a href="../../../references/manual_html/sigmod/deltap.htm"><font face="Courier New">deltapi</font></a></td>				<td width="33%" valign="top"><font face="Courier New">kdopr</font></td>			</tr>		</table>		</p>		<p><font face="Times New Roman">The Doppler effect is repeated for the low frequency section.</font></p>		<p><font face="Times New Roman">The final aspect considered is presentation of a frequency dependent stereo image. High frequency sound is more directional than low frequency sound. To simulate this the frequency is divided into three segments. First the right and left high frequency components are filtered using the <a href="../../../references/manual_html/sigmod/butterhp.htm"><b>butterbp</b></a> opcode.</font></p>		<p><font face="Courier New">alfhi <a href="../../../references/manual_html/sigmod/butterhp.htm">butterbp</a> aleft, 7000, 6000<br>		arfhi <a href="../../../references/manual_html/sigmod/butterhp.htm">butterbp</a> aright, 7000, 6000</font></p>		<p><font face="Times New Roman">The center frequency and bandwidth were determined empirically. The high frequency segment is modulated by a narrow pulse using <a href="../../../references/manual_html/gen/gen05.htm"><b>GEN 7</b></a><b> </b>to set up the following table.</font></p>		<p>		<table cellspacing="0" border="0" cellpadding="0" width="478">			<tr>				<td width="8%" valign="top"><font face="Courier New">f3</font></td>				<td width="8%" valign="top"><font face="Courier New">0</font></td>				<td width="8%" valign="top"><font face="Courier New">256</font></td>				<td width="8%" valign="top"><font face="Courier New">7</font></td>				<td width="8%" valign="top"><font face="Courier New">0</font></td>				<td width="8%" valign="top"><font face="Courier New">110</font></td>				<td width="8%" valign="top"><font face="Courier New">0</font></td>				<td width="8%" valign="top"><font face="Courier New">18</font></td>				<td width="8%" valign="top"><font face="Courier New">1</font></td>				<td width="8%" valign="top"><font face="Courier New">18</font></td>				<td width="8%" valign="top"><font face="Courier New">0</font></td>				<td width="8%" valign="top"><font face="Courier New">110</font></td>				<td width="8%" valign="top"><font face="Courier New">0</font></td>			</tr>		</table>		</p>		<p><font face="Times New Roman">The middle frequency sound is modulated by a wider pulse and the low frequency is modulated by a sine wave.</font></p>		<p>		<table cellspacing="0" border="0" cellpadding="0" width="373">			<tr>				<td width="20%" valign="top"><font face="Courier New">alfmid</font></td>				<td width="20%" valign="top"><a href="../../../references/manual_html/sigmod/butterhp.htm"><font face="Courier New">butterbp</font></a></td>				<td width="20%" valign="top"><font face="Courier New">aleft,</font></td>				<td width="20%" valign="top"><font face="Courier New">3000,</font></td>				<td width="20%" valign="top"><font face="Courier New">2000</font></td>			</tr>			<tr>				<td width="20%" valign="top"><font face="Courier New">arfmid</font></td>				<td width="20%" valign="top"><a href="../../../references/manual_html/sigmod/butterhp.htm"><font face="Courier New">butterbp</font></a></td>				<td width="20%" valign="top"><font face="Courier New">aright,</font></td>				<td width="20%" valign="top"><font face="Courier New">3000,</font></td>				<td width="20%" valign="top"><font face="Courier New">2000</font></td>			</tr>		</table>		</p>		<p><font face="Times New Roman">The pulse table is swept with <a href="../../../references/manual_html/siggen/poscil.htm"><b>oscil</b></a> using the same offset and separation as the Doppler tap.<br>		</font></p>		<p>		<table cellspacing="0" border="0" cellpadding="0" width="336">			<tr>				<td width="17%" valign="top"><font face="Times New Roman">kflohi</font></td>				<td width="17%" valign="top"><a href="../../../references/manual_html/siggen/oscil.htm"><font face="Times New Roman">oscil</font></a></td>				<td width="17%" valign="top"><font face="Times New Roman">1, kenv, 3</font></td>				<td width="17%" valign="top"><font face="Times New Roman">ioff</font></td>			</tr>			<tr>				<td width="17%" valign="top"><font face="Times New Roman">kfrohi</font></td>				<td width="17%" valign="top"><a href="../../../references/manual_html/siggen/oscil.htm"><font face="Times New Roman">oscil</font></a></td>				<td width="17%" valign="top"><font face="Times New Roman">1, kenv, 3</font></td>				<td width="17%" valign="top"><font face="Times New Roman">ioff+isep</font></td>			</tr>			<tr>				<td width="17%" valign="top"><font face="Times New Roman">kalosc</font></td>				<td width="17%" valign="top"><font face="Times New Roman">=</font></td>				<td width="17%" valign="top"><font face="Times New Roman">koscllow*.4</font></td>				<td width="17%" valign="top">&nbsp;+ 1</td>			</tr>			<tr>				<td width="17%" valign="top"><font face="Times New Roman">karosc</font></td>				<td width="17%" valign="top"><font face="Times New Roman">=</font></td>				<td width="17%" valign="top"><font face="Times New Roman">koscrlow*.4</font></td>				<td width="17%" valign="top">&nbsp;+ 1</td>			</tr>		</table>		</p>		<p><font face="Times New Roman">Finally the three filtered and modulated signals for each channel are added together to complete the instrument.</font></p>		<h3><font face="Times New Roman"><b>Discussion</b></font></h3>		<p><font face="Times New Roman">My instrument can only approximate the rich, warm, gritty character of a real Hammond organ. One advantage of using the Csound environment is its flexibility. The shape of the tone wheels can easily be changed. Samples from single tone wheels of actual instruments could be set up in tables. This may improve the simulation. Triangle waves or other wave shapes could be used instead of the sine waveforms. The instrument can be extended to have any number of additional speakers. Variable delay lines could be set up to simulate the complex echoes produced by the rotating speaker system.</font></p>		<h2><font face="Times New Roman"><b>Classic Analog Synthesizers</b></font></h2>		<p><a href="../../instruments/10/1007/1007.html"><font face="Times New Roman">1007</font></a><a href="../../instruments/10/1002.orc"><font face="Times New Roman">.</font></a></p>		<h3><font face="Times New Roman"><b>Introduction</b></font></h3>		<p><font face="Times New Roman">This set of instruments attempts to model some classic analog synthesizer instruments using Csound. Early synthesizers used fairly simple waveforms which were then processed through a resonant low pass filter. This type of filter provided one of the most distinctive elements of early synthesizers. Development of a two pole resonant low pass filter and some variations of this filter are discussed. The cascade form of a filter is discussed and a four pole filter is derived using cascade form.</font></p>		<h3><font face="Times New Roman"><b>Oscillators</b></font></h3>		<p><font face="Times New Roman">Early analog synthesizer oscillators generated very simple waveforms. Some of the most common used are the sine, square, sawtooth and triangle waveforms. These can be set up easily in Csound using tables which are then accessed using the <a href="../../../references/manual_html/siggen/oscil.htm"><b>oscil</b></a><b> </b>opcode.</font></p>		<p>		<table cellspacing="0" border="0" cellpadding="0" width="599">			<tr>				<td width="7%" valign="top"><font face="Times New Roman">f</font></td>				<td width="7%" valign="top"><font face="Times New Roman">1</font></td>				<td width="7%" valign="top"><font face="Times New Roman">0</font></td>				<td width="7%" valign="top"><font face="Times New Roman">1024</font></td>				<td width="7%" valign="top"><font face="Times New Roman">10</font></td>				<td width="7%" valign="top"><font face="Times New Roman">1</font></td>				<td width="7%" valign="top"><font face="Times New Roman">; Sine</font></td>				<td width="7%" valign="top"><font face="Times New Roman">Wave</font></td>				<td width="10%" valign="top">&nbsp;</td>				<td width="7%" valign="top">&nbsp;</td>				<td width="10%" valign="top">&nbsp;</td>				<td width="7%" valign="top">&nbsp;</td>				<td width="7%" valign="top">&nbsp;</td>				<td width="7%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="7%" valign="top"><font face="Times New Roman">f</font></td>				<td width="7%" valign="top"><font face="Times New Roman">2</font></td>				<td width="7%" valign="top"><font face="Times New Roman">0</font></td>				<td width="7%" valign="top"><font face="Times New Roman">256</font></td>				<td width="7%" valign="top"><font face="Times New Roman">7</font></td>				<td width="7%" valign="top"><font face="Times New Roman">1</font></td>				<td width="7%" valign="top"><font face="Times New Roman">128</font></td>				<td width="7%" valign="top"><font face="Times New Roman">1</font></td>				<td width="10%" valign="top"><font face="Times New Roman">0</font></td>				<td width="7%" valign="top"><font face="Times New Roman">1</font></td>				<td width="10%" valign="top"><font face="Times New Roman">128</font></td>				<td width="7%" valign="top"><font face="Times New Roman">1</font></td>				<td width="7%" valign="top"><font face="Times New Roman">;Square</font></td>				<td width="7%" valign="top"><font face="Times New Roman">Wave</font></td>			</tr>			<tr>				<td width="7%" valign="top"><font face="Times New Roman">f</font></td>				<td width="7%" valign="top"><font face="Times New Roman">3</font></td>				<td width="7%" valign="top"><font face="Times New Roman">0</font></td>				<td width="7%" valign="top"><font face="Times New Roman">256</font></td>				<td width="7%" valign="top"><font face="Times New Roman">7</font></td>				<td width="7%" valign="top"><font face="Times New Roman">1</font></td>				<td width="7%" valign="top"><font face="Times New Roman">256</font></td>				<td width="7%" valign="top"><font face="Times New Roman">1</font></td>				<td width="10%" valign="top"><font face="Times New Roman">; Sawtooth</font></td>				<td width="7%" valign="top">&nbsp;Wave</td>				<td width="10%" valign="top">&nbsp;</td>				<td width="7%" valign="top">&nbsp;</td>				<td width="7%" valign="top">&nbsp;</td>				<td width="7%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="7%" valign="top"><font face="Times New Roman">f</font></td>				<td width="7%" valign="top"><font face="Times New Roman">4</font></td>				<td width="7%" valign="top"><font face="Times New Roman">0</font></td>				<td width="7%" valign="top"><font face="Times New Roman">256</font></td>				<td width="7%" valign="top"><font face="Times New Roman">7</font></td>				<td width="7%" valign="top"><font face="Times New Roman">1</font></td>				<td width="7%" valign="top"><font face="Times New Roman">128</font></td>				<td width="7%" valign="top"><font face="Times New Roman">1</font></td>				<td width="10%" valign="top"><font face="Times New Roman">128</font></td>				<td width="7%" valign="top"><font face="Times New Roman">1</font></td>				<td width="10%" valign="top"><font face="Times New Roman">; Triangle</font></td>				<td width="7%" valign="top">&nbsp;Wave</td>				<td width="7%" valign="top">&nbsp;</td>				<td width="7%" valign="top">&nbsp;</td>			</tr>		</table>		</p>		<p><font face="Times New Roman">Pulse width modulation is often used in analog synthesis to produce a more complex timbre. In pulse width modulation a square wave is gradually transformed from a narrow square pulse to a wide square pulse. A sine wave can be used to modulate the pulse width. The rate of modulation can be set to increase with increasing frequency. The following Csound code accomplishes this.</font></p>		<p>		<table cellspacing="0" border="0" cellpadding="0" width="563">			<tr>				<td width="18%" valign="top"><font face="Courier New">ksine</font></td>				<td width="14%" valign="top"><a href="../../../references/manual_html/siggen/oscil.htm"><font face="Courier New">oscil</font></a></td>				<td width="20%" valign="top"><font face="Courier New">1.5,</font></td>				<td width="20%" valign="top"><font face="Courier New">ifqc/440,</font></td>				<td width="20%" valign="top"><font face="Courier New">1</font></td>			</tr>			<tr>				<td width="18%" valign="top"><font face="Courier New">ksquare</font></td>				<td width="14%" valign="top"><a href="../../../references/manual_html/siggen/oscil.htm"><font face="Courier New">oscil</font></a></td>				<td width="20%" valign="top"><font face="Courier New">ifqc*ksine,</font></td>				<td width="20%" valign="top"><font face="Courier New">ifqc,</font></td>				<td width="20%" valign="top"><font face="Courier New">2</font></td>			</tr>			<tr>				<td width="18%" valign="top"><font face="Courier New">axn</font></td>				<td width="14%" valign="top"><a href="../../../references/manual_html/siggen/oscil.htm"><font face="Courier New">oscil</font></a></td>				<td width="20%" valign="top"><font face="Courier New">iamp,</font></td>				<td width="20%" valign="top"><font face="Courier New">ifqc+ksquare,</font></td>				<td width="20%" valign="top"><font face="Courier New">itabl1</font></td>			</tr>		</table>		</p>		<p><font face="Times New Roman">The opcodes <a href="../../../references/manual_html/siggen/rand.htm"><b>rand</b></a><b> </b>and <a href="../../../references/manual_html/siggen/buzz.htm"><b>buzz</b></a><b> </b>can also be used as sources for an analog synthesizer.</font></p>		<h3><font face="Times New Roman"><b>Resonant Low Pass Filter</b></font></h3>		<p><font face="Times New Roman">The key step in reproducing a classic analog sound is the development of a good resonant low pass filter. A discussion of filter theory4 will help to illuminate the approach taken in designing this filter.</font></p>		<p><font face="Times New Roman">A general filter can be defined using the differential equation</font></p>		<p><font face="Times New Roman"><img height="29" width="624" src="figures/eq01.jpg">(10.1)</font></p>		<p><font face="Times New Roman">Where</font></p>		<ul>			<p><font face="Courier New"><i>X</i></font><font face="Courier New"> is the input signal,<br>			<i>Y</i> is the output signal,<br>			<i>X'</i> is the first derivative of X with respect to time,<br>			<i>X''</i> is the second derivative of X with respect to time,<br>			<i>Y'</i> is the first derivative of Y with respect to time,<br>			<i>Y''</i> is the second derivative of Y with respect to time,<br>			<i>ai</i> and <i>bi</i> are coefficients.</font></p>		</ul>		<p><font face="Times New Roman">Those not familiar with calculus can think of the first derivative as being the slope of the function and the second derivative as being the curvature of the function. The number of poles in the filter is determined by the highest order derivative in the equation.</font></p>		<p><font face="Times New Roman">The frequency response of the above equation can be written directly from it using the following procedure. Replace the undifferentiated terms with a one. Replace the differentiated terms with frequency raised to the power of the derivative. Construct a ratio with the left half of the equation as the numerator and the right half of the equation as the denominator. For example the above differential equation would yield the frequency response given in equation (2).</font></p>		<p><font face="Times New Roman"><img src="figures/eq02.jpg" sgi_src="/tmp_mnt/home/bull6/hpm/reality/classic/image19.gif" sgi_native_src="/tmp_mnt/home/bull6/hpm/reality/classic/image19.gif"> (10.2)</font></p>		<p><font face="Times New Roman">Where <img src="figures/20.jpg" sgi_src="/tmp_mnt/home/bull6/hpm/reality/classic/image20.gif" sgi_native_src="/tmp_mnt/home/bull6/hpm/reality/classic/image20.gif"> represents frequency. A spreadsheet or a math program can be used to observe how this equation responds to changes in the coefficients.</font></p>		<p><font face="Times New Roman">A resonant low pass filter can be generated by using the filter response function given in equation (3).</font></p>		<p><font face="Times New Roman"><img height="46" width="453" src="figures/eq03.jpg"></font></p>		<p><font face="Times New Roman">(10.3)</font></p>		<p><font face="Times New Roman">It can be seen that as the frequency approaches zero the b1 and b2 terms vanish and this function approaches one. As the frequency approaches infinity the squared term begins to dominate and this function approaches zero. Resonance is introduced by making b1 negative and b2 positive. carefully adjusting the values of the coefficients results in a peak at the cut off frequency. A typical curve is given in figure (3).</font></p>		<p><font face="Times New Roman"><img src="figures/22.gif" sgi_src="/tmp_mnt/home/bull6/hpm/reality/classic/image22.gif" sgi_native_src="/tmp_mnt/home/bull6/hpm/reality/classic/image22.gif"></font></p>		<p><font face="Times New Roman"><b>Figure 3</b> Graph of resonant low-pass filter frequency response.</font><font face="Courier New"><br>		</font></p>		<p><font face="Times New Roman">The differential equation corresponding to this frequency response is</font></p>		<p><font face="Times New Roman"><img src="figures/eq04.jpg" sgi_src="/tmp_mnt/home/bull6/hpm/reality/classic/image23.gif" sgi_native_src="/tmp_mnt/home/bull6/hpm/reality/classic/image23.gif"> (10.4)</font></p>		<p><font face="Times New Roman">To use this in Csound it must be converted from the continuous form of equation (10.4) to a discrete form. One way to do this is to convert the differential equation into a difference equation. The slope Y'=dY/dt can be approximated by DY/Dt and the curvature Y''=d2Y/dt2 can be approximated by D(DY)/D(Dt). Letting <img src="figures/24.jpg" sgi_src="/tmp_mnt/home/bull6/hpm/reality/classic/image24.gif" sgi_native_src="/tmp_mnt/home/bull6/hpm/reality/classic/image24.gif"> simplifies the algebra involved in solving this. This is valid if the sample rate is constant and the units of time are equal to 1/sr. Substituting the difference approximation for the differentials in equation (4) and knowing that DY=Yn-Yn-1 yields</font></p>		<p><font face="Times New Roman"><img src="figures/eq05.jpg" sgi_src="/tmp_mnt/home/bull6/hpm/reality/classic/image25.gif" sgi_native_src="/tmp_mnt/home/bull6/hpm/reality/classic/image25.gif">(10.5)</font></p>		<p><font face="Times New Roman">This can be solved for <img src="figures/26.jpg" sgi_src="/tmp_mnt/home/bull6/hpm/reality/classic/image26.gif" sgi_native_src="/tmp_mnt/home/bull6/hpm/reality/classic/image26.gif"> to obtain</font></p>		<p><font face="Times New Roman"><img src="figures/eq06.jpg" sgi_src="/tmp_mnt/home/bull6/hpm/reality/classic/image27.gif" sgi_native_src="/tmp_mnt/home/bull6/hpm/reality/classic/image27.gif">(10.6)</font></p>		<p><font face="Times New Roman">A Csound implementation follows:</font></p>		<p>		<table cellspacing="0" border="0" cellpadding="0" width="612">			<tr>				<td width="10%" valign="top"><font face="Courier New">aynm1</font></td>				<td width="10%" valign="top"><a href="../../../references/manual_html/syntax/assign.htm"><font face="Courier New">init</font></a></td>				<td width="25%" valign="top"><font face="Courier New">0</font></td>				<td width="25%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier New">aynm2</font></td>				<td width="10%" valign="top"><a href="../../../references/manual_html/syntax/assign.htm"><font face="Courier New">init</font></a></td>				<td width="25%" valign="top"><font face="Courier New">0</font></td>				<td width="25%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier New">ayn</font></td>				<td width="10%" valign="top"><font face="Courier New">=</font></td>				<td width="25%" valign="top"><font face="Courier New">((kb1+2*kb2)*aynm1kb2*aynm2+axn)/(1+kb1+</font></td>				<td width="25%" valign="top"><font face="Courier New">kb2)</font></td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier New">aynm2</font></td>				<td width="10%" valign="top"><font face="Courier New">=</font></td>				<td width="25%" valign="top"><font face="Courier New">aynm1</font></td>				<td width="25%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier New">aynm1</font></td>				<td width="10%" valign="top"><font face="Courier New">=</font></td>				<td width="25%" valign="top"><font face="Courier New">ayn</font></td>				<td width="25%" valign="top">&nbsp;</td>			</tr>		</table>		</p>		<p><font face="Times New Roman">Unfortunately the difference equation only approximates the differential equation. Numerical methods could be used to solve the equation to any degree of precision but this would be computationally expensive. The more common approach is to adjust the coefficients to give a similar response. For the difference equation</font></p>		<p><font face="Times New Roman"><img src="figures/eq07.jpg" sgi_src="/tmp_mnt/home/bull6/hpm/reality/classic/image28.gif" sgi_native_src="/tmp_mnt/home/bull6/hpm/reality/classic/image28.gif"> (10.7)</font></p>		<p><font face="Times New Roman">the frequency response is:</font></p>		<p><font face="Times New Roman"><img height="48" width="559" src="figures/eq08.jpg">(10.8)</font></p>		<p><font face="Times New Roman">Note that <img src="figures/eq09.jpg" sgi_src="/tmp_mnt/home/bull6/hpm/reality/classic/image30.gif" sgi_native_src="/tmp_mnt/home/bull6/hpm/reality/classic/image30.gif">.(10.9)</font></p>		<p><font face="Times New Roman">The following relationships were determined empirically to produce fairly independent response of frequency and resonance throughout a useful range of these parameters.</font></p>		<p><font face="Times New Roman"><img height="38" width="344" src="figures/eq10.jpg"> (10.10)</font></p>		<p><font face="Times New Roman"><img height="44" width="355" src="figures/eq11.jpg">(10.11)</font></p>		<p><font face="Times New Roman">Where:</font></p>		<ul>			<p><font face="Times New Roman"><i>Q</i></font><font face="Times New Roman"> is resonance</font><font face="Courier New"> and </font><font face="Times New Roman"><img src="figures/33.jpg" sgi_src="/tmp_mnt/home/bull6/hpm/reality/classic/image33.gif" sgi_native_src="/tmp_mnt/home/bull6/hpm/reality/classic/image33.gif"></font><font face="Times New Roman"> is cut-off frequency. This can be written in Csound as:</font></p>		</ul>		<p>		<table cellspacing="0" border="0" cellpadding="0" width="209">			<tr>				<td width="33%" valign="top"><font face="Courier New">kb1</font></td>				<td width="10%" valign="top"><font face="Courier New">=</font></td>				<td width="33%" valign="top"><font face="Courier New">100/irez/sqrt(kfco)</font></td>			</tr>			<tr>				<td width="33%" valign="top"><font face="Courier New">kb2</font></td>				<td width="10%" valign="top"><font face="Courier New">=</font></td>				<td width="33%" valign="top"><font face="Courier New">1000/kfco</font></td>			</tr>		</table>		</p>		<p><font face="Times New Roman">This completes the basic two pole filter.</font></p>		<p><font face="Times New Roman">Some modifications of the filter will be considered next. The Roland TB-303 is a much sought after synthesizer due to its unique sound. This is in part due to the unusual character of its filter. It has been suggested that one of the aspects of this filter which make it unique is the circuitry which prevents the filter from going into self oscillation. When resonance is increased the filter distorts instead of self oscillating. This type of behavior can be simulated in Csound by doing the following. Isolate the resonating portion of the signal and pass it through a distortion table. Add the distorted signal to a low pass filtered original signal. The following section of Csound code accomplishes this.</font></p>		<p><a href="../../instruments/10/1007.orc"><font face="Times New Roman">1007.orc</font></a><font face="Times New Roman"><br>		<a href="../../instruments/10/1007.sco">1007.sco</a></font></p>		<p>		<table cellspacing="0" border="0" cellpadding="0" width="332">			<tr>				<td width="16%" valign="top"><font face="Courier New">atemp</font></td>				<td width="16%" valign="top"><font face="Courier New">tone</font></td>				<td width="17%" valign="top"><font face="Courier New">axn, kfco</font></td>			</tr>			<tr>				<td width="16%" valign="top"><font face="Courier New">aclip1</font></td>				<td width="16%" valign="top"><font face="Courier New">=</font></td>				<td width="17%" valign="top"><font face="Courier New">(aynatemp)/100000</font></td>			</tr>			<tr>				<td width="16%" valign="top"><font face="Courier New">aclip</font></td>				<td width="16%" valign="top"><font face="Courier New">tablei</font></td>				<td width="17%" valign="top"><font face="Courier New">aclip1, 7, 1, .5</font></td>			</tr>			<tr>				<td width="16%" valign="top"><font face="Courier New">aout</font></td>				<td width="16%" valign="top"><font face="Courier New">=</font></td>				<td width="17%" valign="top"><font face="Courier New">aclip*20000+atemp</font></td>			</tr>		</table>		</p>		<p><font face="Times New Roman">This produces an interesting sound with some of the character of the TB-303.</font></p>		<p><font face="Times New Roman">Extension of the above techniques to higher order filters presents some problems. As the order of the equations increases the coefficients become extremely sensitive to small changes and round off errors. One form of higher order filters that does not have this defect is called the cascade form. The following Csound code implements the cascade form to obtain a four pole filter.</font></p>		<p>		<table cellspacing="0" border="0" cellpadding="0" width="478">			<tr>				<td width="15%" valign="top"><font face="Courier New">ayn1</font></td>				<td width="10%" valign="top"><font face="Courier New">=</font></td>				<td width="25%" valign="top"><font face="Courier New">((ka1+2*ka2)*ayn1m1ka2*ayn1m2+axn)/(1+ka1+ka2)</font></td>				<td width="25%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="15%" valign="top"><font face="Courier New">ayn1m2</font></td>				<td width="10%" valign="top"><font face="Courier New">=</font></td>				<td width="25%" valign="top"><font face="Courier New">ayn1m1</font></td>				<td width="25%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="15%" valign="top"><font face="Courier New">ayn1m1</font></td>				<td width="10%" valign="top"><font face="Courier New">=</font></td>				<td width="25%" valign="top"><font face="Courier New">ayn1</font></td>				<td width="25%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="15%" valign="top"><font face="Courier New">ayn</font></td>				<td width="10%" valign="top"><font face="Courier New">=</font></td>				<td width="25%" valign="top"><font face="Courier New">((kb1+2*kb2)*ayn2m1kb2*ayn2m2+ayn1)/(1+kb1+</font></td>				<td width="25%" valign="top"><font face="Courier New">kb2)</font></td>			</tr>			<tr>				<td width="15%" valign="top"><font face="Courier New">ayn2m2</font></td>				<td width="10%" valign="top"><font face="Courier New">=</font></td>				<td width="25%" valign="top"><font face="Courier New">ayn2m1</font></td>				<td width="25%" valign="top">&nbsp;</td>			</tr>			<tr>				<td width="15%" valign="top"><font face="Courier New">ayn2m1</font></td>				<td width="10%" valign="top"><font face="Courier New">=</font></td>				<td width="25%" valign="top"><font face="Courier New">ayn</font></td>				<td width="25%" valign="top">&nbsp;</td>			</tr>		</table>		</p>		<p><font face="Times New Roman">This technique can be extended to obtain higher order filters.</font></p>		<h3><font face="Times New Roman"><b>Discussion</b></font></h3>		<p><font face="Times New Roman">The presented filters provide a very useful basis for future work in simulating analog synthesizers. Some future things to try would be to modify the distortion table in the distortion filter to have unusual shapes. Development of more complex waveforms such as a synched oscillator or a sample and hold waveform would also be interesting. Waveforms with sharp edges stimulate the resonance aspect of the filter and may result in more interesting timbres. High pass and band-pass filters could be developed using the methodology described in this section.</font></p>		<h2><font face="Times New Roman"><b>References</b></font></h2>		<p><font face="Times New Roman">Rossing, Thomas D., <i>The Science of Sound</i>. Reading Massachusetts: Addison-Wesley Publishing Company, Inc., 1982, 488-490, 495.</font></p>		<p><font face="Times New Roman">Baker, B., <i>Hammond Leslie FAQ. </i>http://wcbi.com/organs/hammond/faq/.</font></p>		<p><font face="Times New Roman">Henricksen, C.<i> </i>&quot;Unearthing the Mysteries of the Leslie Cabinet&quot;, <i>Recording Engineer/Producer Magazine</i>, April 1981. http://wcbi.com/organs/hammond/faq/mystery/mystery.html</font></p>		<p><font face="Times New Roman">Oppenheim, A., Willsky A., with Young, I. <i>Signals and Systems.</i> Englewood Cliffs, N.J.: Prentice-Hall, 1983. 232-239, 345-351.</font>	</body></html>