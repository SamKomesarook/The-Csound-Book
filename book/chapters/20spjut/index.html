<html>	<head>		<meta http-equiv="content-type" content="text/html;charset=iso-8859-1">		<meta name="generator" content="Adobe GoLive 4">		<title>An Introduction to Signal Processing with Csound</title>	</head>	<body bgcolor="white">		<h1><font face="Times New Roman" size="4"><b>20. An Introduction to Signal Processing with Csound</b></font></h1>		<h2><font face="Times New Roman" size="4"><b>R. Erik Spjut</b></font></h2>		<p><font face="Times New Roman" size="4">Click <a href="chapter20.zip">HERE</a> to download chapter instruments.</font></p>		<div align="left">			<p><font face="Times New Roman" size="4">Signal Processing has become a vital part of a modern engineer&#146;s vocabulary. From earthquake retrofitting to direct-from-satellite TV broadcasts to chemical-process control, a knowledge of signal processing and dynamic systems has become essential to an engineer&#146;s education. However, learning signal processing is often a dull exercise in performing integrations, summations and complex arithmetic. Csound has a number of features that make it valuable as an adjunct to the traditional course work. First, it was designed from the ground up to follow the principles of digital signal processing, although this fact is probably hidden from the casual user. Second, hearing a swept filter or an aliased sine wave brings the signal processing concepts home in an immediate and visceral way.</font></p>		</div>		<div align="justify">			<p><font face="Times New Roman" size="4">This chapter is an attempt to introduce the student of signal processing to the powerful examples available in Csound. It is also an attempt to introduce the concepts of signal processing to the Csound practitioner in the hopes that you will better understand why Csound does what it does and also be better able to make Csound do what you want.</font></p>		</div>		<div align="justify">			<p><font face="Times New Roman" size="4">Because all of the topics are interrelated, occasional use or mention is made of later topics in the derivation of earlier topics. I have tried to keep the order of presentation such that these forward references are minimized.</font></p>		</div>		<div align="justify">			<p><font face="Times New Roman" size="4">Even though Csound is very powerful, it will not do every sort of calculation that you might desire. Often you need to do some sort of symbolic or numeric calculation to figure out what values to use in Csound. These sorts of calculations are best done using a program like <i>Mathematica</i>, <i>Maple</i>, <i>MathCAD</i>, or <i>Matlab</i>. I have given some examples of these sorts of calculations using <i>Mathematica</i> to assist the interested reader. Just as you do not really need to know how to do long divisions in order to use a calculator, you do not really need to know calculus to use <i>Mathematica</i> to integrate.</font></p>		</div>		<h2><font face="Times New Roman" size="4"><b>Mathematical Conventions</b></font></h2>		<h3><font face="Times New Roman" size="4"><b>Variables</b></font></h3>		<div align="justify">			<p><font face="Times New Roman" size="4">A <i>variable</i> is a symbol for a quantity or thing that can change or vary. Common variables in algebra are <i>x</i> and <i>y</i>. Some of the variables used in this chapter are <i>t</i> (usually stands for time), <i>T</i> (a time interval or period), <i>f</i> (frequency of a continuous signal) and <i>F</i> (frequency of a discrete signal).</font></p>		</div>		<h3><font face="Times New Roman" size="4"><b>Functions</b></font></h3>		<div align="justify">			<p><font face="Times New Roman" size="4">A <i>function</i> is the way one variable depends on (or relates to) another variable, <i>e.g.</i> in the equation:</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq01.jpg" width="477" height="24"></font><font face="Courier New">(20.1)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<p><font face="Times New Roman" size="4">The variable <i>y</i> is a function of the variable <i>x</i>. The function says &#145;take whatever value <i>x</i> presently has, multiply it by three and add five to that result.&#146; That final result is the present value of <i>y</i>. Often, when one variable such as <i>y</i> is a function of another variable, such as <i>t</i> or <i>n</i>, but we do not know (or care) exactly what the function is, we write <i>y(t)</i> or <i>y[u]</i>. In spoken language we would read <i>y(t)</i> as <i>y-of-t</i> and <i>y[n]</i> as <i>y-of-n</i>. Three of the most common functions in signal processing are the <i>sine</i> of <i>x</i> (written as sin <i>x</i>), the <i>cosine</i> of <i>x</i> (written as cos <i>x</i>) and the <i>exponential</i> of <i>x</i> (written as <i>e</i><sup>x</sup> or exp <i>x</i>). A function where <i>y(-t) = y(t)</i> (like <i>y(t) = t</i><sup>2</sup>) is called an <i>even</i> function. A function where <i>y(-t) = -y(t)</i> (like <i>y(t) = t</i>) is called an <i>odd</i> function. Many functions are neither even nor odd.</font></p>		<h3><font face="Times New Roman" size="4"><b>Independent and Dependent Variables</b></font></h3>		<div align="justify">			<p><font face="Times New Roman" size="4">If a variable is not a function of another variable it is called an <i>independent variable</i>, because it can vary in any way it pleases. If a variable <i>is</i> a function of another variable, it is called a <i>dependent variable</i>, because its value depends on the value of some other variable. In signal processing, in addition to being either independent or dependent, our variables are often <i>complex</i>.</font></p>		</div>		<h3><font face="Times New Roman" size="4"><b>Complex Numbers</b></font></h3>		<div align="justify">			<p><font face="Times New Roman" size="4">A <i>complex number</i> is a mathematical shorthand for combining two independent numbers into one symbol. If the two independent numbers in our complex number are <i>a</i> and <i>b</i>, mathematicians would write the complex number as <i>a + ib</i> and engineers would write it as <i>a + jb</i>. For historical reasons, <i>a</i> is called the real part and <i>b</i> is called the imaginary part and <i>i</i> or <i>j</i> is called the <i>imaginary unit</i>. It is defined by<i> j<sup>2 </sup>= -1</i>. Engineers use <i>j</i> as the imaginary unit instead of <i>i</i>, because <i>i</i> is reserved for current. <i>Mathematica</i> uses 'I' for the imaginary unit.</font></p>		</div>		<h3><font face="Times New Roman" size="4"><b>Complex Addition and Subtraction</b></font></h3>		<div align="justify">			<p><font face="Times New Roman" size="4">If we have two complex numbers <i>a + jb</i> and <i>c + jd</i>, we can define the relationships for addition as the sum of the real parts and the sum of the imaginary parts:</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/02.jpg" width="477" height="31"></font><font face="Courier New">(20.2)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">and subtraction as the difference of the real parts and the difference of the imaginary parts:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/03.jpg" width="477" height="31"></font><font face="Courier New">(20.3)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<h3><font face="Times New Roman" size="4"><b>Polar Form</b></font></h3>		<div align="justify">			<p><font face="Times New Roman" size="4">If we think of a complex number as a point on a Cartesian coordinate system (a rectangular graph) we can define the distance from the origin to the complex number as the <i>magnitude</i> or absolute value of the complex number:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/04.jpg" width="477" height="31"></font><font face="Courier New">(20.4)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<p><font face="Times New Roman" size="4"><img src="figures/fig01.jpg" width="380" height="371"></font></p>		<p><font face="Times New Roman"><b>Figure 20.1</b></font><font face="Times New Roman"> A complex number in both Cartesian and Polar form.</font><font face="Times New Roman" size="4"><br>		</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">We can think of the angle between the positive <i>x</i>-axis and the line segment from the origin to the complex number as the <i>angle</i> (also known as the <i>phase angle</i>, or the <i>phase</i> or the <i>argument</i>) of the complex number:</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/05.jpg" width="506" height="42"></font><font face="Courier New">(20.5)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">The function <i>arctan</i> is the arctangent. It means the-angle-whose-tangent-is).</font></p>		</div>		<div align="justify">			<p><font face="Times New Roman" size="4">A complex number expressed as a magnitude and an angle is said to be in polar form. For signal processing it is usually most convenient to write the magnitude as <i>r</i> and the angle as <img src="figures/theta.jpg" width="16" height="17">, so that our complex number becomes<img height="17" width="31" src="figures/re.jpg">, where <i>r<sup>2</sup> = a<sup>2</sup> + b<sup>2</sup></i> and <img src="figures/tan1.jpg" width="84" height="17">.</font></p>		</div>		<h3><font face="Times New Roman" size="4"><b>Complex Multiplication and Division</b></font></h3>		<div align="justify">			<p><font face="Times New Roman" size="4">With two complex numbers, <img src="figures/r1.jpg" width="47" height="25"> and <img src="figures/r2.jpg" width="47" height="28">, in polar form, we can define multiplication as the product of the magnitudes and the sum of the angles:</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq06.jpg" width="508" height="45"></font><font face="Courier New">(20.6)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">We can define division as the ratio of the magnitudes and the difference of the angles:</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq07.jpg" width="508" height="74"></font><font face="Courier New">(20.7)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">There are formulas for multiplication and division using <i>a</i> and <i>b</i> instead of <i>r</i> and <img src="figures/theta2.jpg" width="16" height="16">, but they usually make calculations much harder.</font></p>		</div>		<h3><font face="Times New Roman" size="4"><b>Complex Variables</b></font></h3>		<div align="justify">			<p><font face="Times New Roman" size="4">By analogy with complex numbers, the <i>complex variable</i> <i>z</i> contains two normal (real) variables <i>x</i> and <i>y</i>:</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq08.jpg" width="508" height="23"></font><font face="Courier New">(20.8)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">Again we call <i>x</i> the real part and <i>y</i> the imaginary part. We can (and usually do) express complex variables in polar form:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq09.jpg" width="508" height="23"></font><font face="Courier New">(20.9)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">Where <img src="figures/r=sqr.jpg" width="83" height="27">and <img src="figures/theta=arct.jpg" width="94" height="20">, but <i>r</i> and <img src="figures/theta2.jpg" width="16" height="16"> are now variables instead of numbers.</font></p>		</div>		<h3><font face="Times New Roman" size="4"><b>Complex Functions</b></font></h3>		<div align="justify">			<p><font face="Times New Roman" size="4">A <i>complex function</i> or a function of a complex variable is made up of two normal functions, again a real part and an imaginary part. As an example, let us look at the function <i>e<sup>z</sup></i>, since it is used so frequently in signal processing (we got ahead of ourselves and already used part of it in our definition of polar form).</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq10.jpg" width="565" height="26"></font><font face="Courier New">(20.10)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">So the real part of <i>e<sup>z</sup></i> is the product of the exponential of <i>x</i> and the cosine of <i>y</i>, <i>e<sup>x</sup> cos y</i> and the imaginary part is the product of the exponential of <i>x</i> and the sine of <i>y,</i> <i>e<sup>x</sup> sin y</i>. In terms of polar form the magnitude of <i>e<sup>z</sup></i> is <i>e<sup>x</sup></i> and the angle is <i>y</i></font><font face="Times New Roman" size="4">. It may be worth noting that <i>Mathematica</i> treats almost all variables and functions as being complex. For example, <i>Mathematica</i> will evaluate Exp[I Pi/2] or Exp[3 + 2 I] as readily as Sin[Pi/2].</font></p>		</div>		<h3><font face="Times New Roman" size="4"><b>Summation</b></font></h3>		<div align="justify">			<p><font face="Times New Roman" size="4">The symbol:</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq11.jpg" width="565" height="52"></font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">is a summation symbol. It means to take the <i>index variable</i> (the variable on the bottom, usually <i>n</i>), let it take on all integer values from the starting index (the number on the bottom) to the ending index (the number on the top), substitute the integer into the main expression and add up the values of all of the substitutions.<br>			</font></p>		</div>		<div align="justify">			<p><font face="Times New Roman" size="4">For example,<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq12.jpg" width="565" height="52"></font></p>		</ul>		<p><font face="Times New Roman" size="4"><b>Integration and Differentiation</b></font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">The symbol:</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq13.jpg" width="565" height="33"></font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">is the integration symbol. Mathematicians usually define an integral in terms of limits and infinitesimal. It is usually adequate to think of an integral as the area between a real function and the <i>x</i>-axis. A large part of a calculus class is devoted to learning how to evaluate integrals of functions.</font></p>		</div>		<div align="justify">			<p><font face="Times New Roman" size="4"><i>Mathematica</i> will integrate a large number of functions symbolically (meaning the result is a function) and almost any function numerically (meaning the result is a number). For example, the integral of the sine of <i>x</i>, which is written:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq14.jpg" width="565" height="33"></font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">is evaluated symbolically in <i>Mathematica</i> as <i>Integrate[Sin[x],x]</i> and the integral of the cosine of <i>x</i> from 0 to <i>p</i>, which is written:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq15.jpg" width="565" height="50"></font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">is evaluated numerically in <i>Mathematica</i> as <i>Integrate[Cos[x],{x,0,Pi}].<br>			</i></font></p>		</div>		<div align="justify">			<p><font face="Times New Roman" size="4">The symbol:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq16.jpg" width="565" height="50"></font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">is the derivative of the function <i>y</i> with respect to the variable <i>x</i>. Mathematicians again define derivatives in terms of limits and infinitesimal. It is usually adequate to think of a derivative as the slope of a function. A small part of a calculus class is devoted to learning how to take derivatives of functions.</font></p>		</div>		<div align="justify">			<p><font face="Times New Roman" size="4"><i>Mathematica</i> will evaluate the derivative of almost any function. For example, the derivative of the cosine of <i>x</i> with respect to <i>x</i>, which is written:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq17.jpg" width="565" height="50"></font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">is evaluated in <i>Mathematica</i> by <i>D[Cos[x],x].<br>			</i></font></p>		</div>		<h2><font face="Times New Roman" size="4"><b>Signals</b></font></h2>		<div align="justify">			<p><font face="Times New Roman" size="4">A <i>signal</i> is a function of one or more independent variables. The purpose or use of a signal is to convey information. Examples of common signals are the voltage coming out of an audio amplifier, the Dow-Jones industrial average, the outside temperature, and the display on a computer screen, the output from a radio transmitter. Csound is structured for processing signals of a single independent variable, so we will restrict ourselves to signals that are a function of only one independent variable, either time or sample number.</font></p>		</div>		<h3><font face="Times New Roman" size="4"><b>Continuous Signals<br>		</b></font></h3>		<p><font face="Times New Roman" size="4"><img src="figures/053.gif" width="332" height="143"></font></p>		<p><font face="Times New Roman"><b>Figure 20.2</b></font><font face="Times New Roman"> A continuous-time signal.</font><font face="Times New Roman" size="4"><br>		</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">Signals are divided into two classes, <i>continuous-time</i> and <i>discrete-time</i>. Continuous-time signals have a value at any instant of time. Most physical phenomena, such as the temperature, sound, or a person&#146;s weight are continuous-time signals. Two continuous-time signals that are very important in signal processing are <img src="figures/sin2pift.jpg" width="66" height="23"> and <img src="figures/cos2pift.jpg" width="63" height="23">. Engineers often use the Euler formula as a shorthand notation for representing these two signals at the same time:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq18.jpg" width="541" height="35">(20.18)<br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">where <img src="figures/j=sq.jpg" width="54" height="22">. One can get back to sines and cosines with:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq19.jpg" width="495" height="53">(20.19)<br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">and:<br>			</font></p>		</div>		<p><font face="Times New Roman" size="4"><img src="figures/eq20.jpg" width="495" height="59" align="LEFT" hspace="9"></font></p>		<p><font face="Times New Roman" size="4">(20.20)<br>		</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">&nbsp;</font></p>		</div>		<h3><font face="Times New Roman" size="4"><b>Periodic Signals</b></font></h3>		<div align="justify">			<p><font face="Times New Roman" size="4">The signals <img src="figures/sin2pif0t.jpg" width="62" height="21">, <img src="figures/cos2pif0t.jpg" width="62" height="21"> and <img src="figures/ej2pi.jpg" width="46" height="23"> are all <i>periodic</i> signals, meaning that for some value <i><b>T</b></i>, the signal <i><b>x(t) = x(t+T)</b></i>. If <i>f<sub>0</sub></i> in <img src="figures/sin2pif0t.jpg" width="62" height="21">, <img src="figures/cos2pif0t.jpg" width="62" height="21">, or <img src="figures/ej2pi.jpg" width="46" height="23"> is not equal to 0, then the smallest positive value of <i><b>T</b></i> for which <i><b>x(t) = x(t+T)</b></i> is called the <i>fundamental period</i>, <i><b>T<sub>0</sub></b></i>. . <i><b>T<sub>0</sub></b></i> <b>= 1/|<i>f<sub>0</sub></i>|</b>. For an arbitrary periodic signal (where <i><b>x(t) = x(t+T)</b></i>), <i><b>f<sub>0</sub></b></i> is called the <i>fundamental frequency</i>.<br>			</font></p>		</div>		<p><font face="Times New Roman" size="4"><img src="figures/067.gif" width="328" height="141"></font></p>		<p><font face="Times New Roman"><b>Figure 20.3</b></font><font face="Times New Roman"> A periodic signal</font><font face="Times New Roman" size="4">.<br>		</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">In the abstract world of signals, a periodic signal like <img src="figures/sin2pif0t.jpg" width="62" height="21"> started before the dawn of time and goes on past the end of the universe. Those of us who are not deity do not have the patience to listen to such signals. Our signals have to have a start and an end. For us mere mortals, a reasonably long section of <img src="figures/sin2pif0t.jpg" width="62" height="21"> can be generated by:<br>			</font></p>		</div>		<p><font face="Times New Roman" size="4"><img src="figures/068.gif" width="111" height="223" hspace="9"></font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">&nbsp;</font><font face="Times New Roman"><b>Figure 20.4</b> Block diagram of <i>instr 2001</i>, a 440 Hz sinusoidal oscillator at full amplitude synthesized mathematically by solving for <i>sin(x).</i></font><font face="Times New Roman" size="4"><i><br>			</i></font></p>		</div>		<p><font face="Times New Roman" size="4">		<table cellspacing="0" border="0" width="477">			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td width="13%" valign="top"><a href="../../../references/manual_html/syntax/iblock.htm"><font face="Courier New">instr</font></a></td>				<td width="15%" valign="top"><a href="../../instruments/20/2001/2001.html"><font face="Courier New">2001</font></a></td>				<td width="61%" valign="top"><font face="Courier New">; 440 hz sine wave at full amp</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">itwopi</font></td>				<td width="13%" valign="top"><font face="Courier New">=</font></td>				<td valign="top" colspan="2"><font face="Courier New">2*3.141592653589793238</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">a1</font></td>				<td width="13%" valign="top"><a href="../../../references/manual_html/siggen/phasor.htm"><font face="Courier New">phasor</font></a></td>				<td valign="top" colspan="2"><font face="Courier New">440</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">a2</font></td>				<td width="13%" valign="top"><font face="Courier New">=</font></td>				<td valign="top" colspan="2"><font face="Courier New">32767*sin(itwopi*a1)</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td width="13%" valign="top"><a href="../../../references/manual_html/sigio/out.htm"><font face="Courier New">out</font></a></td>				<td valign="top" colspan="2"><font face="Courier New">a2</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td width="13%" valign="top"><a href="../../../references/manual_html/syntax/iblock.htm"><font face="Courier New">endin</font></a></td>				<td valign="top" colspan="2"><font face="Courier New">&nbsp;</font></td>			</tr>			<tr>				<td valign="top" colspan="4"><font face="Courier New">&nbsp;</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">i 2001</font></td>				<td width="13%" valign="top"><font face="Courier New">0</font></td>				<td valign="top" colspan="2"><font face="Courier New">5</font></td>			</tr>		</table>		</font><font face="Times New Roman"><b>Figure 20.5</b> Orchestra and score code for <i>instr 2001</i>, a sine wave synthesizer as shown in figure 20.4.</font><font face="Times New Roman" size="4"><br>		</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">Csound has some special facilities for generating periodic signals, but we need to wait for a little more background before we fully understand how they work. Let us listen to the examples first and then learn how they work.<br>			</font></p>		</div>		<p><font face="Times New Roman" size="4"><img src="figures/069.gif" width="91" height="119" hspace="9"></font></p>		<div align="justify">			<p><font face="Times New Roman"><b>Figure 20.6</b> Block diagram of <i>instr 2002</i>, a simple Csound oscillator instrument.</font><font face="Times New Roman" size="4"><br>			</font></p>		</div>		<p><font face="Times New Roman" size="4">		<table cellspacing="0" border="0" width="542">			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="5"><a href="../../../references/manual_html/syntax/iblock.htm"><font face="Courier New">instr</font></a></td>				<td valign="top" colspan="5"><a href="../../instruments/20/2002/2002.html"><font face="Courier New">2002</font></a></td>				<td width="61%" valign="top"><font face="Courier New">; simple 440hz oscillator</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">aprd</font></td>				<td valign="top" colspan="5"><a href="../../../references/manual_html/siggen/oscil.htm"><font face="Courier New">oscil</font></a></td>				<td valign="top" colspan="6"><font face="Courier New">32767, 440, p4</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="5"><a href="../../../references/manual_html/sigio/out.htm"><font face="Courier New">out</font></a></td>				<td valign="top" colspan="6"><font face="Courier New">aprd</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="11"><a href="../../../references/manual_html/syntax/iblock.htm"><font face="Courier New">endin</font></a></td>			</tr>			<tr>				<td valign="top" colspan="12"><font face="Courier New">&nbsp;</font></td>			</tr>			<tr>				<td valign="top" colspan="12"><font face="Courier New">; One period of a sine wave</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">f 1</font></td>				<td width="5%" valign="top"><font face="Courier New">0</font></td>				<td valign="top" colspan="3"><font face="Courier New">8192</font></td>				<td valign="top" colspan="2"><font face="Courier New">10</font></td>				<td valign="top" colspan="5"><font face="Courier New">1</font></td>			</tr>			<tr>				<td valign="top" colspan="12"><font face="Courier New">; One period of an approximate sawtooth wave</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">f 2</font></td>				<td width="5%" valign="top"><font face="Courier New">0</font></td>				<td valign="top" colspan="3"><font face="Courier New">8192</font></td>				<td valign="top" colspan="4"><font face="Courier New">10</font></td>				<td valign="top" colspan="3"><font face="Courier New">1 0.5 0.333 0.25 0.2 0.1667 0.1429 0.125 0.111 0.1</font></td>			</tr>			<tr>				<td valign="top" colspan="12"><font face="Courier New">; One period of an approximate square wave</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">f 3</font></td>				<td width="5%" valign="top"><font face="Courier New">0</font></td>				<td valign="top" colspan="3"><font face="Courier New">8192</font></td>				<td valign="top" colspan="5"><font face="Courier New">10</font></td>				<td valign="top" colspan="2"><font face="Courier New">1 0 0.333 0 0.2 0 0.1429 0 0.111 0</font></td>			</tr>			<tr>				<td valign="top" colspan="12"><font face="Courier New">; One period of an approximate triangle wave</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">f 4</font></td>				<td width="5%" valign="top"><font face="Courier New">0</font></td>				<td valign="top" colspan="3"><font face="Courier New">8192</font></td>				<td valign="top" colspan="3"><font face="Courier New">10</font></td>				<td valign="top" colspan="4"><font face="Courier New">1 0 -0.111 0 0.04 0 -0.0204 0 0.0123 0 -0.0083 0 0.0059</font></td>			</tr>			<tr>				<td valign="top" colspan="12"><font face="Courier New">&nbsp;</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">i 2002</font></td>				<td valign="top" colspan="2"><font face="Courier New">0</font></td>				<td width="4%" valign="top"><font face="Courier New">5</font></td>				<td valign="top" colspan="8"><font face="Courier New">1</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">i 2002</font></td>				<td valign="top" colspan="2"><font face="Courier New">6</font></td>				<td width="4%" valign="top"><font face="Courier New">5</font></td>				<td valign="top" colspan="8"><font face="Courier New">2</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">i 2002</font></td>				<td valign="top" colspan="2"><font face="Courier New">12</font></td>				<td width="4%" valign="top"><font face="Courier New">5</font></td>				<td valign="top" colspan="8"><font face="Courier New">3</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">i 2002</font></td>				<td valign="top" colspan="2"><font face="Courier New">18</font></td>				<td width="4%" valign="top"><font face="Courier New">5</font></td>				<td valign="top" colspan="8"><font face="Courier New">4</font></td>			</tr>		</table>		</font></p>		<p><font face="Times New Roman"><b>Figure 20.7</b></font><font face="Times New Roman"> Score code for <i>instr 2002</i> with function for sine, saw, square and triangle called consecutively by each note</font><font face="Times New Roman" size="4">.<br>		</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">Since for a periodic function, <i><b>x(t) = x(t+T)</b></i>, we do not really have to let time go from the start to the end, we can just let time run from 0 to <i><b>T</b></i> and then start over. If we have a new variable, say <i><b>t'</b></i>, defined as <i><b>t' = t/T</b></i>, then we can generate <i><b>x(t)</b></i> by letting <i><b>t'</b></i> run from 0 to 1 and then start over at 0.<br>			</font></p>		</div>		<h3><font face="Times New Roman" size="4"><b>Discrete Signals</b></font></h3>		<div align="justify">			<p><font face="Times New Roman" size="4">The other class of signals, discrete-time signals, only has values at fixed instants of time. For example, the closing value of the Dow Jones industrial average is a discrete-time signal which only has a value determined at the closing bell (4 p.m. Eastern Time). In between the closing bells, the closing value is undefined. In other words, it makes no sense to talk about the closing-bell value at noon. Discrete-time signals are often represented graphically as &quot;lollipop diagrams,&quot; where the height of the lollipop stick corresponds to the value of the signal at that time. The lollipop itself is meant to remind you that the function only has values at discrete points.</font></p>		</div>		<div align="justify">			<p><font face="Times New Roman" size="4">Because a discrete-time signal only has a value at discrete times, we can number these discrete times, <i>e.g.</i> <i>t<sub>0</sub>, t<sub>1</sub>, t<sub>2</sub>,</i> ... The values of the discrete-time signal, <i>x</i>, can then be represented as either <i>x(t<sub>0</sub>), x(t<sub>1</sub>), x(t<sub>2</sub>)</i>, ..., or <i>x[0], x[1], x[2]</i>, ..., where <i>x[n] = x(t<sub>n</sub>)</i> and <i>n</i> is called the <i>index variable</i>.</font></p>		</div>		<div align="justify">			<p><font face="Times New Roman" size="4">The natural representation of a signal in a computer is as a discrete-time signal. A computer has individual memory or storage locations, so the values of a discrete-time signal can be stored in successive memory locations. Csound has a lot of built-in facilities for generating and storing discrete-time signals.</font></p>		</div>		<p><font face="Times New Roman" size="4"><img src="figures/084.gif" width="252" height="197"></font></p>		<p><font face="Times New Roman"><b>Figure 20.8</b></font><font face="Times New Roman"> A discrete-time signal.</font><font face="Times New Roman" size="4"><br>		</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">The GEN routines (in the <i>.sco</i> file) all create discrete-time signals and store them in a section of memory known as a <i>table</i>. You use an <i>index</i> into a table to find a stored value of the function. You can store a complete discrete-time signal in the computer using a GEN routine and then generate the signal by indexing the table with the integers from 0 to <i>table</i>-<i>length</i>-1. Since tables can be of different lengths, it is sometimes easier to say you want a value halfway through the table or three-quarters of the way through the table, instead of at index 4095. The Csound opcode <a href="../../../references/manual_html/siggen/table.htm"><b>table</b></a> lets you access the table either way. The line:</font></p>		</div>		<p><font face="Times New Roman" size="4">		<table cellspacing="0" border="0" width="473">			<tr>				<td width="10%" valign="top"><font face="Courier New">a1</font></td>				<td width="14%" valign="top"><a href="../../../references/manual_html/siggen/table.htm"><font face="Courier New">table</font></a></td>				<td width="76%" valign="top"><font face="Courier New">73, 1, 0</font></td>			</tr>		</table>		</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">will assign <i>a1</i> the value at index 73 in function table (f-table) 1. The line:</font></p>		</div>		<p><font face="Times New Roman" size="4">		<table cellspacing="0" border="0" width="477">			<tr>				<td width="10%" valign="top"><font face="Courier New">a2</font></td>				<td width="14%" valign="top"><a href="../../../references/manual_html/siggen/table.htm"><font face="Courier New">table</font></a></td>				<td width="77%" valign="top"><font face="Courier New">0.25, 2, 1</font></td>			</tr>		</table>		</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">will assign <i>a2</i> the value one quarter of the way through f-table 2.</font></p>			<p><font face="Times New Roman" size="4">One advantage of <a href="../../../references/manual_html/siggen/table.htm"><b>table</b></a> is that you do not have to access the values in order. If you access the <a href="../../../references/manual_html/siggen/table.htm"><b>table</b></a> in reverse order, you will have the function going in reverse. You can access the <a href="../../../references/manual_html/siggen/table.htm"><b>table</b></a> in any sort of order and create a different signal for each order of access.</font></p>			<p><font face="Times New Roman" size="4">In order to access the entire <a href="../../../references/manual_html/siggen/table.htm"><b>table</b></a> you need some way to generate all of the integers from 0 to the <i>table-length</i>-1, at a fixed rate. The Csound opcode <a href="../../../references/manual_html/siggen/phasor.htm"><b>phasor</b></a> generates normalized indices (that run from 0 to 1) at a rate you specify. You can either multiply the output of <a href="../../../references/manual_html/siggen/phasor.htm"><b>phasor</b></a> by the <a href="../../../references/manual_html/siggen/table.htm"><b>table</b></a> length, or set it to use normalized indices. The <a href="../../../references/manual_html/siggen/phasor.htm"><b>phasor</b></a> opcode generates indices that run from 0 to 1 and then it resets back to 0 and repeats. It behaves just like we wanted our variable <i><b>t'</b></i> to behave.</font></p>			<p><font face="Times New Roman" size="4">There are two ways to change the frequency of a waveform stored in a table. You can change the length of time between samples, or you can change the number of samples skipped between times. Csound uses the latter approach. For example, if you keep the sampling rate the same, but only use every other sample, you double the frequency. If you use every third sample, you triple the frequency. That is essentially how <a href="../../../references/manual_html/siggen/phasor.htm"><b>phasor</b></a> works. It uses the specified frequency to determine the size of jump it will take in a <a href="../../../references/manual_html/siggen/table.htm"><b>table</b></a>.</font></p>			<p><font face="Times New Roman" size="4">We can create a discrete-time periodic signal by using the output of <a href="../../../references/manual_html/siggen/phasor.htm"><b>phasor</b></a> to index a table containing one period of our periodic signal. In fact, the Csound opcode <a href="../../../references/manual_html/siggen/oscil.htm"><b>oscil</b></a> combines a <a href="../../../references/manual_html/siggen/phasor.htm"><b>phasor</b></a> with a <a href="../../../references/manual_html/siggen/table.htm"><b>table</b></a>. To summarize, you can generate a discrete-time periodic signal in Csound by filling a <a href="../../../references/manual_html/siggen/table.htm"><b>table</b></a> with one period of a function and then using either a <a href="../../../references/manual_html/siggen/phasor.htm"><b>phasor</b></a> -<a href="../../../references/manual_html/siggen/table.htm"><b>table</b></a> pair or an <a href="../../../references/manual_html/siggen/oscil.htm"><b>oscil</b></a>.</font></p>			<p><font face="Times New Roman" size="4">A natural question then arises: How can one convert a discrete-time signal such as the output from Csound into a continuous signal, such as a sound? Or how can one convert a continuous-time signal such as a sound into a discrete-time signal, such as an <i>.aif</i> file? Under a very specific criterion, known as the <i>sampling theorem</i>, these tasks can be accomplished exactly, without the loss or addition of any information. But before we discuss the sampling theorem, we have a few additional topics to cover.</font></p>		</div>		<h2><font face="Times New Roman" size="4"><b>Fourier Series</b></font></h2>		<div align="justify">			<p><font face="Times New Roman" size="4">It was discovered long ago that any reasonable periodic signal (one that has a maximum value less than infinity and a finite number of wiggles or jumps in a period) can be represented as a weighted sum of integrally-related (meaning that the frequencies are related by integers) sines and cosines or complex exponentials. This weighted sum is known as a <i>Fourier series</i> and the weightings are known as the <i>Fourier coefficients</i>. Mathematically, the periodic signal<i><b> x(t)</b></i> is given by the sum:</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq21.jpg" width="566" height="59"></font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">where the summation is the Fourier series and the <i><b>a</b><sub>k</sub></i> are the Fourier coefficients. If the periodic function is an even function, the complex exponentials can be rewritten as cosines:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq22.jpg" width="566" height="60"></font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">If the periodic function is an odd function, the complex exponentials can be rewritten as sines:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq23.jpg" width="566" height="60"></font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">&nbsp;The <img src="figures/088.gif" width="11" height="13"> can be calculated by evaluating the integral of the product of the function and the appropriate complex exponential over one period and dividing by the period. Mathematically:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq24.jpg" width="566" height="60"></font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">A set of sines, cosines or complex exponentials, where the frequencies are related by <i><b>f</b><sub>k</sub></i> = <i><b>kf</b><sub>0</sub></i>, where <img height="16" width="130" src="figures/k=0+-.jpg">are said to be <i>harmonically related</i> and the individual terms are called the <i>harmonics</i> or <i>partials</i>. The terms where <img src="figures/k=+-01.jpg" width="47" height="16"> are called the fundamental harmonic or fundamental. The terms where <img src="figures/k=+-2.jpg" width="47" height="16"> are called the second harmonic or second partial. The terms where <img src="figures/k=+-3.jpg" width="47" height="16"> are called the third harmonic or third partial and so forth. Much of the tone quality or timbre of a musical note is governed by the number and relative strengths of the harmonics in the note. As an interesting side-note: the <i><b>a</b><sub>k</sub></i> can be thought of as a discrete-time signal.</font></p>			<p><font face="Times New Roman" size="4">The Csound function generators, GEN9, GEN10 and GEN19 are designed to create a table with one period of a periodic function from the Fourier coefficients. They differ in the amount of detail you have to specify about each harmonic. As an example, a sawtooth wave (which is an odd function) has the following Fourier series:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq25.jpg" width="465" height="50"></font><font face="Courier New">(20.25)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">and the Fourier coefficients are given by:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq26.jpg" width="465" height="50"></font><font face="Courier New">(20.26)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">Since the GEN routines automatically rescale the functions, we can ignore the <img height="20" width="33" src="figures/2divpi.jpg"> and just use 1/<i>k</i> as the Fourier coefficients. The first ten coefficients are 1, 1/2, 1/3, 1/4, 1/5, 1/6, 1/7, 1/8, 1/9 and 1/10. The more terms we include, the closer we get to a sawtooth wave. In Csound we would include the following line in the score file to create a table with one period of an approximate sawtooth wave.<br>			</font></p>		</div>		<p><font face="Times New Roman" size="4">		<table cellspacing="0" border="0" width="557">			<tr>				<td width="7%" valign="top"><font face="Courier New">f 2</font></td>				<td width="5%" valign="top"><font face="Courier New">0</font></td>				<td width="10%" valign="top"><font face="Courier New">16384</font></td>				<td width="7%" valign="top"><font face="Courier New">10</font></td>				<td width="71%" valign="top"><font face="Courier New">1 0.5 0.3333 0.25 0.2 0.1667 0.1429 0.125 0.1111 0.1</font></td>			</tr>		</table>		</font></p>		<p><font face="Times New Roman" size="4"><img src="figures/099.gif" width="268" height="210"></font></p>		<p><font face="Times New Roman"><b>Figure 20.9</b></font><font face="Times New Roman"> Sawtooth Fourier coefficients.<br>		</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">Other common periodic signals are the square wave:<br>			</font></p>		</div>		<div align="justify">			<p><font face="Times New Roman" size="4">&nbsp;</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq27.jpg" width="506" height="66"></font><font face="Courier New">(20.27)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<p><font face="Times New Roman" size="4">		<table cellspacing="0" border="0" width="473">			<tr>				<td width="10%" valign="top"><font face="Courier New">f 1</font></td>				<td width="9%" valign="top"><font face="Courier New">0</font></td>				<td width="14%" valign="top"><font face="Courier New">16384</font></td>				<td width="10%" valign="top"><font face="Courier New">10</font></td>				<td width="58%" valign="top"><font face="Courier New">1 0 0.3333 0 0.2 0 0.1429 0 0.1111 0</font></td>			</tr>		</table>		</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">The triangle wave:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq28.jpg" width="506" height="66"> </font><font face="Courier New">(20.28)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<p><font face="Times New Roman" size="4">		<table cellspacing="0" border="0" width="608">			<tr>				<td width="6%" valign="top"><font face="Courier New">f 3</font></td>				<td width="5%" valign="top"><font face="Courier New">0</font></td>				<td width="10%" valign="top"><font face="Courier New">16384</font></td>				<td width="6%" valign="top"><font face="Courier New">10</font></td>				<td width="73%" valign="top"><font face="Courier New">1 0 -0.1111 0 0.04 0 -0.0204 0 0.0123 0 -0.0083 0 0.0059</font></td>			</tr>		</table>		</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">If your calculus is not really sharp, you can use a program such as <i>Mathematica</i> to calculate the Fourier coefficients for you. You still have to come up with an expression for one period of the periodic function. But <i>Mathematica</i> will then calculate the Fourier series and the Fourier coefficients.<br>			</font></p>		</div>		<p><font face="Times New Roman" size="4"><img src="figures/104.gif" width="268" height="214"></font></p>		<p><font face="Times New Roman"><b>Figure 20.10</b> Square wave Fourier coefficients.<br>		</font></p>		<p><font face="Times New Roman" size="4"><img src="figures/105.gif" width="268" height="201"></font></p>		<p><font face="Times New Roman"><b>Figure 20.11</b></font><font face="Times New Roman"> Triangle wave Fourier coefficients.<br>		</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">For example, one period of a sawtooth wave is described by <i><b>y = -(2x + 1)</b></i>. The following <i>Mathematica</i> commands will give you the first ten terms of the Fourier series and also give you the first ten coefficients.<br>			</font></p>		</div>		<ul>			<p><font face="Courier New">&lt;&lt;Calculus 'Fourier Transform'<br>			y=-(2x-1)<br>			FourierTrigSeries[y,{x,0,1},10]<br>			Table[Pi/2 FourierSinSeriesCoefficient[y,{x,0,1},n],{n,1,10}]<br>			</font></p>		</ul>		<h3><font face="Times New Roman" size="4"><b>The Fourier Transform</b></font></h3>		<div align="justify">			<p><font face="Times New Roman" size="4">Not all signals are periodic. It turns out that even aperiodic continuous-time signals can be constructed from the sum of sines and cosines or complex exponentials. However, we need the weighted sum of sines and cosines or complex exponentials at all possible frequencies, instead of at just harmonically related frequencies. The mathematical way to sum lots of little bits right next to each other is to integrate. Instead of the discrete <i><b>a<sub>k</sub></b></i> we had for the Fourier series, we now have a continuous function of frequency, so the continuous-time signal <i><b>x( t )</b></i> can be constructed from the weighted sum of all frequencies with the weighting function being <i><b>X( f )</b></i>, <i>i.e.</i>:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img height="63" width="418" src="figures/eq29.jpg"></font><font face="Courier New">(20.29)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">&nbsp;We can evaluate <i><b>X( f )</b></i> from <i><b>x( t )</b></i> with the formula:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img height="63" width="418" src="figures/eq30.jpg"></font><font face="Courier New">(20.30)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">The equation for calculating <i><b>X( f )</b></i> is called the <i>Fourier Transform</i>. The equation for reconstructing <i><b>x( t )</b></i> from <i><b>X( f )</b></i> is called the <i>Inverse Fourier Transform</i>. The importance for us in these transforms is that we now have two ways of looking at a continuous-time signal. We can look at it as a function of time (<i>time domain</i>), or as a function of frequency (<i>frequency domain</i>). Since humans hear the pitches of notes as a function of frequency and not as functions of time, the frequency domain is often a valuable place to examine musical signals.<br>			</font></p>			<p><font face="Times New Roman" size="4">Plotted below is the function:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq31.jpg" width="506" height="49"></font><font face="Courier New">(20.31)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">&nbsp;and its Fourier transform. The plots were generated with <i>Mathematica</i> from the following instructions:<br>			</font></p>		</div>		<ul>			<ul>				<p><font face="Courier New">&lt;&lt;Calculus`FourierTransform`<br>				foft=UnitStep[t]Exp[-t]<br>				fofw=FourierTransform[foft,t,w]<br>				foff=fofw/.w-&gt;2 Pi f<br>				Plot[foft,{t,-5,5}]<br>				Plot[Abs[foff],{f,-5,5}]<br>				Plot[Arg[foff],{f,-5,5}]<br>				</font></p>			</ul>		</ul>		<p><font face="Times New Roman" size="4"><img src="figures/112.gif" width="342" height="216"></font></p>		<p><font face="Times New Roman"><b>Figure 20.12</b></font><font face="Times New Roman"> The function of time.</font><font face="Times New Roman" size="4"><br>		</font></p>		<p><font face="Times New Roman" size="4"><img src="figures/113.gif" width="342" height="216"></font></p>		<p><font face="Times New Roman"><b>Figure 20.13</b> The magnitude of its Fourier transform.</font><font face="Times New Roman" size="4"><br>		</font></p>		<p><font face="Times New Roman" size="4"><img src="figures/114.gif" width="342" height="216"></font></p>		<p><font face="Times New Roman"><b>Figure 20.14</b></font><font face="Times New Roman"> The phase of its Fourier transform</font><font face="Times New Roman" size="4">.<br>		</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">For discrete-time or sampled signals, the discrete-time Fourier transform is calculated as:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq32.jpg" width="506" height="59"></font><font face="Courier New">(20.32)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">where the frequency <i><b>F</b></i> is given as a fraction of the sampling frequency. <i><b>X( F )</b></i> is a continuous periodic function with a period of 1. The inverse transform is:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq33.jpg" width="506" height="59"></font><font face="Courier New">(20.33)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">The integration is performed over any range of <i><b>F</b></i> with a length of 1, <i>e.g.</i> 0 to 1 or -1/2 to 1/2. We will make use of both of these formulas in the section on filters.</font></p>		</div>		<div align="justify">			<p><font face="Times New Roman" size="4">Because the Fourier transform can consist of complex numbers, it is customary to plot functions in the frequency domain as a plot of magnitude (or absolute value) versus frequency and phase (or phase angle or argument) versus frequency. Csound has a built-in function for plotting the magnitude of a Fourier transform but not the phase. The opcode <a href="../../../references/manual_html/sigio/print.htm"><b>dispfft</b></a> and the analysis program <a href="../../../references/manual_html/utility/pvanal.htm"><b>pvanal</b></a> use the <i>Fast Fourier Transform</i> (FFT), which is a very efficient method for calculating a sampled version of the discrete-time Fourier transform.</font></p>		</div>		<h2><font face="Times New Roman" size="4"><b>The Impulse</b></font></h2>		<div align="justify">			<p><font face="Times New Roman" size="4">An aperiodic signal with a special place in signal processing is the <i>impulse</i>, <img src="figures/deltat.jpg" width="30" height="23">. A continuous-time impulse is a strange limiting case of taking a signal, like a rectangular pulse and making it narrower and narrower, while increasing the height in such a way that the area remains constant. The true impulse (like the ideal fashion model) is infinitely tall and infinitely thin but has an area of 1. The discrete-time impulse, <img src="figures/deltan.jpg" width="34" height="20">, is much simpler. It is a single sample of value 1 surrounded by zeros.</font></p>			<p><font face="Times New Roman" size="4">The impulse has several properties that make it useful. The first is its sampling property. You can find the value of a function at a given time <img src="figures/t0.jpg" width="20" height="19"> or index <img src="figures/n0.jpg" width="20" height="19">, with the following formulas: the integral (or sum) of the product of the impulse and a function is the value of the function at the impulse&#146;s time, <i>i.e.</i>:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq34.jpg" width="383" height="50"></font><font face="Courier New">(20.34)</font><font face="Times New Roman" size="4"><br>			</font></p>			<p><font face="Times New Roman" size="4">or</font></p>			<p><font face="Times New Roman" size="4"><img src="figures/eq35.jpg" width="383" height="50"></font><font face="Courier New">(20.35)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">This property is most useful in designing FIR filters (described below). The second property is the impulse&#146;s frequency content. The Fourier transform of the impulse is a constant, <i>i.e</i>.:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/124.gif" width="7" height="13"><img src="figures/eq36.jpg" width="383" height="61"></font><font face="Courier New">(20.36)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">or</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq37.jpg" width="420" height="61"></font><font face="Courier New">(20.37)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<p><font face="Times New Roman" size="4">In other words, an impulse contains all possible frequencies in equal strength. That property makes it ideal for testing filters and evaluating their performance.</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">&nbsp;<img src="figures/15.jpg" width="398" height="170"></font></p>			<p><font face="Times New Roman" size="4">&nbsp;</font></p>		</div>		<p><font face="Times New Roman"><b>Figure 20.15</b></font><font face="Times New Roman"> The discrete-time impulse.</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">&nbsp;</font></p>			<p><font face="Times New Roman" size="4">&nbsp;<img src="figures/16.jpg" width="398" height="261"></font></p>		</div>		<p><font face="Times New Roman"><b>Figure 20.16</b></font><font face="Times New Roman"> The Fourier transform of the discrete-time impulse.</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">You cannot really hear an impulse. But you can hear the impulse response of your computer and sound system (I will explain what an impulse response is a little later). The following Csound code will generate an impulse to let you hear the impulse response of your computer and sound system.<br>			</font></p>		</div>		<p><font face="Times New Roman" size="4"><img src="figures/127.gif" width="305" height="191"></font></p>		<p><font face="Times New Roman"><b>Figure 20.17</b> Block diagram of <i>instr 2003</i>, an instrument which generates an impulse and displays it in both the time and frequency domains to let you hear and measure the impulse response of your system</font><font face="Times New Roman" size="4">.<br>		</font></p>		<p><font face="Times New Roman" size="4">		<table cellspacing="0" border="0" width="774">			<tr>				<td width="8%" valign="top"><font face="Courier New">kr</font></td>				<td width="8%" valign="top"><font face="Courier New">=</font></td>				<td valign="top" width="20%"><font face="Courier New">44100</font></td>				<td width="31%" valign="top"><font face="Courier New">; Avoid problems.</font></td>				<td width="31%" valign="top"></td>			</tr>			<tr>				<td width="8%" valign="top"></td>				<td width="8%" valign="top"></td>				<td valign="top" width="20%"></td>				<td width="31%" valign="top"></td>				<td width="31%" valign="top"></td>			</tr>			<tr>				<td width="8%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" width="8%"><a href="../../../references/manual_html/syntax/iblock.htm"><font face="Courier New">instr</font></a></td>				<td valign="top" width="20%"><a href="../../instruments/20/2003/2003.html"><font face="Courier New">2003</font></a><font face="Courier New"> </font></td>				<td width="31%" valign="top"><font face="Courier New">; SINGLE IMPULSE</font></td>				<td valign="top" width="31%"></td>			</tr>			<tr>				<td width="8%" valign="top"><font face="Courier New">idur1</font></td>				<td width="8%" valign="top"><font face="Courier New">=</font></td>				<td valign="top" width="20%"><font face="Courier New">7/sr</font></td>				<td width="31%" valign="top"><font face="Courier New">; Read the table once.</font></td>				<td width="31%" valign="top"></td>			</tr>			<tr>				<td width="8%" valign="top"><font face="Courier New">idur2</font></td>				<td width="8%" valign="top"><font face="Courier New">=</font></td>				<td valign="top" width="20%"><font face="Courier New">1/sr</font></td>				<td width="31%" valign="top"></td>				<td width="31%" valign="top"></td>			</tr>			<tr>				<td width="8%" valign="top"><font face="Courier New">ifreq</font></td>				<td width="8%" valign="top"><font face="Courier New">=</font></td>				<td valign="top" width="20%"><font face="Courier New">sr/8</font></td>				<td width="31%" valign="top"><font face="Courier New">; Read the Table at one point per</font></td>				<td width="31%" valign="top"><font face="Courier New">sample.</font></td>			</tr>			<tr>				<td width="8%" valign="top"><font face="Courier New">a1</font></td>				<td valign="top" width="8%"><a href="../../../references/manual_html/siggen/line.htm"><font face="Courier New">linseg</font></a></td>				<td valign="top" colspan="3"><font face="Courier New">ifreq, idur1, ifreq, idur2, 0, 1, 0</font></td>			</tr>			<tr>				<td width="8%" valign="top"><font face="Courier New">a2</font></td>				<td width="8%" valign="top"><a href="../../../references/manual_html/siggen/oscil.htm"><font face="Courier New">oscil</font></a></td>				<td valign="top" width="20%"><font face="Courier New">32768, a1, 1</font></td>				<td width="31%" valign="top"><font face="Courier New">; Scale the amplitude so you can</font></td>				<td width="31%" valign="top"><font face="Courier New">hear it.</font></td>			</tr>			<tr>				<td width="8%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" width="8%"><a href="../../../references/manual_html/sigio/out.htm"><font face="Courier New">out</font></a></td>				<td valign="top" colspan="3"><font face="Courier New">a2</font></td>			</tr>			<tr>				<td width="8%" valign="top"></td>				<td width="8%" valign="top"><a href="../../../references/manual_html/sigio/print.htm"><font face="Courier New">display</font></a></td>				<td valign="top" width="20%"><font face="Courier New">a1, p3</font></td>				<td width="31%" valign="top"><font face="Courier New">; Display the impulse response.</font></td>				<td width="31%" valign="top"></td>			</tr>			<tr>				<td width="8%" valign="top"></td>				<td width="8%" valign="top"><a href="../../../references/manual_html/sigio/print.htm"><font face="Courier New">dispfft</font></a></td>				<td valign="top" width="20%"><font face="Courier New">a1, p3, 4096, 0, 1</font></td>				<td width="31%" valign="top"><font face="Courier New">; Display the frequency response.</font></td>				<td width="31%" valign="top"></td>			</tr>			<tr>				<td width="8%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="4"><a href="../../../references/manual_html/syntax/iblock.htm"><font face="Courier New">endin</font></a></td>			</tr>			<tr>				<td valign="top" colspan="5"><font face="Courier New">&nbsp;</font></td>			</tr>			<tr>				<td width="8%" valign="top"><font face="Courier New">; Create </font></td>				<td width="8%" valign="top"><font face="Courier New">a table</font></td>				<td valign="top" width="20%"><font face="Courier New">with an impulse in the</font></td>				<td width="31%" valign="top"><font face="Courier New">second position.</font></td>				<td width="31%" valign="top"></td>			</tr>			<tr>				<td width="8%" valign="top"><font face="Courier New">f 1</font></td>				<td width="8%" valign="top"><font face="Courier New">0 8 2 0</font></td>				<td valign="top" width="20%"><font face="Courier New">1 0 0 0 0 0 0</font></td>				<td width="31%" valign="top"></td>				<td width="31%" valign="top"></td>			</tr>			<tr>				<td valign="top" colspan="5"><font face="Courier New">; Play the impulse and wait.</font></td>			</tr>			<tr>				<td width="8%" valign="top"><font face="Courier New">i 2003</font></td>				<td valign="top" width="8%"><font face="Courier New">0</font></td>				<td valign="top" width="20%"><font face="Courier New">0.2</font></td>				<td width="31%" valign="top"></td>				<td valign="top" width="31%"></td>			</tr>		</table>		</font></p>		<p><font face="Times New Roman"><b>Figure 20.18</b> Orchestra and score code for <i>instr 2003</i> that generates a single impulse and displays the impulse and frequency response.</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">Often one does not want an impulse with all possible frequencies, but rather a periodic or pitched signal with all of the harmonics at equal strength. A train of impulses will have the desired characteristics. Unfortunately, in a sampled system, the period of a pulse-train must be an integer multiple of the sampling period, which greatly limits the frequencies that can be used. Csound provides a way around this limitation. The opcode <a href="../../../references/manual_html/siggen/buzz.htm"><b>buzz</b></a> is designed to provide a signal with equal-strength harmonics for any desired frequency. The following Csound instrument will give you a <a href="../../../references/manual_html/siggen/buzz.htm"><b>buzz</b></a>.<br>			</font></p>		</div>		<p><font face="Times New Roman" size="4"><img src="figures/128.gif" width="245" height="210" hspace="9"></font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">&nbsp;</font><font face="Times New Roman"><b>Figure 20.19</b> Block diagram of <i>instr 2004</i>, an instrument which generates a pitched &quot;impulse train&quot; using Csound&#146;s <a href="../../../references/manual_html/siggen/buzz.htm"><b>buzz</b></a> opcode.</font></p>		</div>		<p><font face="Times New Roman" size="4">		<table cellspacing="0" border="0" width="557">			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="4"><a href="../../../references/manual_html/syntax/iblock.htm"><font face="Courier New">instr</font></a></td>				<td valign="top" colspan="4"><a href="../../instruments/20/2004/2004.html"><font face="Courier New">2004</font></a></td>				<td valign="top" colspan="2"><font face="Courier New">; pitched Pulse train</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">iharm</font></td>				<td valign="top" colspan="4"><font face="Courier New">=</font></td>				<td valign="top" colspan="5"><font face="Courier New">int(44100/(p4&gt;p5 p4:p5)/2)-1</font></td>				<td width="31%" valign="top"><font face="Courier New">; max harm w/o alias</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">a1</font></td>				<td valign="top" colspan="4"><a href="../../../references/manual_html/siggen/line.htm"><font face="Courier New">linseg</font></a></td>				<td valign="top" colspan="6"><font face="Courier New">0, 0.05, 30000, p3-0.1, 30000, 0.05, 0, 1, 0</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">afreq</font></td>				<td valign="top" colspan="4"><a href="../../../references/manual_html/siggen/line.htm"><font face="Courier New">expon</font></a></td>				<td valign="top" colspan="6"><font face="Courier New">p4, p3, p5</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">a2</font></td>				<td valign="top" colspan="4"><a href="../../../references/manual_html/siggen/buzz.htm"><font face="Courier New">buzz</font></a></td>				<td valign="top" colspan="6"><font face="Courier New">1, afreq, iharm, 1, -1</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="4"><a href="../../../references/manual_html/sigio/out.htm"><font face="Courier New">out</font></a></td>				<td valign="top" colspan="6"><font face="Courier New">a1*a2</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="10"><a href="../../../references/manual_html/syntax/iblock.htm"><font face="Courier New">endin</font></a></td>			</tr>			<tr>				<td valign="top" colspan="11"><font face="Courier New">&nbsp;</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">f 1</font></td>				<td width="6%" valign="top"><font face="Courier New">0</font></td>				<td valign="top" colspan="4"><font face="Courier New">16384</font></td>				<td valign="top" colspan="2"><font face="Courier New">10</font></td>				<td valign="top" colspan="3"><font face="Courier New">1</font></td>			</tr>			<tr>				<td valign="top" colspan="11"><font face="Courier New">&nbsp;</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">i 2004</font></td>				<td valign="top" colspan="2"><font face="Courier New">0</font></td>				<td width="5%" valign="top"><font face="Courier New">6</font></td>				<td valign="top" colspan="3"><font face="Courier New">10</font></td>				<td valign="top" colspan="4"><font face="Courier New">20</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">i 2004</font></td>				<td valign="top" colspan="2"><font face="Courier New">6</font></td>				<td width="5%" valign="top"><font face="Courier New">6</font></td>				<td valign="top" colspan="3"><font face="Courier New">20</font></td>				<td valign="top" colspan="4"><font face="Courier New">40</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">i 2004</font></td>				<td valign="top" colspan="2"><font face="Courier New">12</font></td>				<td width="5%" valign="top"><font face="Courier New">6</font></td>				<td valign="top" colspan="3"><font face="Courier New">40</font></td>				<td valign="top" colspan="4"><font face="Courier New">80</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">i 2004</font></td>				<td valign="top" colspan="2"><font face="Courier New">18</font></td>				<td width="5%" valign="top"><font face="Courier New">6</font></td>				<td valign="top" colspan="3"><font face="Courier New">80</font></td>				<td valign="top" colspan="4"><font face="Courier New">160</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">i 2004</font></td>				<td valign="top" colspan="2"><font face="Courier New">24</font></td>				<td width="5%" valign="top"><font face="Courier New">6</font></td>				<td valign="top" colspan="3"><font face="Courier New">160</font></td>				<td valign="top" colspan="4"><font face="Courier New">320</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">i 2004</font></td>				<td valign="top" colspan="2"><font face="Courier New">30</font></td>				<td width="5%" valign="top"><font face="Courier New">6</font></td>				<td valign="top" colspan="3"><font face="Courier New">320</font></td>				<td valign="top" colspan="4"><font face="Courier New">640</font></td>			</tr>		</table>		</font></p>		<p><font face="Times New Roman"><b>Figure 20.20</b> Orchestra and score code for <i>instr 2004</i>, an instrument which generates a sweeping train of impulses with all the harmonics at equal strength.</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">As the frequency sweeps from 10 Hz to 640 Hz you should hear the transition from individual clicks to a buzzing sound. The transitions (the car shifts) are because one has to specify the number of harmonics in <a href="../../../references/manual_html/siggen/buzz.htm"><b>buzz</b></a> and the maximum number allowed without aliasing (explained below) decreases with increasing frequency.</font></p>		</div>		<div align="justify">			<p><font face="Times New Roman" size="4">Often a signal will have one or more frequency ranges where there is no information, which means that <i><b>X( f ) = 0</b></i>. Such a signal is called <i>band-limited</i>, meaning the information content is limited to certain frequency ranges or bands.<br>			</font></p>		</div>		<p><font face="Times New Roman" size="4"><img src="figures/130.gif" width="313" height="208"></font></p>		<p><font face="Times New Roman"><b>Figure 20.21 </b></font><font face="Times New Roman">A band-limited signal.</font><font face="Times New Roman" size="4"><br>		</font></p>		<h2><font face="Times New Roman" size="4"><b>The Sampling Theorem and Aliasing</b></font></h2>		<div align="justify">			<p><font face="Times New Roman" size="4">With this background we are ready to tackle converting continuous signals to discrete signals and back. The <i>Sampling Theorem</i> states that a band-limited continuous signal with <i><b>X(f) = 0</b></i> for <i><b>|f| &gt; f</b></i></font><font face="Times New Roman"><sub><i><b>M</b></i></sub></font><font face="Times New Roman" size="4"> is uniquely determined by its samples, if the sampling frequency is at least twice the band-limited frequency, <i><b>f<sub>s</sub> &gt; 2f<sub>M</sub></b></i>, where the sampling frequency is the reciprocal of the sampling period <i><b>f<sub>s</sub> = 1/T<sub>s</sub></b></i>. The original signal, <i><b>x( t )</b></i>, can be reconstructed from its samples by generating an impulse-train whose amplitudes equal the sample values and passing the impulse-train through an ideal lowpass filter with a gain of <i><b>T<sub>s</sub></b></i> and a cutoff frequency greater than <i><b>f</b></i></font><font face="Times New Roman"><sub><i><b>M</b></i></sub></font><font face="Times New Roman" size="4"> and less than <i><b>f<sub>s</sub></b></i> - <i><b>f</b></i></font><font face="Times New Roman"><sub><i><b>M</b></i></sub></font><font face="Times New Roman" size="4">.<br>			</font></p>			<p><font face="Times New Roman" size="4">The analog-to-digital (ADC) and digital-to-analog (DAC) converters in your computer or sound card usually handle the details of converting from a continuous signal to a discrete signal and back again. Most ADC&#146;s have filters on them to remove any frequency content higher than one-half the sample rate. When recording a signal into a computer then, one normally does not have to worry about making sure that the signal is band-limited.<br>			</font></p>			<p><font face="Times New Roman" size="4">However, when generating or processing a signal inside the computer one has to be careful not to generate any frequency content above one-half the sample rate. Csound has <i>absolutely</i> no built-in protection against this. There is in fact no general way for protection against this.<br>			</font></p>			<p><font face="Times New Roman" size="4">If you generate a frequency above one-half of the sampling rate and attempt to play it, the actual frequency you hear will depend upon just how high above one-half the sampling rate the frequency is. For frequencies between 1/2<i><b>f<sub>s</sub></b></i> and <i><b>f<sub>s</sub></b></i>, the frequency you will hear is <i><b>f<sub>s</sub></b></i> - <i><b>f</b></i>. For frequencies between <i><b>f<sub>s</sub></b></i> and 3/2<i><b>f<sub>s</sub></b></i>, the frequency you will hear is <i><b>f</b></i> - <i><b>f<sub>s</sub></b></i>. The pattern repeats.<br>			</font></p>			<p><font face="Times New Roman" size="4">This reappearance of a high frequency as a much lower frequency is called <i>aliasing</i>, (<i>i.e.</i> the high frequency appears as its low-frequency alias). The following Csound code illustrates aliasing:<br>			</font></p>		</div>		<p><font face="Times New Roman" size="4"><img src="figures/143.gif" width="206" height="174"></font></p>		<p><font face="Times New Roman"><b>Figure 20.22</b> Block diagram of <i>instr 2005</i>, an instrument designed to illustrate the sounds and concepts of aliasing</font><font face="Times New Roman" size="4">.<br>		</font></p>		<p><font face="Times New Roman" size="4">		<table cellspacing="0" border="0" width="624">			<tr>				<td valign="top" colspan="2"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="3"><a href="../../../references/manual_html/syntax/iblock.htm"><font face="Courier New">instr</font></a></td>				<td valign="top" colspan="3"><a href="../../instruments/20/2005/2005.html"><font face="Courier New">2005</font></a></td>				<td width="61%" valign="top"><font face="Courier New">; aliasing</font></td>			</tr>			<tr>				<td valign="top" colspan="2"><font face="Courier New">a1</font></td>				<td valign="top" colspan="3"><a href="../../../references/manual_html/siggen/line.htm"><font face="Courier New">linseg</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">0, 0.01, 20000, p3-0.01, 20000, 0.01, 0, 1, 0</font></td>			</tr>			<tr>				<td valign="top" colspan="2"><font face="Courier New">a2</font></td>				<td valign="top" colspan="3"><a href="../../../references/manual_html/siggen/line.htm"><font face="Courier New">expon</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">20, p3, 176400</font></td>			</tr>			<tr>				<td valign="top" colspan="2"><font face="Courier New">a3</font></td>				<td valign="top" colspan="3"><a href="../../../references/manual_html/siggen/oscil.htm"><font face="Courier New">oscil</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">a1, a2, p4</font></td>			</tr>			<tr>				<td valign="top" colspan="2"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="3"><a href="../../../references/manual_html/sigio/out.htm"><font face="Courier New">out</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">a3</font></td>			</tr>			<tr>				<td valign="top" colspan="2"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="7"><a href="../../../references/manual_html/syntax/iblock.htm"><font face="Courier New">endin</font></a></td>			</tr>			<tr>				<td valign="top" colspan="9"><font face="Courier New">&nbsp;</font></td>			</tr>			<tr>				<td valign="top" colspan="9"><font face="Courier New">; sine</font></td>			</tr>			<tr>				<td width="7%" valign="top"><font face="Courier New">f 1</font></td>				<td valign="top" colspan="2"><font face="Courier New">0</font></td>				<td width="8%" valign="top"><font face="Courier New">8192</font></td>				<td valign="top" colspan="2"><font face="Courier New">10</font></td>				<td valign="top" colspan="3"><font face="Courier New">1</font></td>			</tr>			<tr>				<td valign="top" colspan="9"><font face="Courier New">; square</font></td>			</tr>			<tr>				<td width="7%" valign="top"><font face="Courier New">f 2</font></td>				<td valign="top" colspan="2"><font face="Courier New">0</font></td>				<td width="8%" valign="top"><font face="Courier New">8192</font></td>				<td valign="top" colspan="2"><font face="Courier New">10</font></td>				<td valign="top" colspan="3"><font face="Courier New">1000 0 333 0 200 0 143 0 111 0 91 0 77 0 67 0 59 0 53 0</font></td>			</tr>			<tr>				<td valign="top" colspan="9"><font face="Courier New">; sawtooth</font></td>			</tr>			<tr>				<td width="7%" valign="top"><font face="Courier New">f 3</font></td>				<td valign="top" colspan="2"><font face="Courier New">0</font></td>				<td width="8%" valign="top"><font face="Courier New">8192</font></td>				<td valign="top" colspan="2"><font face="Courier New">10</font></td>				<td valign="top" colspan="3"><font face="Courier New">1000 500 333 250 200 167 143 125 111 100 91 83 77 71 67 63 59 56 53 50</font></td>			</tr>			<tr>				<td valign="top" colspan="9"><font face="Courier New">; impulse-like</font></td>			</tr>			<tr>				<td width="7%" valign="top"><font face="Courier New">f 4</font></td>				<td valign="top" colspan="2"><font face="Courier New">0</font></td>				<td width="8%" valign="top"><font face="Courier New">8192</font></td>				<td valign="top" colspan="2"><font face="Courier New">10</font></td>				<td valign="top" colspan="3"><font face="Courier New">1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</font></td>			</tr>			<tr>				<td valign="top" colspan="9"><font face="Courier New">&nbsp;</font></td>			</tr>			<tr>				<td valign="top" colspan="3"><font face="Courier New">i 2005</font></td>				<td width="8%" valign="top"><font face="Courier New">0</font></td>				<td valign="top" colspan="3"><font face="Courier New">20</font></td>				<td valign="top" colspan="2"><font face="Courier New">1</font></td>			</tr>			<tr>				<td valign="top" colspan="3"><font face="Courier New">i 2005</font></td>				<td width="8%" valign="top"><font face="Courier New">21</font></td>				<td valign="top" colspan="3"><font face="Courier New">20</font></td>				<td valign="top" colspan="2"><font face="Courier New">2</font></td>			</tr>			<tr>				<td valign="top" colspan="3"><font face="Courier New">i 2005</font></td>				<td width="8%" valign="top"><font face="Courier New">42</font></td>				<td valign="top" colspan="3"><font face="Courier New">20</font></td>				<td valign="top" colspan="2"><font face="Courier New">3</font></td>			</tr>			<tr>				<td valign="top" colspan="3"><font face="Courier New">i 2005</font></td>				<td width="8%" valign="top"><font face="Courier New">63</font></td>				<td valign="top" colspan="3"><font face="Courier New">20</font></td>				<td valign="top" colspan="2"><font face="Courier New">4</font></td>			</tr>		</table>		</font></p>		<p><font face="Times New Roman"><b>Figure 20.23</b> Orchestra and score code for <i>instr 2005</i>, an instrument whose frequency moves from 20 Hz to 176,400 Hz &#151; 4x the sample rate.</font><font face="Times New Roman" size="4"><br>		</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">The result sweeps the waveform from 20 Hz to 176,400 Hz, which is four times the sample rate. Humans cannot hear sounds at 176,400 Hz, but you will hear the alias of 176,400 Hz quite clearly. For the sine wave you should be able to hear the pitch sweep up and down four times. For the others, you will hear the partials sweep up and down repeatedly before the fundamental starts to sweep back down. For the <a href="../../../references/manual_html/siggen/buzz.htm"><b>buzz</b></a> wave, all of the harmonics are the same strength so you will hear an audio mess.<br>			</font></p>		</div>		<p><font face="Times New Roman" size="4"><img src="figures/fig24.jpg" width="446" height="259"></font></p>		<p><font face="Times New Roman"><b>Figure 20.24</b></font><font face="Times New Roman"> Aliasing.</font><font face="Times New Roman" size="4"><br>		</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">Aliasing is neither a good nor a bad thing. However, If you are not expecting it, you can generate &quot;noise&quot; (my definition of &quot;noise&quot; is any sound that you do not want to hear). It is best not to depend on aliasing in a Csound instrument, because changing the sampling rate will dramatically change the sound. Another way to think about aliasing is that the discrete-time frequency, <i><b>F = f /</b></i> <i><b>f<sub>s</sub></b></i>, only has a useful range from -1/2 to 1/2. Any frequency generated outside this range will be aliased back into this range. The most common causes of aliasing in Csound are sampling a table too rapidly or having too high a modulation index in a modulating scheme such as FM (discussed below).<br>			</font></p>		</div>		<h2><font face="Times New Roman" size="4"><b>Systems</b></font></h2>		<div align="justify">			<p><font face="Times New Roman" size="4">A <i>system</i> is anything that takes an input signal and transforms it into an output signal. Systems are normally classified as either <i>linear</i> or <i>non-linear</i> and <i>time-invariant</i> or <i>time-varying</i>. A time-invariant system is one in which a given input causes a given output no matter when the input occurs. For example, consider a doorbell as a system with a push on the button as the input and the ringing sound as the output. It does not matter when you push the button, the bell will still ring, so the system is time-invariant. However, if you consider the system to be the doorbell, the residents and the front door, taken all together as the system, this new system is time-varying, <i>i.e.</i> the response that you get to a push on the doorbell depends very much on the time of day. Mathematically a system is time-invariant if the input <i><b>x(t - t<sub>0</sub>)</b></i> gives rise to the output <i><b>y(t - t<sub>0</sub>)</b></i>.</font></p>			<p><font face="Times New Roman" size="4">A linear system is one in which the output is directly proportional to the input. Most doorbells are not linear because pushing the button twice as hard does not cause the bell to ring twice as loud. A properly functioning grocery clerk is a linear system because they will charge you twice as much for two boxes of corn flakes and they will charge you the sum of three times the price of one box of corn flakes and twice the price of one doughnut if you buy three boxes of corn flakes and two doughnuts.</font></p>			<p><font face="Times New Roman" size="4">Mathematically, a linear system has the following properties: if <i><b>x<sub>1</sub>(t)</b></i> and <i><b>x<sub>2</sub>(t)</b></i> are inputs to a system, <i>a</i> and <i>b</i> are constants and <i><b>y<sub>1</sub>(t)</b></i> is the system response to <i><b>x<sub>1</sub>(t)</b></i> and <i><b>y<sub>2</sub>(t)</b></i> is the system response to <i><b>x<sub>2</sub>(t)</b></i>, then the system is linear if the response to <i><b>ax<sub>1</sub>(t) + bx<sub>2</sub>(t)</b></i> is <i><b>ay<sub>1</sub>(t) + by<sub>2</sub>(t)</b></i>.</font></p>			<p><font face="Times New Roman" size="4">From a design and analysis standpoint, linear time-invariant systems are the most useful because you can predict their behavior from very limited information. Most of the rest of this chapter will be concerned with linear time-invariant (LTI) systems.<br>			</font></p>		</div>		<p><font face="Times New Roman" size="4"><img src="figures/154.gif" width="227" height="136"></font></p>		<p><font face="Times New Roman"><b>Figure 20.25</b></font><font face="Times New Roman"> Block diagram of linear time-invariant systems in the time and frequency domains.<br>		</font></p>		<h2><font face="Times New Roman" size="4"><b>Impulse Response and Convolution</b></font></h2>		<div align="justify">			<p><font face="Times New Roman" size="4">If you input an impulse into an LTI system you will get an output signal called the <i>impulse response</i>, <i><b>h(t)</b></i>, for continuous systems and <i><b>h[n]</b></i> for discrete systems. It has been proven that you can get the response to any input signal, <i><b>x(t)</b></i>, from the impulse response by <i>convolution</i> of <i><b>x(t)</b></i> with <i><b>h(t)</b></i>. The symbol for convolution is usually the asterisk &#151; &quot;</font><font face="Times New Roman" size="5"><b>*</b></font><font face="Times New Roman" size="4">.&quot; For continuous signals:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq38.jpg" width="447" height="51"> </font><font face="Courier New">(20.38)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">For discrete signals:</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq39.jpg" width="447" height="51"> </font><font face="Courier New">(20.39)</font><font face="Times New Roman" size="4"><br>			&nbsp;</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">For discrete systems with short impulse responses, the convolution sum is fairly easy to program and runs quite quickly. However, for long impulse responses, such as reverberation in a cathedral, the speed and memory requirements for convolution become quite overwhelming. Most people do not have the mathematical background to perform the convolution integral for continuous signals and we have found that even among those that do, relatively few enjoy performing the integration. It would be nice if there was an easier way. A special property of sines, cosines and complex exponentials provides such a way.<br>			</font></p>		</div>		<h2><font face="Times New Roman" size="4"><b>Frequency Response and Convolution</b></font></h2>		<div align="justify">			<p><font face="Times New Roman" size="4">Sines, cosines and complex exponentials are <i>eigen functions</i> of LTI systems, which means that the output from a complex exponential input is a complex exponential with exactly the same frequency. However, the output is multiplied by a (possibly complex) constant. In other words, for an input of <img src="figures/ej2ft.jpg" width="43" height="22"> you get an output of <img src="figures/hfej2.jpg" width="79" height="32">, where <img src="figures/hf.jpg" width="45" height="31"> is a constant that depends on <i>f</i> but not on <i>t</i>. Since we learned above that any reasonable signal can be constructed from a weighted sum (or integral) of complex exponentials, we can find the response of an LTI system as:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img height="51" width="444" src="figures/eq40.jpg"> </font><font face="Courier New">(20.40)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">For discrete-time systems the result is <i><b>Y(F) = H(F)X(F)</b></i>. You may have guessed by now that <i><b>H(F)</b></i> is the Fourier transform of the impulse response, <i><b>h(t)</b></i>. <i><b>H(f)</b></i> is the <i>transfer function</i> or <i>frequency-response function</i> of the system. In other words, multiplication in the frequency domain corresponds to convolution in the time domain. The procedure then is to take the Fourier transform of the input signal and the impulse response, multiply the two transforms and take the inverse transform of the result to get the output signal.</font></p>			<p><font face="Times New Roman" size="4">The following Csound orchestra and score can be used to find the impulse response and the frequency response of an LTI Csound opcode or section of code.<br>			</font></p>		</div>		<p><font face="Times New Roman" size="4"><img src="figures/166.gif" width="336" height="295"></font></p>		<p><font face="Times New Roman"><b>Figure 20.26</b></font><font face="Times New Roman"> Block diagram of <i>instr 2006</i>, an instrument designed to find the impulse and frequency response of a linear time-invariant opcode (<a href="../../../references/manual_html/sigmod/port.htm"><b>reson</b></a>).</font><font face="Times New Roman" size="4"><br>		</font></p>		<p><font face="Times New Roman" size="4">		<table cellspacing="0" border="0" width="500">			<tr>				<td width="10%" valign="top">&nbsp;</td>				<td valign="top" colspan="2"><a href="../../../references/manual_html/syntax/iblock.htm"><font face="Courier" size="2">instr</font></a></td>				<td valign="top" colspan="2"><a href="../../instruments/20/2006/2006.html"><font face="Courier" size="2">2006</font></a></td>				<td valign="top" colspan="2"><font face="Courier" size="2">; impulse response of reson filter</font></td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier" size="2">idur1</font></td>				<td valign="top" colspan="2"><font face="Courier" size="2">=</font></td>				<td valign="top" colspan="3"><font face="Courier" size="2">7/sr</font></td>				<td width="52%" valign="top"><font face="Courier" size="2">; read the table once</font></td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier" size="2">idur2</font></td>				<td valign="top" colspan="2"><font face="Courier" size="2">=</font></td>				<td valign="top" colspan="4"><font face="Courier" size="2">1/sr</font></td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier" size="2">ifreq</font></td>				<td valign="top" colspan="2"><font face="Courier" size="2">=</font></td>				<td valign="top" colspan="3"><font face="Courier" size="2">sr/8</font></td>				<td width="52%" valign="top"><font face="Courier" size="2">; read the table at 1 point per sample</font></td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier" size="2">a1</font></td>				<td valign="top" colspan="2"><a href="../../../references/manual_html/siggen/line.htm"><font face="Courier" size="2">linseg</font></a></td>				<td valign="top" colspan="4"><font face="Courier" size="2">ifreq, idur1, ifreq, idur2, 0, 1, 0</font></td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier" size="2">a2</font></td>				<td valign="top" colspan="2"><a href="../../../references/manual_html/siggen/oscil.htm"><font face="Courier" size="2">oscil</font></a></td>				<td valign="top" colspan="4"><font face="Courier" size="2">1, a1, 1</font></td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier" size="2">a3</font></td>				<td valign="top" colspan="2"><a href="../../../references/manual_html/sigmod/port.htm"><font face="Courier" size="2">reson</font></a></td>				<td valign="top" colspan="3"><font face="Courier" size="2">a2, sr/10, sr/200</font></td>				<td width="52%" valign="top"><font face="Courier" size="2">; the system under test</font></td>			</tr>			<tr>				<td width="10%" valign="top">&nbsp;</td>				<td valign="top" colspan="2"><a href="../../../references/manual_html/sigio/in.htm"><font face="Courier" size="2">out</font></a></td>				<td valign="top" colspan="4"><font face="Courier" size="2">a3</font></td>			</tr>			<tr>				<td width="10%" valign="top">&nbsp;</td>				<td valign="top" colspan="2"><a href="../../../references/manual_html/sigio/print.htm"><font face="Courier" size="2">display</font></a></td>				<td valign="top" colspan="3"><font face="Courier" size="2">a1, p3</font></td>				<td width="52%" valign="top"><font face="Courier" size="2">; display the impulse response</font></td>			</tr>			<tr>				<td width="10%" valign="top">&nbsp;</td>				<td valign="top" colspan="2"><a href="../../../references/manual_html/sigio/print.htm"><font face="Courier" size="2">dispfft</font></a></td>				<td valign="top" colspan="3"><font face="Courier" size="2">a3, p3, 4096, 0, 1</font></td>				<td width="52%" valign="top"><font face="Courier" size="2">; display the frequency response</font></td>			</tr>			<tr>				<td width="10%" valign="top">&nbsp;</td>				<td valign="top" colspan="6"><a href="../../../references/manual_html/syntax/iblock.htm"><font face="Courier" size="2">endin</font></a></td>			</tr>			<tr>				<td valign="top" colspan="7"><font face="Courier" size="2">; create a table with an impulse in the second position</font></td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier" size="2">f 1</font></td>				<td width="7%" valign="top"><font face="Courier" size="2">0</font></td>				<td width="5%" valign="top"><font face="Courier" size="2">8</font></td>				<td width="5%" valign="top"><font face="Courier" size="2">2</font></td>				<td valign="top" colspan="3"><font face="Courier" size="2">0 1 0 0 0 0 0 0</font></td>			</tr>			<tr>				<td valign="top" colspan="7">&nbsp;</td>			</tr>			<tr>				<td width="10%" valign="top"><font face="Courier" size="2">i 2006</font></td>				<td width="7%" valign="top"><font face="Courier" size="2">0</font></td>				<td valign="top" colspan="4"><font face="Courier" size="2">0.185759637</font></td>				<td width="52%" valign="top"><font face="Courier" size="2">; create 2^14 (8192) samples</font></td>			</tr>		</table>		</font></p>		<p><font face="Times New Roman"><b>Figure 20.27</b> Orchestra and score code for <i>instr 2006</i>, an instrument which generates an impulse response of a <a href="../../../references/manual_html/sigmod/port.htm"><b>reson</b></a> filter.</font><font face="Times New Roman" size="4"><br>		</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">The opcode <a href="../../../references/manual_html/sigmod/convolve.htm"><b>convolve</b></a> and its analysis utility companion, <a href="../../../references/manual_html/utility/cvanal.htm"><b>cvanal</b></a>, implement frequency-domain convolution. The <a href="../../../references/manual_html/utility/cvanal.htm"><b>cvanal</b></a> utility takes the Fast Fourier Transform of a soundfile, creating a frequency-response function (the soundfile is assumed to be the impulse response of some system or filter). The <a href="../../../references/manual_html/sigmod/convolve.htm"><b>convolve</b></a> opcode takes the frequency-response function, multiplies it by the Fourier Transform of the input signal and takes the Inverse Fourier Transform.<br>			</font></p>			<p><font face="Times New Roman" size="4">The following Csound code is designed to do that comparison. Note: because Csound&#146;s analysis files are machine specific (you cannot use PC analysis files on a Mac or vice versa) the impulse responses on the accompanying CD-ROM must be pre-analyzed by the Csound <a href="../../../references/manual_html/utility/cvanal.htm"><b>cvanal</b></a> utility before they can be used for convolution.<br>			</font></p>		</div>		<p><font face="Times New Roman" size="4"><img src="figures/167.gif" width="529" height="432"></font></p>		<p><font face="Times New Roman"><b>Figure 20.28</b> Block diagram of <i>instr 2007</i>, an instrument designed to do a comparison test and measure the impulse and direct implementation frequency response of an LTI opcode and the convolution method as shown in figure 20.29</font><font face="Times New Roman" size="4">.<br>		</font></p>		<p><font face="Times New Roman" size="4"><img src="figures/168.gif" width="526" height="472"></font></p>		<p><font face="Times New Roman"><b>Figure 20.29</b> Block diagram of <i>instr 2008</i>, an instrument designed to compare the impulse and frequency response of the convolution opcode with the direct method shown in figure 20.28.</font><font face="Times New Roman" size="4"><br>		</font></p>		<p><font face="Times New Roman" size="4">		<table cellspacing="0" border="0" width="537">			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="3"><a href="../../../references/manual_html/syntax/iblock.htm"><font face="Courier New">instr</font></a></td>				<td valign="top" colspan="3"><a href="../../instruments/20/2007/2007.html"><font face="Courier New">2007</font></a></td>				<td valign="top" colspan="2"><font face="Courier New">; Direct implementation test</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">iharm</font></td>				<td valign="top" colspan="3"><font face="Courier New">=</font></td>				<td valign="top" colspan="4"><font face="Courier New">int(44100/(p4)/2)-1</font></td>				<td width="42%" valign="top"><font face="Courier New">; avoid problems with delays</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">abuzz</font></td>				<td valign="top" colspan="3"><a href="../../../references/manual_html/siggen/line.htm"><font face="Courier New">linseg</font></a></td>				<td valign="top" colspan="5"><font face="Courier New">0,0.45*p3,0,0.1*p3,10000,0.44*p3,10000,0.01*p3,0,1,0</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">aran</font></td>				<td valign="top" colspan="3"><a href="../../../references/manual_html/siggen/line.htm"><font face="Courier New">linseg</font></a></td>				<td valign="top" colspan="5"><font face="Courier New">0, 0.01*p3, 10000, 0.44*p3, 10000, 0.1*p3, 0, 1, 0</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">a2</font></td>				<td valign="top" colspan="3"><a href="../../../references/manual_html/siggen/buzz.htm"><font face="Courier New">buzz</font></a></td>				<td valign="top" colspan="5"><font face="Courier New">abuzz, p4, iharm, 1, -1</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">a3</font></td>				<td valign="top" colspan="3"><a href="../../../references/manual_html/siggen/x.htm"><font face="Courier New">trirand</font></a></td>				<td valign="top" colspan="5"><font face="Courier New">1</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">a4</font></td>				<td valign="top" colspan="3"><font face="Courier New">=</font></td>				<td valign="top" colspan="5"><font face="Courier New">a2+a3*aran</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">a5</font></td>				<td valign="top" colspan="3"><a href="../../../references/manual_html/sigmod/port.htm"><font face="Courier New">reson</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">a4, sr/100, sr/5000</font></td>				<td width="42%" valign="top"><font face="Courier New">; Same as test impulse</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">a6</font></td>				<td valign="top" colspan="3"><a href="../../../references/manual_html/sigmod/rms.htm"><font face="Courier New">balance</font></a></td>				<td valign="top" colspan="5"><font face="Courier New">a5, abuzz+aran</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="3"><a href="../../../references/manual_html/sigio/out.htm"><font face="Courier New">out</font></a></td>				<td valign="top" colspan="5"><font face="Courier New">a6</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="3"><a href="../../../references/manual_html/sigio/print.htm"><font face="Courier New">display</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">a6, p3/5</font></td>				<td width="42%" valign="top"><font face="Courier New">; display impulse response</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="3"><a href="../../../references/manual_html/sigio/print.htm"><font face="Courier New">dispfft</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">a6, p3/5, 4096, 0, 1</font></td>				<td width="42%" valign="top"><font face="Courier New">; display frequency response</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="8"><a href="../../../references/manual_html/syntax/iblock.htm"><font face="Courier New">endin</font></a></td>			</tr>			<tr>				<td valign="top" colspan="9"><font face="Courier New">&nbsp;</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="3"><a href="../../../references/manual_html/syntax/iblock.htm"><font face="Courier New">instr</font></a></td>				<td valign="top" colspan="3"><font face="Courier New">2008</font></td>				<td valign="top" colspan="2"><font face="Courier New">; Convolution test</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">iharm</font></td>				<td valign="top" colspan="3"><font face="Courier New">=</font></td>				<td valign="top" colspan="5"><font face="Courier New">int(44100/(p4)/2)-1</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">abuzz</font></td>				<td valign="top" colspan="3"><a href="../../../references/manual_html/siggen/line.htm"><font face="Courier New">linseg</font></a></td>				<td valign="top" colspan="5"><font face="Courier New">0,0.45*p3,0,0.1*p3,10000,0.44*p3,10000,0.01*p3,0,1,0</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">aran</font></td>				<td valign="top" colspan="3"><a href="../../../references/manual_html/siggen/line.htm"><font face="Courier New">linseg</font></a></td>				<td valign="top" colspan="5"><font face="Courier New">0, 0.01*p3, 10000, 0.44*p3, 10000, 0.1*p3, 0, 1, 0</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">ahalt</font></td>				<td valign="top" colspan="3"><a href="../../../references/manual_html/siggen/line.htm"><font face="Courier New">linseg</font></a></td>				<td valign="top" colspan="5"><font face="Courier New">0, 8192/44100, 0, 0.001, 1, p3, 1</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">a2</font></td>				<td valign="top" colspan="3"><a href="../../../references/manual_html/siggen/buzz.htm"><font face="Courier New">buzz</font></a></td>				<td valign="top" colspan="5"><font face="Courier New">abuzz, p4, iharm, 1, -1</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">a3</font></td>				<td valign="top" colspan="3"><a href="../../../references/manual_html/siggen/x.htm"><font face="Courier New">trirand</font></a></td>				<td valign="top" colspan="5"><font face="Courier New">1</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">a4</font></td>				<td valign="top" colspan="3"><font face="Courier New">=</font></td>				<td valign="top" colspan="5"><font face="Courier New">(a2+a3*aran)/1.1</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">a5</font></td>				<td valign="top" colspan="3"><a href="../../../references/manual_html/sigmod/convolve.htm"><font face="Courier New">convolve</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">a4, &quot;reson_100_5000.con&quot;</font></td>				<td width="42%" valign="top"><font face="Courier New">; Use cvanal to make</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">adely</font></td>				<td valign="top" colspan="3"><a href="../../../references/manual_html/sigmod/delayr.htm"><font face="Courier New">delay</font></a></td>				<td valign="top" colspan="5"><font face="Courier New">abuzz+aran, 8192/sr</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">a6</font></td>				<td valign="top" colspan="3"><a href="../../../references/manual_html/sigmod/rms.htm"><font face="Courier New">balance</font></a></td>				<td valign="top" colspan="5"><font face="Courier New">a5, adely</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="3"><a href="../../../references/manual_html/sigio/out.htm"><font face="Courier New">out</font></a></td>				<td valign="top" colspan="5"><font face="Courier New">a6</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="3"><a href="../../../references/manual_html/sigio/print.htm"><font face="Courier New">display</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">a6, p3/5</font></td>				<td width="42%" valign="top"><font face="Courier New">; display impulse response</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="3"><a href="../../../references/manual_html/sigio/print.htm"><font face="Courier New">dispfft</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">a6, p3/5, 4096, 0, 1</font></td>				<td width="42%" valign="top"><font face="Courier New">; display frequency response</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="8"><a href="../../../references/manual_html/syntax/iblock.htm"><font face="Courier New">endin</font></a></td>			</tr>			<tr>				<td valign="top" colspan="9"><font face="Courier New">&nbsp;</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">f 1</font></td>				<td width="9%" valign="top"><font face="Courier New">0</font></td>				<td valign="top" colspan="3"><font face="Courier New">16384</font></td>				<td width="7%" valign="top"><font face="Courier New">10</font></td>				<td valign="top" colspan="2"><font face="Courier New">1</font></td>				<td width="42%" valign="top"><font face="Courier New">; sine table</font></td>			</tr>			<tr>				<td valign="top" colspan="9"><font face="Courier New">&nbsp;</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">i 2007</font></td>				<td valign="top" colspan="2"><font face="Courier New">0</font></td>				<td valign="top" colspan="2"><font face="Courier New">6</font></td>				<td valign="top" colspan="4"><font face="Courier New">110.25</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">i 2008</font></td>				<td valign="top" colspan="2"><font face="Courier New">6</font></td>				<td valign="top" colspan="2"><font face="Courier New">6</font></td>				<td valign="top" colspan="4"><font face="Courier New">110.25</font></td>			</tr>		</table>		</font></p>		<p><font face="Times New Roman"><b>Figure 20.30</b> Orchestra code for <i>instr 2007 </i>and <i>2008</i>, a direct implementation of an instrument that generates an impulse and measures the time and frequency responses(<i>2007</i>) and a convolution instrument for comparison(<i>2008</i>).</font><font face="Times New Roman" size="4"><br>		</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">Csound has some other facilities for performing frequency-domain convolution but they are somewhat hidden. The interested reader is directed to <a href="../../../references/manual_html/siggen/pvoc.htm"><b>pvoc</b></a> and <a href="../../../references/manual_html/utility/pvanal.htm"><b>pvanal</b></a>, as well as the <a href="../../../references/manual_html/spectral/top.htm"><b>spectral data types</b></a>.<br>			</font></p>		</div>		<h2><font face="Times New Roman" size="4"><b>Difference Equations</b></font></h2>		<div align="justify">			<p><font face="Times New Roman" size="4">For continuous-time signals and systems, the behavior of the systems is often based on linear constant-coefficient <i>differential</i> equations. For discrete-time signals and systems, systems are often described by constant coefficient <i>difference</i> equations. The general form of a constant-coefficient difference equation is:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq41.jpg" width="447" height="52"></font><font face="Courier New">(20.41)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">If one assumes that the system is initially at rest, one can calculate the frequency response and the impulse response from the difference equation in the following way: The discrete-time Fourier Transform of the difference equation is:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq42.jpg" width="447" height="52"> </font><font face="Courier New">(20.42)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">which can be rearranged to:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq43.jpg" width="447" height="93"></font><font face="Courier New">(20.43)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">The impulse response is then found from the inverse Fourier transform of <i><b>H(F)</b></i>.<br>			</font></p>		</div>		<div align="justify">			<p><font face="Times New Roman" size="4">The difference equations are often represented by <i>block diagrams</i> in the following form:<br>			</font></p>			<p><font face="Times New Roman" size="4"><img height="38" width="156" src="figures/xnbyn.jpg"> means <img height="38" width="127" src="figures/yn=bxn.jpg"><br>			</font></p>			<p><font face="Times New Roman" size="4"><img height="38" width="177" src="figures/xndyn.jpg"> means <img height="38" width="146" src="figures/xnxn-1.jpg"><br>			</font></p>			<p><font face="Times New Roman" size="4"><img height="98" width="216" src="figures/xn+wn.jpg"> means <img height="36" width="216" src="figures/yn=xn+wn.jpg"></font></p>		</div>		<p><font face="Times New Roman"><b>Figure 20.31 </b></font><font face="Times New Roman">Typical figures and form of block diagrams used to represent difference equations.</font><font face="Times New Roman" size="4"><br>		</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">A circle with a plus sign is a summation operator. The <i><b>D</b></i> is a delay operator. It corresponds to shifting the index from <i>n</i> to <i>n </i>- 1. The coefficient by the arrow corresponds to multiplication by the coefficient.<br>			</font></p>			<p><font face="Times New Roman" size="4">We can rewrite Equation(20.41) as a block diagram:<br>			</font></p>		</div>		<p><font face="Times New Roman" size="4"><img src="figures/fig41.jpg" width="466" height="419"></font></p>		<p><font face="Times New Roman"><b>Figure 20.32</b></font><font face="Times New Roman"> The block diagram of equation 20.41.</font><font face="Times New Roman" size="4"><br>		</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">The coefficients by the arrows correspond to multiplication by the coefficients in the previous equation.<br>			</font></p>			<p><font face="Times New Roman" size="4">If all of the <i><b>a<sub>k</sub></b></i> are zero, except for <i><b>a<sub>0</sub></b></i>, then the output only depends on the present and past inputs and not on the past outputs. The impulse response of such a system returns to zero after the impulse has passed through the <i><b>M</b></i>th input. Such a system is said to have a <i>finite impulse response</i>, because the impulse response has a finite duration and the system is known as an <i>FIR</i> system. If any of the <i><b>a<sub>k</sub></b></i> are not zero, then, in general, the impulse response never truly returns to zero, although it may get very small. These systems have feedback because the present value of the output depends on all of the previous ones. Such a system is said to have an <i>infinite impulse response</i> and is known as an <i>IIR</i> or <i>recursive</i> system (because of the feedback).<br>			</font></p>			<p><font face="Times New Roman" size="4">A system is said to be <i>stable</i> if a finite or bounded input produces a finite or bounded output. One can determine the stability of a system by examining the roots of the equation obtained, by replacing the factors of <img src="figures/e-2pi.jpg" width="48" height="21"> with <i><b>z<sup>-1</sup></b></i>, <i>e.g.</i> <img src="figures/e-2pitoz.jpg" width="105" height="21">, setting the denominator of the transfer function to zero and solving for <img src="figures/181.gif" width="8" height="8">. If the magnitudes or absolute values of all of the roots are less than 1, the system is stable. If the magnitude of any of the roots is greater than 1 the system is unstable. As an example, take the system with the transfer function:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq44.jpg" width="522" height="55"></font><font face="Courier New">(20.44)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">First, replace the factors of <img src="figures/e-2pi.jpg" width="48" height="21"> with <i><b>z<sup>-1</sup></b></i>.<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq45.jpg" width="522" height="55"></font><font face="Courier New">(20.45)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">Then, set the denominator equal to zero.<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq46.jpg" width="522" height="34"></font><font face="Courier New">(20.46)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">Solve the equation for <i>z</i>.<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq47.jpg" width="522" height="54"></font><font face="Courier New">(20.47)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">Check the magnitudes.</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq48.jpg" width="522" height="39"></font><font face="Courier New">(20.48)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">Since at least one (in this case both) of the roots has a magnitude greater than 1, the system is unstable.</font></p>		</div>		<div align="justify">			<p><font face="Times New Roman" size="4">The transfer function of an FIR system has no denominator and so it is always stable. In Csound, an unstable system usually shows up as having infinity<b> (INF)</b> appear as the magnitude of the largest sample.<br>			</font></p>		</div>		<h2><font face="Times New Roman" size="4"><b>Filters</b></font></h2>		<div align="justify">			<p><font face="Times New Roman" size="4">A <i>filter</i> is a system with a specified or pre-determined frequency response. The usual purposes of a filter are either to remove undesired frequencies or emphasize desired ones. The four classic types of filters are <i>lowpass</i>, <i>highpass</i>, <i>bandpass</i> and <i>bandreject</i> or <i>notch</i>. For musical purposes one usually includes parametric equalization filters, shelving filters, comb filters and allpass filters. Filters can be divided up into FIR or IIR filters. For a given response, IIR filters require fewer elements or operations but cause non-linear phase shifts. FIR filters require many more elements but can be specified with linear phase shifts.<br>			</font></p>		</div>		<p><font face="Times New Roman" size="4"><img src="figures/187.gif" width="306" height="226"></font></p>		<p><font face="Times New Roman"><b>Figure 20.33</b> Ideal versions of the four &quot;classic&quot; filters.</font><font face="Times New Roman" size="4"><br>		</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">Csound has several built-in filters. The <a href="../../../references/manual_html/sigmod/port.htm"><b>tone</b></a>, <a href="../../../references/manual_html/sigmod/port.htm"><b>atone</b></a>, <a href="../../../references/manual_html/sigmod/port.htm"><b>reson</b></a> and <a href="../../../references/manual_html/sigmod/port.htm"><b>areson</b></a> opcodes are all IIR filters. The <a href="../../../references/manual_html/sigmod/butterhp.htm"><b>butterlp</b></a>, <a href="../../../references/manual_html/sigmod/butterhp.htm"><b>butterhp</b></a>, <a href="../../../references/manual_html/sigmod/butterhp.htm"><b>butterbp</b></a> and <a href="../../../references/manual_html/sigmod/butterhp.htm"><b>butterbr</b></a> are second-order IIR filters. Both sets implement the four classic filter types. The <a href="../../../references/manual_html/sigmod/lpread.htm"><b>lpread</b>/<b>lpreson</b> (<b>lpfreson</b>)</a> opcodes implement very-high order (up to 40 or 50) IIR filters from predefined tables of filter coefficients. The <a href="../../../references/manual_html/sigmod/comb.htm"><b>comb</b></a> and <a href="../../../references/manual_html/sigmod/comb.htm"><b>alpass</b></a> opcodes implement comb and allpass filters.</font></p>			<p><font face="Times New Roman" size="4">The impulse and frequency responses for <a href="../../../references/manual_html/sigmod/port.htm"><b>tone</b></a> are shown below. As shown above, the impulse responses can be used with <a href="../../../references/manual_html/sigmod/convolve.htm"><b>convolve</b></a> to compare direct implementation with convolution.<br>			</font></p>		</div>		<p><font face="Times New Roman" size="4"><img src="figures/188.gif" width="342" height="252"></font></p>		<p><font face="Times New Roman"><b>Figure 20.34</b> Impulse response for <a href="../../../references/manual_html/sigmod/port.htm"><b>tone</b></a> ((KHP=fs/100). An impulse response plots the amplitude (or intensity) of the output from a filter when the input is an impulse. In this case, the output decays exponentially with time.</font><font face="Times New Roman" size="4"><br>		</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">Csound also provides some tools for generating filters from scratch. Discrete-time filters are usually constructed from difference equations as discussed above. However, the most difficult task in constructing a filter is determining the coefficients in the difference equation. The task is similar to fitting a polynomial to an arbitrary function. Csound has no built-in facilities for calculating the coefficients. You have to do that yourself. (I will give you some hints on how, after we finish discussing how to implement a filter in Csound). However, once the coefficients are calculated, Csound does provide facilities for implementing the filter.</font></p>		</div>		<p><font face="Times New Roman" size="4"><img src="figures/189.gif" width="342" height="252"></font></p>		<p><font face="Times New Roman"><b>Figure 20.35</b> Frequency response for <a href="../../../references/manual_html/sigmod/port.htm"><b>tone</b></a> (khp=f/100). A frequency response plot shows how a given system or filter amplifies or attenuates a signal as you change its frequency. It also shows how the signal&#146;s phase would change as you change its frequency. In this case, the gain is constant up to about 441 Hz. Above 441 Hz the gain drops with frequency. The phase shift is almost 0&deg; at low frequency and drops to &#151;180&deg; at 1/2 of the sampling rate.</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">The <a href="../../../references/manual_html/sigmod/delayr.htm"><b>delay1</b></a> opcode in Csound is the same as the <i><b>D</b></i> operator in the block diagrams shown in figures 20.31 and 20.32 and is useful for creating FIR filters. Filters longer than about 20 delays are unwieldy and are better implemented with <a href="../../../references/manual_html/sigmod/convolve.htm"><b>convolve</b></a>. The following example demonstrates implementing an FIR filter from scratch.<br>			</font></p>		</div>		<h3><font face="Times New Roman" size="4"><b>FIR Example</b></font></h3>		<div align="justify">			<p><font face="Times New Roman" size="4">The difference equation:</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq49.jpg" width="522" height="50"> </font><font face="Courier New">(20.49)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">is an FIR system and has the frequency response:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq50.jpg" width="522" height="53"> </font><font face="Courier New">(20.50)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">which is basically a linear-phase lowpass filter. A Csound instrument to implement and test this filter is:<br>			</font></p>		</div>		<p><font face="Times New Roman" size="4"><img src="figures/192.gif" width="350" height="448"><br>		</font></p>		<p><font face="Times New Roman"><b>Figure 20.36</b></font><font face="Times New Roman"> Block diagram of <i>instr 2009</i>, an instrument that implements and tests the FIR filter defined in equation 23.49.</font><font face="Times New Roman" size="4"><br>		</font></p>		<p><font face="Times New Roman" size="4">		<table cellspacing="0" border="0" width="526">			<tr>				<td width="11%" valign="top"><font face="Courier New">kr</font></td>				<td valign="top" colspan="4"><font face="Courier New">=</font></td>				<td valign="top" colspan="4"><font face="Courier New">44100</font></td>				<td width="42%" valign="top"><font face="Courier New">; avoid assorted problems</font></td>			</tr>			<tr>				<td valign="top" colspan="10"><font face="Courier New">&nbsp;</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="4"><a href="../../../references/manual_html/syntax/iblock.htm"><font face="Courier New">instr</font></a></td>				<td valign="top" colspan="3"><a href="../../instruments/20/2009/2009.html"><font face="Courier New">2009</font></a></td>				<td valign="top" colspan="2"><font face="Courier New">; FIR Filter Example</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">a1</font></td>				<td valign="top" colspan="4"><a href="../../../references/manual_html/siggen/line.htm"><font face="Courier New">linseg</font></a></td>				<td valign="top" colspan="5"><font face="Courier New">sr/8, 7/sr, sr/8, 1/sr, 0, 1, 0</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">a2</font></td>				<td valign="top" colspan="4"><a href="../../../references/manual_html/siggen/oscil.htm"><font face="Courier New">oscil</font></a><font face="Courier New"> </font></td>				<td valign="top" colspan="4"><font face="Courier New">1, a1, 1</font></td>				<td width="42%" valign="top"><font face="Courier New">; Generate an impulse</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">a3</font></td>				<td valign="top" colspan="4"><a href="../../../references/manual_html/sigmod/delayr.htm"><font face="Courier New">delay1</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">a2</font></td>				<td width="42%" valign="top"><font face="Courier New">; Filter delay 1</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">a4</font></td>				<td valign="top" colspan="4"><a href="../../../references/manual_html/sigmod/delayr.htm"><font face="Courier New">delay1</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">a3</font></td>				<td width="42%" valign="top"><font face="Courier New">; Filter delay 2</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">a5</font></td>				<td valign="top" colspan="4"><font face="Courier New">=</font></td>				<td valign="top" colspan="4"><font face="Courier New">0.25*a2+0.5*a3+0.25*a4</font></td>				<td width="42%" valign="top"><font face="Courier New">; Summation</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="4"><a href="../../../references/manual_html/sigio/out.htm"><font face="Courier New">out</font></a></td>				<td valign="top" colspan="5"><font face="Courier New">a5</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="4"><a href="../../../references/manual_html/sigio/print.htm"><font face="Courier New">display</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">a5, p3</font></td>				<td width="42%" valign="top"><font face="Courier New">; display impulse response</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="4"><a href="../../../references/manual_html/sigio/print.htm"><font face="Courier New">dispfft</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">a5, p3, 4096, 0, 1</font></td>				<td width="42%" valign="top"><font face="Courier New">; display frequency response</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="9"><a href="../../../references/manual_html/syntax/iblock.htm"><font face="Courier New">endin</font></a></td>			</tr>			<tr>				<td valign="top" colspan="10"><font face="Courier New">; create a table with an impulse in the second position</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">f 1</font></td>				<td valign="top" colspan="2"><font face="Courier New">0</font></td>				<td width="7%" valign="top"><font face="Courier New">8</font></td>				<td valign="top" colspan="2"><font face="Courier New">2</font></td>				<td valign="top" colspan="4"><font face="Courier New">0 1 0 0 0 0 0 0</font></td>			</tr>			<tr>				<td valign="top" colspan="10"><font face="Courier New">&nbsp;</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">i 2009</font></td>				<td width="4%" valign="top"><font face="Courier New">0</font></td>				<td valign="top" colspan="5"><font face="Courier New">0.185759637</font></td>				<td valign="top" colspan="3"><font face="Courier New">; create 2^14 (8192) samples (a nice FFT #)</font></td>			</tr>		</table>		</font></p>		<p><font face="Times New Roman"><b>Figure 20.37</b></font><font face="Times New Roman"> Orchestra and score code for <i>instr 2009</i>, a simple lowpass design implemented by delaying, scaling and summing the input signal with the scaled delayed copies of the original.</font><font face="Times New Roman" size="4"><br>		</font></p>		<h3>		<h3><font face="Times New Roman" size="4"><b>IIR Example</b></font></h3>		</h3>		<div align="justify">			<p><font face="Times New Roman" size="4">The difference equation:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq51.jpg" width="522" height="53"> </font><font face="Courier New">(20.51)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">which can be rewritten as:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq52.jpg" width="522" height="53"> </font><font face="Courier New">(20.52)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">is an IIR system and has the frequency response:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq53.jpg" width="522" height="74"></font><font face="Courier New">(20.53)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">which is sort of a bandpass-highpass response. A Csound instrument to implement and test this filter (thanks to Russell Pinkston) is:<br>			</font></p>		</div>		<p><font face="Times New Roman" size="4">		<table cellspacing="0" border="0" width="639">			<tr>				<td valign="top" colspan="2"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="4"><a href="../../../references/manual_html/syntax/iblock.htm"><font face="Courier New">instr</font></a></td>				<td valign="top" colspan="2"><a href="../../instruments/20/2010/2010.html"><font face="Courier New">2010</font></a></td>				<td valign="top" colspan="2"><font face="Courier New">; IIR Filter Example</font></td>			</tr>			<tr>				<td valign="top" colspan="2"><font face="Courier New">a1</font></td>				<td valign="top" colspan="4"><a href="../../../references/manual_html/siggen/line.htm"><font face="Courier New">linseg</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">sr/8, 7/sr, sr/8, 1/sr, 0, 1, 0</font></td>			</tr>			<tr>				<td valign="top" colspan="2"><font face="Courier New">a2</font></td>				<td valign="top" colspan="4"><a href="../../../references/manual_html/siggen/oscil.htm"><font face="Courier New">oscil</font></a></td>				<td valign="top" colspan="3"><font face="Courier New">1, a1, 1</font></td>				<td width="42%" valign="top"><font face="Courier New">; Generate impulse</font></td>			</tr>			<tr>				<td valign="top" colspan="2"><font face="Courier New">aprev1</font></td>				<td valign="top" colspan="4"><a href="../../../references/manual_html/syntax/assign.htm"><font face="Courier New">init</font></a><font face="Courier New"> </font></td>				<td valign="top" colspan="3"><font face="Courier New">0</font></td>				<td width="42%" valign="top"><font face="Courier New">; init y(n-1) to 0</font></td>			</tr>			<tr>				<td valign="top" colspan="2"><font face="Courier New">aprev2</font></td>				<td valign="top" colspan="4"><a href="../../../references/manual_html/syntax/assign.htm"><font face="Courier New">init</font></a><font face="Courier New"> </font></td>				<td valign="top" colspan="3"><font face="Courier New">0</font></td>				<td width="42%" valign="top"><font face="Courier New">; init y(n-2) to 0</font></td>			</tr>			<tr>				<td valign="top" colspan="2"><font face="Courier New">ainput</font></td>				<td valign="top" colspan="4"><font face="Courier New">=</font></td>				<td valign="top" colspan="4"><font face="Courier New">a2</font></td>			</tr>			<tr>				<td valign="top" colspan="10"><font face="Courier New">; y(n) = a0x(n)-b1y(n-1)-b2y(n-2)</font></td>			</tr>			<tr>				<td valign="top" colspan="2"><font face="Courier New">aoutput</font></td>				<td valign="top" colspan="4"><font face="Courier New">=</font></td>				<td valign="top" colspan="4"><font face="Courier New">1*ainput-0.5*aprev1-0.5*aprev2</font></td>			</tr>			<tr>				<td valign="top" colspan="2"><font face="Courier New">aprev2</font></td>				<td valign="top" colspan="4"><font face="Courier New">=</font></td>				<td valign="top" colspan="4"><font face="Courier New">aprev1</font></td>			</tr>			<tr>				<td valign="top" colspan="2"><font face="Courier New">aprev1</font></td>				<td valign="top" colspan="4"><font face="Courier New">=</font></td>				<td valign="top" colspan="4"><font face="Courier New">aoutput</font></td>			</tr>			<tr>				<td valign="top" colspan="2"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="4"><a href="../../../references/manual_html/sigio/out.htm"><font face="Courier New">out</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">aoutput</font></td>			</tr>			<tr>				<td valign="top" colspan="2"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="4"><a href="../../../references/manual_html/sigio/print.htm"><font face="Courier New">display</font></a></td>				<td valign="top" colspan="3"><font face="Courier New">aoutput, p3</font></td>				<td width="42%" valign="top"><font face="Courier New">; display impulse response</font></td>			</tr>			<tr>				<td valign="top" colspan="2"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="4"><a href="../../../references/manual_html/sigio/print.htm"><font face="Courier New">dispfft</font></a></td>				<td valign="top" colspan="3"><font face="Courier New">aoutput,p3,4096,0,1</font></td>				<td width="42%" valign="top"><font face="Courier New">; frequency response</font></td>			</tr>			<tr>				<td valign="top" colspan="2"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="8"><a href="../../../references/manual_html/syntax/iblock.htm"><font face="Courier New">endin</font></a></td>			</tr>			<tr>				<td valign="top" colspan="10"><font face="Courier New">&nbsp;</font></td>			</tr>			<tr>				<td valign="top" colspan="10"><font face="Courier New">; create a table with an impulse in the second position</font></td>			</tr>			<tr>				<td width="7%" valign="top"><font face="Courier New">f 1</font></td>				<td valign="top" colspan="2"><font face="Courier New">0</font></td>				<td valign="top" colspan="2"><font face="Courier New">8</font></td>				<td valign="top" colspan="2"><font face="Courier New">2</font></td>				<td valign="top" colspan="3"><font face="Courier New">0 1 0 0 0 0 0 0</font></td>			</tr>			<tr>				<td valign="top" colspan="10"><font face="Courier New">&nbsp;</font></td>			</tr>			<tr>				<td valign="top" colspan="3"><font face="Courier New">i 2010</font></td>				<td width="5%" valign="top"><font face="Courier New">0</font></td>				<td valign="top" colspan="5"><font face="Courier New">0.185759637</font></td>				<td width="42%" valign="top"><font face="Courier New">; create 2^14 (8192) samples</font></td>			</tr>		</table>		</font></p>		<p><font face="Times New Roman"><b>Figure 20.38</b></font><font face="Times New Roman"> Orchestra and score code for <i>instr 2010</i>, an IIR bandpass filter based on equation 20.52.</font><font face="Times New Roman" size="4"><br>		</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">Always check a IIR filter built from scratch, for stability. It is very easy to make an unstable IIR filter. In using filters in musical applications, it is common to change the filter parameters, such as the cutoff frequency or the bandwidth during a note. Strictly speaking, if you change the parameters with time, the filter is no longer time-invariant and the analysis techniques we have discussed no longer apply. However, if the changes are slow compared with the fundamental frequency of the note, approximating the filter as an LTI system is usually adequate.<br>			</font></p>		</div>		<h2>		<h2><font face="Times New Roman" size="4"><b>Filter Design</b></font></h2>		</h2>		<div align="justify">			<p><font face="Times New Roman" size="4">Designing an IIR filter to meet specified performance characteristics is a little beyond what we can do in one chapter. The interested reader is directed to the references. Designing an FIR filter can also be quite involved. However there is one relatively straightforward method which uses the techniques we have discussed up to this point.</font></p>		</div>		<div align="justify">			<p><font face="Times New Roman" size="4">The first step is to plot or sketch the magnitude of the desired frequency response. As mentioned under the heading The Fourier Transform above. The discrete-time frequency response must be a periodic function, so we have to sketch or plot one full period of the function. A plot of one period of an ideal lowpass filter with a cutoff frequency of 1/8 (Remember the useful range of <i><b>F</b></i> is from 0 to 1/2) is given below.<br>			</font></p>		</div>		<p><font face="Times New Roman" size="4"><img src="figures/196.gif" width="342" height="216"></font></p>		<p><font face="Times New Roman"><b>Figure 20.39</b></font><font face="Times New Roman"> Plot of one period of an ideal lowpass filter with a cutoff frequency of 1/8.</font><font face="Times New Roman" size="4"><br>		</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">The next step is to decide how many points to include in the filter. It should be an odd number. The larger the number the better the filter, but the more work you will have to do. Next, for calculation purposes you need to find the index range. For example, for a 5-point filter, the index range is from -2 to 2. For a 15-point filter the index range is from -7 to 7. Call the ending index <i><b>N</b></i>.</font></p>		</div>		<div align="justify">			<p><font face="Times New Roman" size="4">With the index range in hand you need to calculate the Inverse Fourier Transform for the points in the index range using the equation above. The result will be a set of raw filter coefficients, <i><b>a[n]</b></i>. Because our filter uses only a finite number of points we will have to smooth the coefficients. We will do this using a <i>window</i>. Every DSP specialist has his or her own favorite window. We will use the <i>Hamming</i> window:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq54.jpg" width="522" height="39"></font><font face="Courier New">(20.54)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">where <i>n</i> is the coefficient index and <i>N</i> is the ending index. The final filter coefficients, <i><b>b[n]</b></i>, are found by multiplying the raw coefficients by the window coefficients:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq55.jpg" width="522" height="32"></font><font face="Courier New">(20.55)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">For short filters, the coefficients can be used as explained above. For longer filters, the coefficients should be put into a soundfile as sound samples (using something other than Csound), then <a href="../../../references/manual_html/utility/cvanal.htm"><b>cvanal</b></a> should be used to convert the response to a frequency response and <a href="../../../references/manual_html/sigmod/convolve.htm"><b>convolve</b></a> should be used to implement the filter.<br>			</font></p>			<p><font face="Times New Roman" size="4">It is usually wise to check how close the actual filter came to the desired filter. You do so by taking the Fourier Transform of the filter coefficients with the equation above. However, the summation only runs from <b>-<i>N</i></b> to <i><b>N</b></i> instead of <img height="16" width="23" src="figures/-inf.jpg"> to <img height="17" width="19" src="figures/inf.jpg">. The results for a 41-point filter (<i>N</i>=20) are shown below:<br>			</font></p>		</div>		<p><font face="Times New Roman" size="4"><img src="figures/201.gif" width="342" height="216"></font></p>		<p><font face="Times New Roman"><b>Figure 20.40</b> The plot for a 41-point filter with a cutoff frequency of 1/8 as calculated by <i>Mathematica</i> using the commands below.</font><font face="Times New Roman" size="4"><br>		</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4"><i>Mathematica</i> can handle most of the calculation work for you. The following <i>Mathematica</i> commands will calculate and plot the results for a 41-point filter with a cutoff frequency of 1/8.<br>			</font></p>		</div>		<ul>			<p><font face="Courier New">&lt;&lt;Calculus`FourierTransform`<br>			XofF=1-UnitStep[F-1/8]+UnitStep[F-7/8]<br>			Plot[XofF,{F,0,1},AxesLabel-&gt;{F,mag}]<br>			xofn=Integrate[XofF Exp[2 Pi I F n],{F,0,1}<br>			Nmax=20<br>			RawFilter=Table[Limit[xofn,n-&gt;z],{z,-Nmax,Nmax}]<br>			Window=Table[0.54+0.46Cos[n Pi/Nmax],{n,-Nmax,Nmax}]<br>			Filter=Window RawFilter<br>			ListPlot[RawFilter,Prolog-&gt;PointSize[0.02],PlotRange-&gt;All]<br>			ListPlot[Filter,Prolog-&gt;PointSize[0.02],PlotRange-&gt;All]<br>			InverseTable=Table[Exp[-2 Pi I n F],{n,-Nmax,Nmax}]<br>			NewXofF=Apply[Plus,(Filter InverseTable)]<br>			Plot[Abs[NewXofF],{F,0,1},AxesLabel-&gt;{F,mag}]<br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">The only reason for the </font><font face="Courier New" size="4">&lt;&lt;Calculus`FourierTransform`</font><font face="Times New Roman" size="4"> line is for the </font><font face="Courier New" size="4">UnitStep</font><font face="Times New Roman" size="4"> function. </font><font face="Courier New" size="4"><i>Nmax</i></font><font face="Times New Roman" size="4"> can be changed to create larger or smaller filters.<br>			</font></p>			<p><font face="Times New Roman" size="4">You have probably guessed by now that the impulse response of an FIR filter contains the filter coefficients in sequence. In other words, the filter coefficient <i><b>b[n]</b></i> equals the impulse response, <i><b>h[n]</b></i>. This idea is the guiding principal behind <a href="../../../references/manual_html/sigmod/convolve.htm"><b>convolve</b></a>. Since any soundfile <i>could</i> be the impulse response of <i>some</i> filter we can assume that it is and use the soundfile as an FIR filter. The result of using the opening bars of Beethoven&#146;s<i> </i>&quot;Ninth Symphony&quot; to filter &quot;Wild Thing&quot; will probably not be what you would expect, but it can be done.<br>			</font></p>		</div>		<h2><font face="Times New Roman" size="4"><b>Modulation<br>		</b></font></h2>		<div align="justify">			<p><font face="Times New Roman" size="4">Modulation is the use of one signal to change the properties of another signal. Modulation is not a time-invariant process, but the methods we have developed to this point can provide a surprising amount of insight into modulation.<br>			</font></p>		</div>		<h3><font face="Times New Roman" size="4"><b>Frequency Modulation</b></font></h3>		<div align="justify">			<p><font face="Times New Roman" size="4">The most common form of modulation in digital music production is <i>frequency modulation</i>, or FM. A thorough understanding of FM is way beyond the scope of this chapter, but a brief example will be given. In modulation, one signal is normally called the carrier signal, <i><b>c(t)</b></i> and the other is called the modulating signal, <i><b>x<sub>m</sub>(t)</b></i>. In FM the modulating signal changes the frequency of the carrier. For example:<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq56.jpg" width="522" height="32"></font><font face="Courier New">(20.56)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">where <img src="figures/ct=asin.jpg" width="114" height="20"> and <i><b>I</b></i></font><font face="Times New Roman"><sub><i><b>M</b></i></sub></font><font face="Times New Roman" size="4"> is the modulation index. For communications systems, <i><b>x<sub>m</sub>(t)</b></i> is usually band-limited, <i><b>f<sub>0</sub></b></i> is usually much higher than any frequency component in <i><b>x<sub>m</sub>(t)</b></i> and <i><b>I</b></i></font><font face="Times New Roman"><sub><i><b>M</b></i></sub></font><font face="Times New Roman" size="4"> is fairly small. For musical applications, <i><b>f<sub>0</sub></b></i> is usually comparable to the frequency components in <i><b>x<sub>m</sub>(t)</b></i> and <i><b>I</b></i></font><font face="Times New Roman"><sub><i><b>M</b></i></sub></font><font face="Times New Roman" size="4"> is rather large. One less common use for FM is to create alien voices for science-fiction movies. The following example demonstrates modulating a sine wave with a spoken voice. The sound file <i>Hamlet.aif</i> is on the accompanying CD-ROM but any recording of a spoken voice may be used (my thanks to the renowned BBC star and Harvey Mudd professor, Tony Bright, for his Shakespearean recitation).<br>			</font></p>		</div>		<p><font face="Times New Roman" size="4"><img src="figures/210.gif" width="222" height="267"></font></p>		<p><font face="Times New Roman"><b>Figure 20.41</b></font><font face="Times New Roman"> Block diagram of <i>instr 2011</i>, an instrument which frequency modulates a soundfile of a sine wave with a male speaking voice.</font><font face="Times New Roman" size="4"><br>		</font></p>		<p><font face="Times New Roman" size="4">		<table cellspacing="0" border="0" width="488">			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="4"><a href="../../../references/manual_html/syntax/iblock.htm"><font face="Courier New">instr</font></a></td>				<td valign="top" colspan="3"><a href="../../instruments/20/2011/2011.html"><font face="Courier New">2011</font></a></td>				<td valign="top" colspan="2"><font face="Courier New">; FM Sci-fi Voice example<br>					</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">a1</font></td>				<td valign="top" colspan="4"><a href="../../../references/manual_html/sigio/in.htm"><font face="Courier New">soundin</font></a></td>				<td valign="top" colspan="5"><font face="Courier New">&quot;Hamlet.aif&quot;<br>					</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">a3</font></td>				<td valign="top" colspan="4"><a href="../../../references/manual_html/siggen/line.htm"><font face="Courier New">line</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">0, p3, 0.4 </font></td>				<td width="42%" valign="top"><font face="Courier New">; modulation index<br>					</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">a2</font></td>				<td valign="top" colspan="4"><a href="../../../references/manual_html/siggen/oscil.htm"><font face="Courier New">oscil</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">10000, 256-a3*a1, 1</font></td>				<td width="42%" valign="top"><font face="Courier New">; modulate<br>					</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="4"><a href="../../../references/manual_html/sigio/out.htm"><font face="Courier New">out</font></a></td>				<td valign="top" colspan="5"><font face="Courier New">a2</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="9"><a href="../../../references/manual_html/syntax/iblock.htm"><font face="Courier New">endin</font></a></td>			</tr>			<tr>				<td valign="top" colspan="10"><font face="Courier New">&nbsp;</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">f 1</font></td>				<td valign="top" colspan="3"><font face="Courier New">0</font></td>				<td valign="top" colspan="2"><font face="Courier New">4096</font></td>				<td width="8%" valign="top"><font face="Courier New">10</font></td>				<td valign="top" colspan="2"><font face="Courier New">1</font></td>				<td width="42%" valign="top"><font face="Courier New">; sine table<br>					</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">i 2011</font></td>				<td width="6%" valign="top"><font face="Courier New">0</font></td>				<td width="4%" valign="top"></td>				<td valign="top" colspan="7"><font face="Courier New"> 22</font></td>			</tr>		</table>		<br>		</font><font face="Times New Roman"><b>Figure 20.42</b> Orchestra and score code for <i>instr 2011</i>, an FM instrument with a sinusoidal carrier and a <a href="../../../references/manual_html/sigio/in.htm"><b>soundin</b></a> modulator.</font><font face="Times New Roman" size="4"><br>		</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">A thorough exploration of FM requires Bessel functions and other unpleasantries that we will forego at this point.<br>			</font></p>		</div>		<h3><font face="Times New Roman" size="4"><b>Amplitude Modulation</b></font></h3>		<div align="justify">			<p><font face="Times New Roman" size="4">A less common form of modulation in music production, but still valuable and much more amenable to analysis is <i>amplitude modulation</i> or <i>AM</i>. In AM the carrier is multiplied by the modulating signal.<br>			</font></p>		</div>		<ul>			<p><font face="Times New Roman" size="4"><img src="figures/eq57.jpg" width="522" height="32"></font><font face="Courier New">(20.57)</font><font face="Times New Roman" size="4"><br>			</font></p>		</ul>		<div align="justify">			<p><font face="Times New Roman" size="4">There is usually a symmetry between operations in the frequency domain and operations in the time domain. Since convolution in the time domain corresponds to multiplication in the frequency domain, it should come as no surprise that multiplication in the time domain corresponds to convolution in the frequency domain. The Fourier transform of <img src="figures/ctaco.jpg" width="114" height="20"> is two impulses, one at <i><b>f<sub>0</sub></b></i> and the other at <i><b>-f<sub>0</sub></b></i>. If <i><b>x<sub>m</sub>(t)</b></i> is band-limited, then the convolution of <i><b>C(f)</b></i> with <i><b>X<sub>M</sub>(f)</b></i> generates two copies of <i><b>X<sub>M</sub>(f)</b></i>, one centered at <i><b>f<sub>0</sub></b></i> and the other at <i><b>-f<sub>0</sub></b></i>. The figure below illustrates the concept.<br>			</font></p>			<p><font face="Times New Roman" size="4">Implementing AM in Csound is surprisingly straightforward. One simply multiplies two audio-rate variables together. The example below illustrates creating sci-fi voices using AM. The resultant voice is much more intelligible than the FM version. The sound file <i>Hamlet.aif</i> is on the accompanying CD-ROM, but any recording of a spoken voice may be used.<br>			</font></p>		</div>		<p><font face="Times New Roman" size="4"><img src="figures/217.gif" width="237" height="233"><br>		</font></p>		<p><font face="Times New Roman"><b>Figure 20.43</b></font><font face="Times New Roman"> Block diagram of <i>instr 2012</i>, an instrument which amplitude modulates a soundfile of a male speaking voice with a sine wave</font><font face="Times New Roman" size="4">.<br>		</font></p>		<p><font face="Times New Roman" size="4">		<table cellspacing="0" border="0" width="477">			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="2"><a href="../../../references/manual_html/syntax/iblock.htm"><font face="Courier New">instr</font></a></td>				<td valign="top" colspan="3"><a href="../../instruments/20/2012/2012.html"><font face="Courier New">2012</font></a></td>				<td valign="top" colspan="2"><font face="Courier New">; AM Sci-fi Voice example<br>					</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">afmod</font></td>				<td valign="top" colspan="2"><a href="../../../references/manual_html/siggen/line.htm"><font face="Courier New">expseg</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">8000, p3, 40</font></td>				<td width="41%" valign="top"><font face="Courier New">; Vary Carrier frequency<br>					</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">a1</font></td>				<td valign="top" colspan="2"><a href="../../../references/manual_html/sigio/in.htm"><font face="Courier New">soundin</font></a></td>				<td valign="top" colspan="5"><font face="Courier New">&quot;Hamlet.aif&quot;</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">a2</font></td>				<td valign="top" colspan="2"><a href="../../../references/manual_html/siggen/oscil.htm"><font face="Courier New">oscil</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">1, afmod, 1</font></td>				<td width="41%" valign="top"><font face="Courier New">; Generate carrier<br>					</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="2"><a href="../../../references/manual_html/sigio/out.htm"><font face="Courier New">out</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">a1*a2</font></td>				<td width="41%" valign="top"><font face="Courier New">; modulate<br>					</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="7"><a href="../../../references/manual_html/syntax/iblock.htm"><font face="Courier New">endin</font></a></td>			</tr>			<tr>				<td valign="top" colspan="8"><font face="Courier New">&nbsp;</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">f 1</font></td>				<td width="7%" valign="top"><font face="Courier New">0</font></td>				<td valign="top" colspan="2"><font face="Courier New">4096</font></td>				<td width="5%" valign="top"><font face="Courier New">10</font></td>				<td valign="top" colspan="2"><font face="Courier New">1</font></td>				<td width="41%" valign="top"><font face="Courier New">; sine table<br>					</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">i 2012</font></td>				<td width="7%" valign="top"><font face="Courier New">0</font></td>				<td valign="top" colspan="6"><font face="Courier New">22</font></td>			</tr>		</table>		<br>		</font><font face="Times New Roman"><b>Figure 20.44</b> Orchestra and score code for <i>instr 2012</i>, an AM instrument with a <a href="../../../references/manual_html/sigio/in.htm"><b>soundin</b></a> modulator</font><font face="Times New Roman" size="4">.<br>		</font></p>		<p><font face="Times New Roman" size="4"><img src="figures/218.gif" width="305" height="236"></font></p>		<p><font face="Times New Roman"><b>Figure 20.45</b></font><font face="Times New Roman"> Amplitude modulation</font><font face="Times New Roman" size="4">.<br>		</font></p>		<h2>		<h2><font face="Times New Roman" size="4"><b>Voice Scrambler-Descrambler</b></font></h2>		</h2>		<div align="justify">			<p><font face="Times New Roman" size="4">One final example makes use of most of the concepts we have covered in this chapter. A common use for DSP is a voice scrambler for the telephone. Most telephones are band-limited. This example uses a band limit of 8 kHz. If one amplitude modulates an 8 kHz carrier with a band-limited voice and then filters out all frequencies above 8 kHz and below -8 kHz, one ends up with a perfectly reversed voice spectrum. It is very hard to understand someone speaking upside down. The following Csound example performs the modulation and filtering. The soundfile <i>Sharp_8kHz_Lowpass.aif</i> must be processed with <a href="../../../references/manual_html/utility/cvanal.htm"><b>cvanal</b></a> to generate <i>Sharp_8kHz_Lowpass.con</i> before the code can be run.<br>			</font></p>			<p><font face="Times New Roman" size="4"><img src="figures/219.gif" width="270" height="509"><br>			</font></p>			<p><font face="Times New Roman"><b>Figure 20.46</b> Block diagram of <i>instr 2013</i>, an instrument which reverses the spectrum of a <a href="../../../references/manual_html/sigio/in.htm"><b>soundin</b></a> and thus creates a voice scrambler/descrambler</font><font face="Times New Roman" size="4">.<br>			</font></p>		</div>		<p><font face="Times New Roman" size="4">		<table cellspacing="0" border="0" width="567">			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="2"><a href="../../../references/manual_html/syntax/iblock.htm"><font face="Courier New">instr</font></a></td>				<td valign="top" colspan="3"><a href="../../instruments/20/2013/2013.html"><font face="Courier New">2013</font></a></td>				<td valign="top" colspan="2"><font face="Courier New">; Phone Voice scrambler</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">acarr</font></td>				<td valign="top" colspan="2"><a href="../../../references/manual_html/siggen/oscil.htm"><font face="Courier New">oscil</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">1, 8000, 1</font></td>				<td width="41%" valign="top"><font face="Courier New">; gen carrier</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">amod</font></td>				<td valign="top" colspan="2"><a href="../../../references/manual_html/sigio/in.htm"><font face="Courier New">soundin</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">&quot;Hamlet.aif&quot;</font></td>				<td width="41%" valign="top"><font face="Courier New">; The file to scramble.</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">a1</font></td>				<td valign="top" colspan="2"><a href="../../../references/manual_html/sigmod/port.htm"><font face="Courier New">tone</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">amod, 10000</font></td>				<td width="41%" valign="top"><font face="Courier New">; gentle prefilter</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">a2</font></td>				<td valign="top" colspan="2"><a href="../../../references/manual_html/sigmod/convolve.htm"><font face="Courier New">convolve</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">a1, &quot;Sharp_8kHz_Lowpass.con&quot;</font></td>				<td width="41%" valign="top"><font face="Courier New">; Sharp Prefilter</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">asig</font></td>				<td valign="top" colspan="2"><font face="Courier New">=</font></td>				<td valign="top" colspan="4"><font face="Courier New">a2*acarr</font></td>				<td width="41%" valign="top"><font face="Courier New">; modulate</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">a3</font></td>				<td valign="top" colspan="2"><a href="../../../references/manual_html/sigmod/port.htm"><font face="Courier New">tone</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">asig, 10000</font></td>				<td width="41%" valign="top"><font face="Courier New">; gentle filter</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">ascram</font></td>				<td valign="top" colspan="2"><a href="../../../references/manual_html/sigmod/convolve.htm"><font face="Courier New">convolve</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">a3, &quot;Sharp_8kHz_Lowpass.con&quot;</font></td>				<td width="41%" valign="top"><font face="Courier New">; Sharp filter</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="2"><a href="../../../references/manual_html/sigio/out.htm"><font face="Courier New">out</font></a></td>				<td valign="top" colspan="5"><font face="Courier New">ascram*0.2999</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="7"><a href="../../../references/manual_html/syntax/iblock.htm"><font face="Courier New">endin</font></a></td>			</tr>			<tr>				<td valign="top" colspan="8"><font face="Courier New">&nbsp;</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">f 1</font></td>				<td width="5%" valign="top"><font face="Courier New">0</font></td>				<td valign="top" colspan="2"><font face="Courier New">16384</font></td>				<td width="7%" valign="top"><font face="Courier New">10</font></td>				<td valign="top" colspan="2"><font face="Courier New">1</font></td>				<td width="41%" valign="top"><font face="Courier New">; sine table</font></td>			</tr>			<tr>				<td valign="top" colspan="8"><font face="Courier New">&nbsp;</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">i 2013</font></td>				<td width="5%" valign="top"><font face="Courier New">0</font></td>				<td valign="top" colspan="6"><font face="Courier New">24</font></td>			</tr>		</table>		<br>		</font><font face="Times New Roman"><b>Figure 20.47</b> Orchestra and source code for <i>instr 2013</i> which scrambles a <a href="../../../references/manual_html/sigio/in.htm"><b>soundin</b></a> using the convolve opcode</font><font face="Times New Roman" size="4">.<br>		</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">To recover the original voice, one can modulate the new signal with an 8 kHz carrier and then filter out all frequencies above 8 kHz and below -8 kHz. This process reverses the spectrum once again, restoring it to its original state. One needs only to change the name of the input file and use the above <i>2013.orc</i> file to perform the descrambling as shown in <i>instr 2014 </i>below.<br>			</font></p>		</div>		<p><font face="Times New Roman" size="4">		<table cellspacing="0" border="0" width="478">			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="2"><a href="../../../references/manual_html/syntax/iblock.htm"><font face="Courier New">instr</font></a></td>				<td valign="top" colspan="3"><a href="../../instruments/20/2014/2014.html"><font face="Courier New">2014</font></a></td>				<td valign="top" colspan="2"><font face="Courier New">; Phone voice descrambler<br>					</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">acarr</font></td>				<td valign="top" colspan="2"><a href="../../../references/manual_html/siggen/oscil.htm"><font face="Courier New">oscil</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">1, 8000, 1</font></td>				<td width="31%" valign="top"><font face="Courier New">; gen carrier<br>					</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">amod</font></td>				<td valign="top" colspan="2"><a href="../../../references/manual_html/sigio/in.htm"><font face="Courier New">soundin</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">&quot;VoiceScrambler.aif&quot;</font></td>				<td width="31%" valign="top"><font face="Courier New">; File to descramble<br>					</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">asig</font></td>				<td valign="top" colspan="2"><font face="Courier New">=</font></td>				<td valign="top" colspan="4"><font face="Courier New">amod*acarr</font></td>				<td width="31%" valign="top"><font face="Courier New">; modulate<br>					</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">a3</font></td>				<td valign="top" colspan="2"><a href="../../../references/manual_html/sigmod/port.htm"><font face="Courier New">tone</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">asig, 10000</font></td>				<td width="31%" valign="top"><font face="Courier New">; Gentle Filter<br>					</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">adescr</font></td>				<td valign="top" colspan="2"><a href="../../../references/manual_html/sigmod/convolve.htm"><font face="Courier New">convolve</font></a></td>				<td valign="top" colspan="4"><font face="Courier New">a3, &quot;Sharp_8kHz_Lowpass.con&quot;</font></td>				<td width="31%" valign="top"><font face="Courier New">; Sharp Filter<br>					</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="2"><a href="../../../references/manual_html/sigio/out.htm"><font face="Courier New">out</font></a></td>				<td valign="top" colspan="5"><font face="Courier New">adescr*0.7246</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">&nbsp;</font></td>				<td valign="top" colspan="7"><a href="../../../references/manual_html/syntax/iblock.htm"><font face="Courier New">endin</font></a></td>			</tr>			<tr>				<td valign="top" colspan="8"><font face="Courier New">&nbsp;</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">f 1</font></td>				<td width="5%" valign="top"><font face="Courier New">0</font></td>				<td valign="top" colspan="2"><font face="Courier New">16384</font></td>				<td width="7%" valign="top"><font face="Courier New">10</font></td>				<td valign="top" colspan="2"><font face="Courier New">1</font></td>				<td width="31%" valign="top"><font face="Courier New">; sine table</font></td>			</tr>			<tr>				<td valign="top" colspan="8"><font face="Courier New">&nbsp;</font></td>			</tr>			<tr>				<td width="11%" valign="top"><font face="Courier New">i 2014</font></td>				<td width="5%" valign="top"><font face="Courier New">0</font></td>				<td valign="top" colspan="6"><font face="Courier New">24</font></td>			</tr>		</table>		<br>		</font><font face="Times New Roman"><b>Figure 20.48</b> Orchestra and source code for <i>instr 2014</i> which descrambles a previously scrambled <a href="../../../references/manual_html/sigio/in.htm"><b>soundin</b></a> using the convolve opcode.</font><font face="Times New Roman" size="4"><br>		</font></p>		<div align="justify">			<p><font face="Times New Roman" size="4">The difference is that the scrambling orchestra band-limits the input signal to 8 kHz before scrambling. Because the scrambled signal is already band-limited to 8 kHz, the prefiltering is not necessary for descrambling.</font></p>		</div>		<div align="justify">			<p><font face="Times New Roman" size="4">This example works well in Csound at the common sampling rate of 44.1 kHz but will not run properly at 22 kHz, because the modulation creates sound at frequencies up to 16 kHz before the lowpass filtering. At the lower sampling rate the portion of the scrambled spectrum from 11 to 16 kHz aliases back into the range of 11 to 6 kHz, so the lowpass filter cannot remove it. The voice would be well scrambled but impossible to unscramble.</font></p>		</div>		<p><font face="Times New Roman" size="4">&nbsp;<img src="figures/049.jpg" width="498" height="405"></font></p>		<p><font face="Times New Roman"><b>Figure 20.49</b></font><font face="Times New Roman"> Block diagram of voice scrambler/descrambler.</font><font face="Times New Roman" size="4"><br>		</font></p>		<h2>		<h2><font face="Times New Roman" size="4"><b>Conclusion</b></font></h2>		</h2>		<div align="justify">			<p><font face="Times New Roman" size="4">This chapter has only been able to scratch the surface of signal processing and Csound. However, I hope that I have convinced you, the reader, that Csound is a valuable, if not an optimal tool for exploring the concepts of digital signal processing and that signal-processing methods and techniques are valuable for understanding what Csound does and why.<br>			</font></p>		</div>		<p><font face="Times New Roman" size="4"><img src="figures/220.gif" width="342" height="252"><img src="figures/221.gif" width="342" height="252"><br>		</font></p>		<p><font face="Times New Roman" size="4"><img src="figures/222.gif" width="342" height="252"><img src="figures/223.gif" width="342" height="252"><br>		</font></p>		<p><font face="Times New Roman" size="4"><img src="figures/224.gif" width="342" height="252"><img src="figures/225.gif" width="342" height="252"><br>		</font></p>		<p><font face="Times New Roman" size="4"><img src="figures/226.gif" width="342" height="252"><img src="figures/227.gif" width="342" height="252"><br>		</font></p>		<p><font face="Times New Roman" size="4"><img src="figures/228.gif" width="342" height="252"><img src="figures/229.gif" width="342" height="252"><br>		</font></p>		<p><font face="Times New Roman" size="4"><img src="figures/230.gif" width="342" height="252"><img src="figures/231.gif" width="342" height="252"><br>		</font></p>		<p><font face="Times New Roman" size="4"><img src="figures/232.gif" width="342" height="252"><img src="figures/233.gif" width="342" height="252"><br>		</font></p>		<p><font face="Times New Roman" size="4"><img src="figures/234.gif" width="342" height="252"><img src="figures/235.gif" width="342" height="252"><br>		</font></p>		<p><font face="Times New Roman" size="4"><img src="figures/236.gif" width="342" height="252"><img src="figures/237.gif" width="342" height="252"><br>		</font></p>		<p><font face="Times New Roman" size="4"><img src="figures/238.gif" width="342" height="252"><img src="figures/239.gif" width="342" height="252"><br>		</font></p>		<p><font face="Times New Roman"><b>Figure 20.50</b></font><font face="Times New Roman"> Impulse and Frequency Response Graphs</font><font face="Times New Roman" size="4">.<br>		</font></p>		<h2><font face="Times New Roman" size="4"><b>References</b></font></h2>		<div align="justify">			<p><font face="Times New Roman" size="4">Chamberlin, H. 1980.<i> Musical Applications of Microprocessors</i>. Rochelle Park, N.J.: Hayden.</font></p>		</div>		<div align="justify">			<p><font face="Times New Roman" size="4">Hamming, R.W. 1983. <i>Digital Filters</i>. Englewood Cliffs, N.J.: Prentice-Hall.</font></p>		</div>		<div align="justify">			<p><font face="Times New Roman" size="4">Oppenheim, A.V., A.S. Willsky and I.T. Young. 1983. <i>Signals and Systems</i>. Englewood Cliffs, N.J.: Prentice-Hall.</font></div>	</body></html>