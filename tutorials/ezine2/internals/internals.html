<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN"><html>	<head>		<meta name="Generator" content="Cosmo Create 1.0.3">		<title>Adding Opcodes to Csound</title>	</head>	<body bgcolor="white">		<center>			<h2 align="CENTER">Adding Opcodes to Csound</h2>		</center>		<center>			<p align="CENTER"><i><font size="2">Hans Mikelson </font></i></p>		</center>		<center>			<p align="CENTER"><a href="mailto:hljmm@werewolf.net"><font size="2">hljmm@werewolf.net</font></a></p>		</center>		<p><b><font size="2">Introduction</font></b></p>		<p><font size="2">In the last issue I described how to compile Csound. One of the main reasons you would wish to recompile Csound is so that you can add your own opcodes to Csound. The first step is to determine if an opcode is needed. The second step is to prototype the opcode in Csound. Third is to translate the Csound code into C code. Fourth is to consider storage requirements. Fifth is to test and benchmark the opcode. Sixth is to Write the manual entry and provide a working example. I will describe how I created the opcodes: lorenz, biquad and deltapn</font></p>		<p><b><font size="2">Why add another opcode?</font></b></p>		<p><font size="2">The first step in adding an opcode to Csound is to determine if an opcode is needed. There are already so many opcodes that it literally takes years to learn how to use them all. The opcode should be generally useful in a variety of situations. The opcode may be a well known or famous algorithm. The opcode should offer some advantage to programming directly in Csound. If the algorithm requires kr=sr a significant speed advantage can be obtained by coding the algorithm in C. Coding an opcode can make otherwise long and clumsy code easy to work with and understand. If the opcode fits several of the above criteria you should consider submitting it for inclusion in the canonical sources.</font></p>		<p><font size="2">The lorenz system is fairly easy to write in Csound but it requires setting sr=kr which makes the orchestra run very slowly. A more important reason for wanting to create this as an opcode is its historical significance in mathematics as the first chaotic system described. It also makes a useful tone generator.</font></p>		<p><font size="2">I wanted to add the biquad opcode to Csound because I was experimenting with different types of filters and wanted to be able to sweep them at k-rate which was not possible with the current general purpose filters. The other reason was that many DSP applications make use of biquadratic filters and combinations of them. Higher order filters are subject to numerical accuracy problems and so they are not often used.</font></p>		<p><font size="2">A friend asked me to write deltapn and it turned out to be generally useful in implementing different interpolation schemes for delay lines.</font></p>		<p><b><font size="2">Designing the opcode</font></b></p>		<p><font size="2">The next step is to design the opcode. If possible I like to prototype the opcode in Csound so that I can get a feeling for how the opcode is used. As you are looking at the number of control parameters think about if some of the parameters can be eliminated, combined or made optional. What is the appropriate order for the parameters? For many generating opcodes the first parameters are amplitude and frequency followed by the control parameters. The optional parameters must go at the end. Decide which parameters should be varied at i-rate, k-rate, or a-rate. Try to choose a name that is short, descriptive and not easily confused with some other function. To avoid breaking existing orchestras do not name the opcode starting with any of the following letters or letter pairs: i, k, a, gi, gk, ga. If it is a generator try to make sure that when you ask for an amplitude of 10000 it generates an amplitude of 10000.</font></p>		<p><b><font size="2">Csound to C</font></b></p>		<p><font size="2">Now that the prototype is completed it is time to convert the Csound code to C.</font></p>		<p><b><font size="2">Testing and benchmarking</font></b></p>		<p><font size="2">The next step is to test your opcode and see if it works. Be sure to test under the extreme and typical settings of the input parameters. Bench mark the opcode and see how fast it runs. Look at the code and see if there is anything you could change to make it more efficient.</font></p>		<p><b><font size="2">Write the manual</font></b></p>		<p><font size="2">The final step is creating the manual entry. The manual should describe what the opcodes inteded purpose is and any limitations. The manual should describe each of the input parameters and give their expected ranges. The manual should provide a working example of the opcode in action. Don't forget to include your name so everyone can thank you for writing such a great opcode.</font></p>		<p><b><font size="2">Conclusion</font></b></p>		<p><font size="2">By now you should be able to start creating you own opcodes for Csound and adding to the most powerful sound processing tool on the planet. Good luck and happy Csounding.</font></p>	</body></html>