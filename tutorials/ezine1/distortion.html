<html>	<head>		<title>Distortion</title>	</head>	<body bgcolor="#FFFFFF" link="#0000FF" vlink="#800080">		<h2 align="center">Hyperbolic Tangent Distortion</h2>		<p align="center"><font size="2"><i>Hans Mikelson</i></font></p>		<p align="center"><a href="mailto:hljmm@werewolf.net"><font size="2">hljmm@werewolf.net</font></a></p>		<p align="center"><a href="instruments/tanh.orc"><font size="2">tanh.orc</font></a> <a href="instruments/tanh1.sco"><font size="2">tanh1.sco</font></a> <a href="instruments/tanh2.sco"><font size="2">tanh2.sco</font></a></p>		<p><font size="2"><b>Introduction</b></font></p>		<p><font size="2">This article discusses using the hyperbolic tangent function to simulate guitar tube or valve amplifier distortion. Some of the characteristics that this instrument will try to mimic are clipping, rectification and asymmetry. Some modifications of the hyperbolic tangent function can be used to approximate this type of distortion.</font></p>		<p><font size="2"><b>Hyperbolic Tangent</b></font></p>		<p><font size="2">A graph of hyperbolic tangent is presented below</font></p>		<p><font size="2"><img src="figures/81.gif" width="279" height="149" sgi_src="/ptmp/csound/ezine/Image81.gif"></font></p>		<pre><font size="2"><b>Figure 1</b></font><font size="2">Graph of hyperbolic tangent</font></pre>		<p><font size="2">This hyperbolic tangent is a nice starting point for the type of wave shaping required for distortion. Near zero the curve is approximately linear and at the extremes the curve begins to compress the signal. A graph of a sine wave and the wave shaped sine wave is presented next</font></p>		<p><font size="2"></font>&nbsp;</p>		<p><font size="2"><img src="figures/82.gif" width="381" height="278" sgi_src="/ptmp/csound/ezine/Image82.gif"></font></p>		<pre><font size="2"><b>Figure 2</b></font><font size="2">Graph of sine wave and sine wave shaped by tanh with different amounts of distortion.</font></pre>		<p><font size="2">From figure 2 it can be seen that greater amplitude of the incoming signal results in greater clipping which is what is wanted for distortion. This accomplishes the first aspect of the distortion.</font></p>		<p><font size="2"><b>Modified Hyperbolic Tangent</b></font></p>		<p><font size="2">Next I consider a modification of the tanh function which will allow asymmetric wave shaping. In order to do this consider how the tanh function can be created using the exponential function. Multiplying the numerator terms by values near 1 results in an asymmetric shape.</font></p>		<p><font size="2"><img src="figures/83.gif" width="379" height="221" sgi_src="/ptmp/csound/ezine/Image83.gif"></font></p>		<pre><font size="2"><b>Figure 3</b></font><font size="2">Graph of asymmetric modified tanh.</font></pre>		<p><font size="2">Shaping a sine wave with this modified tanh function results in the following curve</font></p>		<p><font size="2"><img src="figures/84.gif" width="465" height="286" sgi_src="/ptmp/csound/ezine/Image84.gif"></font></p>		<pre><font size="2"><b>Figure 4</b></font><font size="2">Graph of hsine wave and sine wave shaped by the modified tanh.</font></pre>		<p><font size="2">This completes the asymmetric portion of the wave shaping.</font></p>		<p><font size="2">The final aspect considered in this instrument is rectification. The following Csound code fragment illustrates how this can be translated into Csound. Adding an offset to the signal prior to waveshaping can accomplish this. This results in a DC bias after wave shaping which must be removed. One way to do this is to compute an offset value to be subtracted from the processed signal.</font></p>		<pre><font size="2">koffs1   =       irect*krms*(p4/1000+(p6-.5)/8000)koffs2   =      -irect*krms*(p4/1000+(p7-.5)/8000)koffs3   =       irect*krms*p4/1000koffs    =       (exp(koffs1)-exp(koffs2))/(exp(koffs3)+exp(-koffs3))ax1      =       asig*(kpregn+ka1)                ; Precalculate a few values to save timeax2      =      -asig*(kpregn+ka2)ax3      =       asig*kpregnaout     =       ((exp(ax1)-exp(ax2))/(exp(ax3)+exp(-ax3))-koffs)*kpostg ; modified tanh distortion</font></pre>		<p><font size="2">This works well but is computationally expensive. A graph of a sine wave processed using asymmetric waveshaping and rectification and the score line used to generate it follows.</font></p>		<pre><font size="2">;    Sta  Dur   Overdrive  Gain  Shape1  Shape2  Rect  InCh  OutCh  Outputi11  0    .2    4          .5    0       .1      .5    1     2      1</font></pre>		<p><img src="figures/rect.gif" width="277" height="254"></p>		<pre><font size="2"><b>Figure 5</b></font><font size="2">Graph of sine wave with rectification.</font></pre>		<p><font size="2"><b>Conclusion</b></font></p>		<p><font size="2">This instrument is fairly flexible allowing asymmetric wave-shaping and rectification. One of the advantages of this instrument is the ability to adjust the amount and shape of the distortion continuously at k-rate which may not be easy to accomplish with table based wave-shaping. A disadvantage of this instrument is that it is computationally expensive and may not be as suitable for real-time operation especially if combined with other sound effects. This instrument does not attempt to generate band-limited distortion. Those interested in band-limited distortion should investigate the use of Chebyshev polynomials to generate the effect.</font></p>		<p><font size="2"><b>References</b></font></p>		<p><a href="http://www.dwfearn.com/tvst1.htm" target="_top"><font size="2">http://www.dwfearn.com/tvst1.htm</font></a></p>		<p><a href="http://www.firebottle.com/ampage/" target="_top"><font size="2">http://www.firebottle.com/ampage/</font></a></p>	</body></html>